<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="XqWEZ-KjvQT4IfXzxYvH-PEc--_zN6GqthY2jBsqOs4"><meta name="msvalidate.01" content="4E28E3FDD5912EBBB84869B17359650D"><meta name="baidu-site-verification" content="code-dwpSTDBLS2"><link rel="alternate" type="application/rss+xml" title="鑫酱" href="https://hakuya.me/rss.xml"><link rel="alternate" type="application/atom+xml" title="鑫酱" href="https://hakuya.me/atom.xml"><link rel="alternate" type="application/json" title="鑫酱" href="https://hakuya.me/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Recast Navigation,SoloMesh"><link rel="canonical" href="https://hakuya.me/learning/recastnavigation/SoloMesh/"><title>SoloMesh - 导航网格 - 学习 | 个人博客 = 鑫酱 = 笔记本</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">SoloMesh</h1><div class="meta"><span class="item" title="创建时间：2021-11-11 21:03:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-11-11T21:03:00+08:00">2021-11-11</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>18k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>17 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">个人博客</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (4).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (24).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper_1.jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (20).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (12).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (15).jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learning/" itemprop="item" rel="index" title="分类于 学习"><span itemprop="name">学习</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learning/recastnavigation/" itemprop="item" rel="index" title="分类于 导航网格"><span itemprop="name">导航网格</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://hakuya.me/learning/recastnavigation/SoloMesh/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="鑫酱(●'◡'●)"><meta itemprop="description" content="笔记本, 整天摸鱼，却妄想拯救世界的技术宅"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="鑫酱"></span><div class="body md" itemprop="articleBody"><div class="note info"><p>以下为个人学习笔记整理，源项目<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JlY2FzdG5hdmlnYXRpb24vcmVjYXN0bmF2aWdhdGlvbg=="> github 链接</span>。</p></div><h1 id="solomesh"><a class="anchor" href="#solomesh">#</a> SoloMesh</h1><p>SoloMesh 的构建过程可以分为如下几步：</p><ul><li>「Step 1」<a href="#initialize-build-config">Initialize build config</a></li><li>「Step 2」<a href="#rasterize-input-polygon-soup">Rasterize input polygon soup</a></li><li>「Step 3」<a href="#filter-walkables-surfaces">Filter walkables surfaces</a></li><li>「Step 4」<a href="#partition-walkable-surface-to-simple-regions">Partition walkable surface to simple regions</a></li><li>「Step 5」<a href="#trace-and-simplify-region-contours">Trace and simplify region contours</a></li><li>「Step 6」<a href="#build-polygons-mesh-from-contours">Build polygons mesh from contours</a></li><li>「Step 7」<a href="#create-detail-mesh-which-allows-to-access-approximate-height-on-each-polygon">Create detail mesh which allows to access approximate height on each polygon</a></li><li>「Step 8」<a href="#create-detour-data-from-recast-poly-mesh">Create Detour data from Recast poly mesh</a></li></ul><h2 id="initialize-build-config"><a class="anchor" href="#initialize-build-config">#</a> Initialize build config</h2><p>可以设置的参数介绍：<span class="exturl" data-url="aHR0cDovL3d3dy5jcml0dGVyYWkub3JnL3Byb2plY3RzL25tZ2VuX3N0dWR5L2NvbmZpZy5odG1s">相关参数介绍</span></p><hr><h3 id="rasterization"><a class="anchor" href="#rasterization">#</a> Rasterization</h3><p>用于设置体素化 AABB 的粒度</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211009152348.png" alt="image-20211009152345138"></p><h4 id="cellsize"><a class="anchor" href="#cellsize">#</a> CellSize</h4><p>Cell 的长宽（xz-plane）</p><h4 id="cellheight"><a class="anchor" href="#cellheight">#</a> CellHeight</h4><p>Cell 的高（y）</p><h4 id="voxels"><a class="anchor" href="#voxels">#</a> Voxels</h4><p>根据「CellSize」能够把地图切分成的 width x height 数量。</p><hr><h3 id="agent"><a class="anchor" href="#agent">#</a> Agent</h3><p>用于限制某块区域的可行走状态</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211009152645.png" alt="image-20211009152644378"></p><h4 id="height"><a class="anchor" href="#height">#</a> Height</h4><p>行走对象的高度</p><h4 id="radius"><a class="anchor" href="#radius">#</a> Radius</h4><p>行走对象的步长半径</p><h4 id="maxclimb"><a class="anchor" href="#maxclimb">#</a> MaxClimb</h4><p>行走对象的最大爬坡高度</p><h4 id="maxslop"><a class="anchor" href="#maxslop">#</a> MaxSlop</h4><p>行走对象的最大爬坡角度</p><hr><h3 id="region"><a class="anchor" href="#region">#</a> Region</h3><p>控制组成单个行走区域的范围大小</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211009153216.png" alt="image-20211009153215420"></p><h4 id="minregionsize"><a class="anchor" href="#minregionsize">#</a> MinRegionSize</h4><p>「Region」的最小尺寸，小于该值则不会算作一个「Region」</p><h4 id="mergedregionsize"><a class="anchor" href="#mergedregionsize">#</a> MergedRegionSize</h4><p>「Region」的最小合并尺寸，小于该值会被合并。</p><hr><h3 id="partioning"><a class="anchor" href="#partioning">#</a> Partioning</h3><p>控制「Region」生存所用算法</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211009154228.png" alt="image-20211009154227667"></p><p>三种分区算法</p><ul><li>Watershed：分水岭算法</li><li>Monotone：单调分割算法</li><li>Layers：分层算法</li></ul><hr><h3 id="filtering"><a class="anchor" href="#filtering">#</a> Filtering</h3><p>一些可选的剔除 or 过滤项</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211009154744.png" alt="image-20211009154743350"></p><ul><li>Low Hanging Obstacles：考虑是否计算可以攀爬的「Span」。</li><li>Ledge Spans：「Ledge」被解释为墙壁或者垂直的障碍物，开启该功能后会在「Ledge」周围扩展一定范围作为不可行走区域。</li><li>Walkable Low Height Spans：开启后会剔除接近「行走对象高度」的「Spans」区域。</li></ul><hr><h3 id="polygonization"><a class="anchor" href="#polygonization">#</a> Polygonization</h3><p>控制「Region」转到「Poly」时的切分规则</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211009162045.png" alt="image-20211009162044801"></p><h4 id="maxedgelength"><a class="anchor" href="#maxedgelength">#</a> MaxEdgeLength</h4><p>多边形面片的最大边长，超过则会进行拆分。</p><h4 id="maxedgeerror"><a class="anchor" href="#maxedgeerror">#</a> MaxEdgeError</h4><p>面片和几何物体的距离，可以理解为面片和几何的贴合程度，越小贴合越紧密，面片越多。</p><h4 id="vertsperpoly"><a class="anchor" href="#vertsperpoly">#</a> VertsPerPoly</h4><p>多边形的最大顶点数。</p><hr><h3 id="detail-mesh"><a class="anchor" href="#detail-mesh">#</a> Detail Mesh</h3><p>控制「Poly」内部的细分规则</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211009163340.png" alt="image-20211009163339595"></p><h4 id="sampledistance"><a class="anchor" href="#sampledistance">#</a> SampleDistance</h4><p>网格采样距离，用于对「Poly」进行进一步的细分，越小切分的网格越多，该参数受到「MaxSampleError」影响。</p><h4 id="maxsampleerror"><a class="anchor" href="#maxsampleerror">#</a> MaxSampleError</h4><p>网格和几何物体的距离，越小网格越贴合物体表面。</p><h3 id="convexvolumetool-相关配置"><a class="anchor" href="#convexvolumetool-相关配置">#</a> ConvexVolumeTool 相关配置</h3><p>标识需要包含和排除的地形类型</p><h4 id="areatype"><a class="anchor" href="#areatype">#</a> AreaType</h4><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211022205023.png" alt="image-20211022205022734"></p><h2 id="rasterize-input-polygon-soup"><a class="anchor" href="#rasterize-input-polygon-soup">#</a> Rasterize input polygon soup</h2><p>场景体素化，把顶点坐标等模型数据转化为单位立方体（体素）。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211009165743.png" alt="image-20211009165741717"></p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211009165714.png" alt="image-20211009165712889"></p><ul><li>「Step.1」：标记满足爬坡角度 <a href="#maxclimb">MaxClimb</a> 的三角形，用于过滤不可行走区域</li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// rcMarkWalkableTriangles</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nt<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token comment">//nt 三角形数量</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> tri <span class="token operator">=</span> <span class="token operator">&amp;</span>tris<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//tris 三个为一组，记录三角形顶点编号</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token function">calcTriNormal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>verts<span class="token punctuation">[</span>tri<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>verts<span class="token punctuation">[</span>tri<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>verts<span class="token punctuation">[</span>tri<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> norm<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		<span class="token comment">// Check if the face is walkable.</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>norm<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">></span> walkableThr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>			areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> RC_WALKABLE_AREA<span class="token punctuation">;</span> <span class="token comment">// RC_WALKABLE_AREA = 0x3f</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="rasterizetriangles"><a class="anchor" href="#rasterizetriangles">#</a> RasterizeTriangles</h3><ul><li><p>「Step.2」体素化三角形</p><ul><li>计算所有三角形各自的「AABB」包围盒，用于过滤越界的三角形</li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">float</span> tmin<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tmax<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// Calculate the bounding box of the triangle.</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">rcVcopy</span><span class="token punctuation">(</span>tmin<span class="token punctuation">,</span> v0<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">rcVcopy</span><span class="token punctuation">(</span>tmax<span class="token punctuation">,</span> v0<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">rcVmin</span><span class="token punctuation">(</span>tmin<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">rcVmin</span><span class="token punctuation">(</span>tmin<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">rcVmax</span><span class="token punctuation">(</span>tmax<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">rcVmax</span><span class="token punctuation">(</span>tmax<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul><li>对三角形进行切割 ——<a href="#dividepoly">DividePoly</a></li></ul></li></ul><h4 id="dividepoly"><a class="anchor" href="#dividepoly">#</a> DividePoly</h4><ul><li><p>「Step.2.1」：以 xz-plane 按照「<a href="#cellsize">CellSize</a>」生成网格，并按照先 <code>x</code> 后 <code>z</code> 进行切割</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// divides a convex polygons into two convex polygons on both sides of a line</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">dividePoly</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span> in<span class="token punctuation">,</span> <span class="token keyword">int</span> nin<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>					  <span class="token keyword">float</span><span class="token operator">*</span> out1<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> nout1<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>					  <span class="token keyword">float</span><span class="token operator">*</span> out2<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> nout2<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>					  <span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> axis<span class="token punctuation">)</span></pre></td></tr></table></figure><ul><li>in：输入三角形顶点。</li><li>out1、out2：输出切割后轴两边的顶点，并作为下一次输入</li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Clip the triangle into all grid cells it touches.</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// |_______|_______|_______|_______|  7 x 3 x 4</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// in     inrow    p1      p2</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 运行过程中，这几个指针会不停的交换指向，来变更三角形输入和输出位置，看着相当之头大</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">float</span> buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">float</span> <span class="token operator">*</span>in <span class="token operator">=</span> buf<span class="token punctuation">,</span> <span class="token operator">*</span>inrow <span class="token operator">=</span> buf<span class="token operator">+</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">*</span>p1 <span class="token operator">=</span> inrow<span class="token operator">+</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">*</span>p2 <span class="token operator">=</span> p1<span class="token operator">+</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul><li>存储切割结果的数据结构 7 x 3 x 4。</li><li>7：对三角形进行切割的时候，最多会产生 7 个顶点的多边形。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211011174350.png" alt="image-20211011174341515"></p><ul><li>3：顶点坐标 <code>x,y,z</code> 。</li><li>4：输出项有四个，竖着切会输出左右三角形顶点数据，横着切会输出上下三角形顶点数据。</li></ul></li><li><p>「Step.2.2」：生成体素格子「Span」</p><ul><li>记录 <code>x</code> ， <code>z</code> 坐标对应的的编号 <code>idx = x + z * Heightfield.width</code></li><li>更新 <code>y</code> 最低和最高值 <code>Span.smin、 Span.smax</code></li><li>更新行走状态 <code>Span.area</code> （0：不可行走，63：可行走）</li></ul></li><li><p>「Step.2.3」：「Span」合批</p><ul><li>如果两个「Span」的 <code>idx</code> 相同，且 <code>y</code> 轴覆盖范围有重叠，且合并后「Span」的 <code>Span.smin 和 Span.smax</code> 的高度差不超过「<a href="#maxclimb">MaxClimb</a>」，则进行合并，并更新 <code>Span.area、Span.smax、Span.smin</code></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211011180300.png" alt="image-20211011180259848"></p></li></ul><h2 id="filter-walkables-surfaces"><a class="anchor" href="#filter-walkables-surfaces">#</a> Filter walkables surfaces</h2><p>处理配置内的三个过滤项：</p><ul><li><a href="#lowhangingobstacles">Low Hanging Obstacles</a>：计算可以攀爬区域。</li><li><a href="#ledgespans">Ledge Spans</a>：缩小突起区域的外轮廓。</li><li><a href="#walkablelowheightspans">Walkable Low Height Spans</a>：剔除不可站立区域。</li></ul><h3 id="low-hanging-obstacles"><a class="anchor" href="#low-hanging-obstacles">#</a> Low Hanging Obstacles</h3><p>如果「Span」本身不可达，但可通过其他「Span」攀爬到达，其也将视为可达区域，受配置项「<a href="#maxclimb">MaxClimb</a>」影响</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211012110727.png" alt="image-20211012110717790"></p><h3 id="ledge-spans"><a class="anchor" href="#ledge-spans">#</a> Ledge Spans</h3><p>如果「Span」可站立（距离上表面高度大于「<a href="#height">Agent Height</a>」）且高于周围「Span」「<a href="#maxclimb">MaxClimb</a>」，那么视作不可达</p><p>表现上来说可以缩减突起部分的不可达区域</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211012153549.png" alt="image-20211012153548427"></p><blockquote><p>开启前：</p></blockquote><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211012152413.png" alt="image-20211012152412611"></p><blockquote><p>开启后：</p></blockquote><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211012152349.png" alt="image-20211012152348621"></p><h3 id="walkable-low-height-spans"><a class="anchor" href="#walkable-low-height-spans">#</a> Walkable Low Height Spans</h3><p>剔除不可站立区域，受到配置项「<a href="#height">Agent Height</a>」影响。</p><p>如果同一列的「Span」间隙小于「<a href="#height">Agent Height</a>」，那么移动对象不能在其中站立，因此也表现为不可达</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211012153138.png" alt="image-20211012153137603"></p><h2 id="partition-walkable-surface-to-simple-regions"><a class="anchor" href="#partition-walkable-surface-to-simple-regions">#</a> Partition walkable surface to simple regions</h2><p>找出所有的可达区域，并合并为「Region」</p><h3 id="buildcompactheightfield"><a class="anchor" href="#buildcompactheightfield">#</a> BuildCompactHeightfield</h3><ul><li><p>「Step.1」在可达区域构建「CompactSpan」，并记录连通情况</p><ul><li>连通判定：和周围「CompactSpan」高度差不超过「<a href="#maxclimb">MaxClimb</a>」，两者最小高度差大于「<a href="#height">Agent Height</a>」</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211111175812.png" alt="image-20211111175811722"></p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Check that the gap between the spans is walkable,</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// and that the climb height between the gaps is not too high.</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>top <span class="token operator">-</span> bot<span class="token punctuation">)</span> <span class="token operator">>=</span> walkableHeight <span class="token operator">&amp;&amp;</span> <span class="token function">rcAbs</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ns<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> walkableClimb<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// Mark direction as walkable.</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">const</span> <span class="token keyword">int</span> lidx <span class="token operator">=</span> k <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>nc<span class="token punctuation">.</span>index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">rcSetCon</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> dir<span class="token punctuation">,</span> lidx<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ul><h3 id="erodewalkablearea"><a class="anchor" href="#erodewalkablearea">#</a> ErodeWalkableArea</h3><p>辐射遍历，计算场距</p><ul><li><p>「Step.2」：根据「<a href="#radius">Agent Radius</a>」辐射计算出可行走范围</p><ul><li><p>初始化场距：把边界处（邻居小于 <code>4</code> ）的「CompactSpan」的「Distance」标记为 <code>0</code> 其他标记为 <code>0ff</code></p></li><li><p>两轮 pass 用于更新场距，记录每个「CompactSpan」到边界的距离：</p><ul><li>「Pass.1」：每个「CompactSpan」按照「左、左下」和「下、右下」的顺序遍历邻居，距离计算：</li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//dist [i] 当前「span」的「distance」</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">//dist [ai] 相邻「span」的「distance」</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 横纵坐标距离 + 2.</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 斜向坐标距离 + 3.</span></pre></td></tr><tr><td data-num="5"></td><td><pre>nd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token function">rcMin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>dist<span class="token punctuation">[</span>ai<span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>nd <span class="token operator">&lt;</span> dist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	dist<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> nd<span class="token punctuation">;</span></pre></td></tr></table></figure><ul><li>「Pass.2」：每个「CompactSpan」按照「右、右上」和「上、左上」的顺序遍历邻居</li></ul></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211019172807.png" alt="image-20211019172748507"></p><ul><li>将「Distance」小于 2 *「<a href="#radius">Agent Radius</a>」的「CompactSpan」标记为不可达。</li></ul></li></ul><h3 id="markconvexpolyarea"><a class="anchor" href="#markconvexpolyarea">#</a> MarkConvexPolyArea</h3><ul><li><p>「Step.3」：标记「CompactSpan」的三角形归属及地形类型</p><ul><li>判定依据：「CompactSpan」xz-plane 平面的中点是否在三角形内</li><li>中点是否在多边形内的算法代码 ——<span class="exturl" data-url="aHR0cDovL2FsaWVucnlkZXJmbGV4LmNvbS9wb2x5Z29uLw=="> 文章链接</span></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211014120011.png" alt="image-20211014120009824"></p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 过「中点 p」沿着多边形的 x 轴切一刀，和多边形存在左右数个交点</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 必须满足左右交点数量都是奇数的情况下，才表示「中点 p」在多边形内</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">pointInPoly</span><span class="token punctuation">(</span><span class="token keyword">int</span> nvert<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span> verts<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span> p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> nvert<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nvert<span class="token punctuation">;</span> j <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span> vi <span class="token operator">=</span> <span class="token operator">&amp;</span>verts<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span> vj <span class="token operator">=</span> <span class="token operator">&amp;</span>verts<span class="token punctuation">[</span>j<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>vi<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">></span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>vj<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">></span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>			<span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span>vj<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>vi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-</span>vi<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>vj<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-</span>vi<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> vi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>			c <span class="token operator">=</span> <span class="token operator">!</span>c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token keyword">return</span> c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211014141950.png" alt="image-20211014141948988"></p><ul><li>标记「CompactSpan」的地形类型「<a href="#areatype">AreaType</a>」：<ul><li>SAMPLE_POLYAREA_GROUND：地面</li><li>SAMPLE_POLYAREA_WATER：水</li><li>SAMPLE_POLYAREA_ROAD：公路</li><li>SAMPLE_POLYAREA_DOOR：门</li><li>SAMPLE_POLYAREA_GRASS：草地（默认）</li><li>SAMPLE_POLYAREA_JUMP：跳跃点</li></ul></li></ul></li></ul><h3 id="partition-the-heightfield️"><a class="anchor" href="#partition-the-heightfield️">#</a> Partition the heightfield⭐️</h3><p>划分高度场。目前支持的三种高度场划分算法：</p><ul><li>分层算法</li><li>单调分割算法</li><li>分水岭算法</li></ul><h4 id="分层算法"><a class="anchor" href="#分层算法">#</a> 分层算法</h4><p>受到配置项「<a href="#minregionsize">MinRegionSize</a>」影响</p><ul><li><p>「Step.1」：标记所有「CompactSpan」的 <code>region_id</code></p><ul><li>先沿着 <code>z</code> 轴方向标记 <code>region_id</code> ，「<a href="#areatype">AreaType</a>」相同，下个「CompactSpan」继承上个 <code>region_id</code></li><li>同 <code>region_id</code> 的「CompactSpan」视作同一「SweepSpan」</li><li>红绿分别表示不同「<a href="#areatype">AreaType</a>」</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211111181551.png" alt="image-20211111181549158"></p><ul><li>再先沿着 <code>x</code> 轴方向标记 <code>region_id</code> ，「<a href="#areatype">AreaType</a>」相同，下个「SweepSpan」继承上个 <code>region_id</code></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211111184043.png" alt="image-20211111184042132"></p></li></ul><h5 id="mergeandfilterlayerregions"><a class="anchor" href="#mergeandfilterlayerregions">#</a> MergeAndFilterLayerRegions</h5><ul><li><p>「Step.2」：更新「Region」之间的连接关系</p><ul><li>更新 xz-plane 每个「CompactSpan」的四个方向的 <code>connect</code> ，并加入到「Region」</li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Update neighbours</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> dir <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> dir <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>dir<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">rcGetCon</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> dir<span class="token punctuation">)</span> <span class="token operator">!=</span> RC_NOT_CONNECTED<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">const</span> <span class="token keyword">int</span> ax <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token function">rcGetDirOffsetX</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">const</span> <span class="token keyword">int</span> ay <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token function">rcGetDirOffsetY</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">const</span> <span class="token keyword">int</span> ai <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>chf<span class="token punctuation">.</span>cells<span class="token punctuation">[</span>ax<span class="token operator">+</span>ay<span class="token operator">*</span>w<span class="token punctuation">]</span><span class="token punctuation">.</span>index <span class="token operator">+</span> <span class="token function">rcGetCon</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> rai <span class="token operator">=</span> srcReg<span class="token punctuation">[</span>ai<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>rai <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> rai <span class="token operator">&lt;</span> nreg <span class="token operator">&amp;&amp;</span> rai <span class="token operator">!=</span> ri<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        	<span class="token function">addUniqueConnection</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> rai<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// link</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>rai <span class="token operator">&amp;</span> RC_BORDER_REG<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>       		reg<span class="token punctuation">.</span>connectsToBorder <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul><li>再对同 y 轴上的「CompactSpan」两两更新 <code>floor</code> ，并加入到「Region」</li></ul></li><li><p>「Step.3」：DFS 遍历「Region」两两之间 <code>connect</code> 且无 <code>overlap</code> 的情况下，更新两边的 <code>floor</code> 集合</p></li><li><p>「Step.4」：计算通过 <code>connect</code> 合并后 <code>spanCount</code> 数量依旧不满足「<a href="#minregionsize">MinRegionSize</a>」的「Region」</p></li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Remove small regions</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nreg<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>regions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>spanCount <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> regions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>spanCount <span class="token operator">&lt;</span> minRegionArea <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>regions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>connectsToBorder<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    	<span class="token keyword">unsigned</span> <span class="token keyword">short</span> reg <span class="token operator">=</span> regions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> nreg<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    		<span class="token keyword">if</span> <span class="token punctuation">(</span>regions<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">==</span> reg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    			regions<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="单调分割算法"><a class="anchor" href="#单调分割算法">#</a> 单调分割算法</h4><p>受到配置项「<a href="#minregionsize">MinRegionSize</a>」和「<a href="#mergedregionsize">MergedRegionSize</a>」影响</p><ul><li>「Step.1」和「<a href="#%E5%88%86%E5%B1%82%E7%AE%97%E6%B3%95">分层算法</a>的 Step.1」完全一致，用于划分「Region」</li></ul><h5 id="mergeandfilterregions"><a class="anchor" href="#mergeandfilterregions">#</a> MergeAndFilterRegions</h5><ul><li>「Step.2」：按照 y 轴从下往上更新「Region」之间两两的 <code>floor</code> 关系</li><li>「Step.3」：更新「Region」之间的 <code>connect</code> 关系 ——<a href="#walkcontour">WalkContour</a></li></ul><h5 id="walkcontour"><a class="anchor" href="#walkcontour">#</a> WalkContour</h5><p>坚固边缘：处在边界处或者「Region」分割线周围的「CompactSpan」 ，邻居数小于 <code>4</code> 或邻居 <code>region_id</code> 不同</p><ul><li><p>边界区域查询：遍历位于「坚固边缘」的「CompactSpan」</p><ul><li>如果邻居 <code>region_id</code> 不同，那么加入 <code>Region.connections</code> ，并顺时针旋转查询方向，继续查询</li><li>如果邻居非「坚固边缘」那么逆时针旋转方向，继续查询</li></ul></li><li><p>最后对 <code>Region.connections</code> 去重</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211015163523.png" alt="image-20211015163451944"></p></li><li><p>「Step.4」：剔除不满足条件的「Region」</p><ul><li><p>剔除 <code>spancount</code> 小于「<a href="#minregionsize">MinRegionSize</a>」的「Region」</p></li><li><p>「Region」和周围 <code>spancount</code> 最少的「Region」合并，合并条件：</p><ul><li>两者不存在 <code>overlap</code> 关系</li><li>两者都不是边界区域</li><li>其中一方数量 <code>spancount</code> 不超过「<a href="#mergedregionsize">MergedRegionSize</a>」</li></ul></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211022212416.png" alt="image-20211022212415101"></p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">mergeRegions</span><span class="token punctuation">(</span>rcRegion<span class="token operator">&amp;</span> rega<span class="token punctuation">,</span> rcRegion<span class="token operator">&amp;</span> regb<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 1. rega.connections += regb.connections; set(rega.connections)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 2. rega.floors += regb.floors; set(rega.floors)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 3. rega.spanCount += regb.spanCount; regb.spanCount = 0;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul><li>合并后，更新关联了「regb」引用为「rega」</li></ul></li></ul><h4 id="分水岭算法"><a class="anchor" href="#分水岭算法">#</a> 分水岭算法</h4><p>受到配置项「<a href="#minregionsize">MinRegionSize</a>」和「<a href="#mergedregionsize">MergedRegionSize</a>」影响</p><h5 id="calculatedistancefield"><a class="anchor" href="#calculatedistancefield">#</a> CalculateDistanceField</h5><ul><li>「Step.1」：计算场距，效果等价于 <a href="#erodewalkablearea">ErodeWalkableArea</a> ，得到如下的距离场图：<ul><li>左边记录了每个「CompactSpan」的场距</li><li>右边则是每个「CompactSpan」的 <code>region_id</code></li><li>红色方框表示不可达区域</li></ul></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211019195231.png" alt="DistanceField" title="DistanceField"></p><h5 id="boxblur"><a class="anchor" href="#boxblur">#</a> BoxBlur</h5><ul><li>「Step.2」：对九宫格做一个模糊操作，使得场距过渡更加的圆滑</li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 伪代码</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// (sum (九宫格) + 5) / 9</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">boxBlur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    span<span class="token punctuation">.</span>distance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">8</span>个neighbor<span class="token punctuation">.</span>distance<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">/</span> <span class="token number">9</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h5 id="buildregions"><a class="anchor" href="#buildregions">#</a> BuildRegions</h5><ul><li><p>「Step.3」：根据分水岭算法划分「Region」</p><ul><li><p>数据结构介绍：</p><ul><li><code>nbstack</code> ：长度为 8 ，元素是 256 个 <code>LevelStackEntry</code> 的栈</li><li><code>LevelStackEntry</code> ：记录了每个「CompactSpan」的位置信息 <code>[x,y,z]</code></li></ul></li><li><p>从最大场距开始，这里假设是 <code>4</code> ，向下做「漫灌」操作 <code>sortCellsByLevel</code></p><ul><li>距离场每相差 2 个单位归为一层。每层数据被记录在 <code>nbstack</code> 的一个栈元素中</li><li>这里对内存做了一定优化，每次先处理 8 层的「CompactSpan」</li><li>以上图 <code>DistanceField</code> 为例，把场距是 <code>2</code> 和 <code>0</code> 的「CompactSpan」全部入栈</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211019200424.png" alt="image-20211019200422931"></p></li><li><p>遍历 <code>nbstack</code> 的 8 个栈元素</p><ul><li><p>对每个栈做 <code>expandRegions</code> 来扩张「Region」</p></li><li><p>遍历其中一个栈的全部「CompactSpan」</p></li><li><p>如果「CompactSpan」已经有 <code>region_id</code> 则跳过</p></li><li><p>如果「CompactSpan」没有 <code>region_id</code> ，其 <code>region_id</code> 同周围 4 个邻居中场距最小的</p></li><li><p>重复执行 8 次（困惑中🤔）或中途所有的「CompactSpan」都标记了 <code>region_id</code> 则结束</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 伪代码</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> neighbor_span in neighbor<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> negihbor_span<span class="token punctuation">.</span>distance is_min in neighbor<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   		region_id <span class="token operator">=</span> neighbor_span<span class="token punctuation">.</span>region_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		distance <span class="token operator">=</span> neighbor_span<span class="token punctuation">.</span>distance <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ul></li><li><p>再对栈的每个「CompactSpan」做 <code>floodRegion</code> 来「淹没」更高的未被标记区域和第一次初始化区域。</p><ul><li>遍历其中一个栈的全部「CompactSpan」，并设置其 <code>region_id</code> 和 <code>distance</code></li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> span in nbstack<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">~</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    span<span class="token punctuation">.</span>region_id <span class="token operator">=</span> regionId<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	span<span class="token punctuation">.</span>distance <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul><li>DFS 周围 8 个邻居，如果邻居没有 <code>region_id</code> 并且大于自己的场距离（ <code>2</code> ），那么该邻居的 <code>region_id</code> 同自身。注：下图为遍历完 <code>nbstack[0]</code> 的结果。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211019203728.png" alt="image-20211019203727175"></p><ul><li>如果「CompactSpan」周围 8 个邻居有一个已经存在 <code>region_id</code> 了，并且和自己不同，则表示遇到了两个「Region」的边界 —— 如下图右侧 <code>2</code> 周围的一圈 <code>0</code> 。注：下图为遍历完 <code>nbstack[1]</code> 的结果。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211019203821.png" alt="image-20211019203819875"></p><ul><li>边界部分留到下一次处理，最终的边界会跟随「Distance」更小一方的 <code>region_id</code> ，最终结果：</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211019204814.png" alt="image-20211019204813743"></p></li></ul></li><li><p>「Step.4」：又做一遍 <code>expandRegions</code> （困惑中🤔）注释代码后的网格也挺正常，可能处理某些特殊情况</p></li><li><p>「Step.5」同「<a href="#%E5%8D%95%E8%B0%83%E5%88%86%E5%89%B2%E7%AE%97%E6%B3%95">单调分割算法</a>」的「<a href="#mergeandfilterregions">mergeAndFilterRegions</a>」</p></li></ul><h3 id="总结"><a class="anchor" href="#总结">#</a> 总结</h3><p>三种分割算法的优劣描述：</p><ul><li>分层算法：<ul><li>「<a href="#mergeandfilterregions">mergeAndFilterLayerRegions</a>」 先更新的 <code>connect</code> 再更新的 <code>floor</code> ，使得「Region」更加趋于扁平，对于平坦无高耸建筑等层级维度简单的地图较为友好。</li><li>「<a href="#mergeandfilterregions">mergeAndFilterLayerRegions</a>」全量遍历了「CompactSpan」，所以比起「<a href="#%E5%8D%95%E8%B0%83%E5%88%86%E5%89%B2%E7%AE%97%E6%B3%95">单调分割算法</a>」慢</li></ul></li><li>单调分割算法：<ul><li>「<a href="#mergeandfilterregions">mergeAndFilterRegions</a>」先更新的 <code>floor</code> 再更新的 <code>connect</code> ，使得「Region」更加趋于立体，对于复杂多层级的高耸建筑较为合适。</li><li>「<a href="#mergeandfilterregions">mergeAndFilterRegions</a>」对于「CompactSpan」遍历用了 「<a href="#walkcontour">walkContour</a>」 更加效率，所以比起「<a href="#%E5%88%86%E5%B1%82%E7%AE%97%E6%B3%95">分层算法</a>」快。</li></ul></li><li>分水岭算法：<ul><li>划分「Region」用的是「<a href="#erodewalkablearea">ErodeWalkableArea</a>」，等于做了两遍「CompactSpan」遍历，但划分出来的效果相较于「<a href="#%E5%8D%95%E8%B0%83%E5%88%86%E5%89%B2%E7%AE%97%E6%B3%95">单调分割算法</a>」更加的均匀，分界线比较的适中。</li><li>虽然也使用了「<a href="#mergeandfilterregions">mergeAndFilterRegions</a>」，还是会比「<a href="#%E5%88%86%E5%B1%82%E7%AE%97%E6%B3%95">分层算法</a>」慢。</li></ul></li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Partition the heightfield so that we can use simple algorithm later to triangulate the walkable areas.</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// There are 3 martitioning methods, each with some pros and cons:</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 1) Watershed partitioning</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//   - the classic Recast partitioning</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//   - creates the nicest tessellation</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">//   - usually slowest</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">//   - partitions the heightfield into nice regions without holes or overlaps</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">//   - the are some corner cases where this method creates produces holes and overlaps</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">//      - holes may appear when a small obstacles is close to large open area (triangulation can handle this)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">//      - overlaps may occur if you have narrow spiral corridors (i.e stairs), this make triangulation to fail</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">//   * generally the best choice if you precompute the nacmesh, use this if you have large open areas</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// 2) Monotone partioning</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">//   - fastest</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">//   - partitions the heightfield into regions without holes and overlaps (guaranteed)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">//   - creates long thin polygons, which sometimes causes paths with detours</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">//   * use this if you want fast navmesh generation</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// 3) Layer partitoining</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">//   - quite fast</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">//   - partitions the heighfield into non-overlapping regions</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">//   - relies on the triangulation code to cope with holes (thus slower than monotone partitioning)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">//   - produces better triangles than monotone partitioning</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">//   - does not have the corner cases of watershed partitioning</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">//   - can be slow and create a bit ugly tessellation (still better than monotone)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment">//     if you have large open areas with small obstacles (not a problem if you use tiles)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">//   * good choice to use for tiled navmesh with medium and small sized tiles</span></pre></td></tr></table></figure><h2 id="trace-and-simplify-region-contours"><a class="anchor" href="#trace-and-simplify-region-contours">#</a> Trace and simplify region contours</h2><p>计算「Region」的轮廓「Contour」，受到配置项「<a href="#maxedgeerror">MaxEdgeError</a>」和「<a href="#maxedgelength">MaxEdgeLength</a>」影响</p><h3 id="buildcontours"><a class="anchor" href="#buildcontours">#</a> BuildContours</h3><ul><li><p>「Step.1」：以「CompactSpan」为单位，记录和周围「Region」关系 —— <code>flags</code></p><ul><li><p>记录结构为 4 bit，每个 bit 表示一个方向， <code>0</code> 表示同 <code>region_id</code> ， <code>1</code> 表示不同。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>neighbor<span class="token punctuation">.</span>region_id <span class="token operator">==</span> cur<span class="token punctuation">.</span>region_id<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	res <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// dir 0~4</span></pre></td></tr><tr><td data-num="3"></td><td><pre>cur_flag <span class="token operator">=</span> res <span class="token operator">^</span> <span class="token number">0xf</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li></ul></li><li><p>「Step.2」：查找「Region」之间的边界，得到边界顶点轮廓</p><ul><li><p>查询处在边界位置的「CompactSpan」，跳过以下三种情况：</p><ul><li><code>== 0</code> ：周围没有连通 —— 孤岛</li><li><code>== 0xf</code> ：周围都是同 region_id—— 内陆</li><li>自己在分割线上或者没有 <code>region_id</code></li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>flags<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> flags<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0xf</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	flags<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">continue</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>reg <span class="token operator">||</span> <span class="token punctuation">(</span>reg <span class="token operator">&amp;</span> RC_BORDER_REG<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">continue</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li><li><p>对当处在边界位置的「CompactSpan」执行一次 <a href="#walkcontour">WalkContour</a> 查询</p><ul><li>从一个边界方向开始查询，遇到边界后顺时针旋转 90° 继续查询，否则更新位置后逆时针旋转 90° 继续查询</li><li>得到下图蓝色点组成的顶点轮廓</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211101191409.png" alt="image-20211101191407974"></p><ul><li>注意这里获得的轮廓方向，这点很重要，轮廓的顺逆将决定多边形是凸还是凹<ul><li>「Region.1」的内圈轮廓是逆时针的，所以是一个凹多边形</li></ul></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211103162214.png" alt="image-20211103162213091"></p><ul><li>「Region.2」的外圈轮廓是顺时针的，所以是一个凸多边形</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211103162526.png" alt="image-20211103162525886"></p></li></ul></li></ul><h3 id="getcornerheight"><a class="anchor" href="#getcornerheight">#</a> GetCornerHeight</h3><ul><li><p>「Step.3」：获取区域的高度</p><ul><li><p>数据结构： <code>4</code> 个 <code>int</code> 组成的数组， <code>int</code> 前 16 位表示「<a href="#areatype">AreaType</a>」后 16 位表示 <code>region_id</code></p><ul><li><code>[0]</code> ：当前「CompactSpan」</li><li><code>[1]</code> ：当前「CompactSpan」+ <code>dir</code></li><li><code>[2]</code> ：当前「CompactSpan」 <code>+ dir + next_dir</code> or 当前「CompactSpan」 <code>+ next_dir + dir</code></li><li><code>[3]</code> ：当前「CompactSpan」+ <code>next_dir</code></li></ul></li><li><p>如下是每种 <code>dir</code> 对应的 <code>next_dir</code> ：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// dir next_dir</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// ←	↑</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// ↑	→</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// →	↓</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// ↓	←</span></pre></td></tr></table></figure></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211101171108.png" alt="image-20211101171107080"></p><ul><li><p>取四个方位 <code>max(CompactSpan.y)</code> 作为「区域高度」</p></li><li><p>遇边界跳过并打上 <code>RC_BORDER_VERTEX</code> 标记，边界判定规则：</p><ul><li>其中相邻两个「CompactSpan」都是边界，且 <code>region_id</code> 相同</li><li>另外两个「CompactSpan」都不是边界</li><li>另外两个「CompactSpan」的「<a href="#areatype">AreaType</a>」相同</li><li>所有「CompactSpan」都有 <code>region_id</code></li></ul></li></ul></li><li><p>以四个「CompactSpan」的右上方「CompactSpan」的左下角作为坐标点（四个「CompactSpan」的中心位置）并记录高度</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// rcIntArray points(256);</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">switch</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> pz<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> px<span class="token operator">++</span><span class="token punctuation">;</span> pz<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> px<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>px<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// x</span></pre></td></tr><tr><td data-num="9"></td><td><pre>points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>py<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// y</span></pre></td></tr><tr><td data-num="10"></td><td><pre>points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pz<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// z</span></pre></td></tr><tr><td data-num="11"></td><td><pre>points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// negihbor region_id or AREA_BORDER or BORDER_VERTEX</span></pre></td></tr></table></figure></li></ul><h3 id="simplifycontour"><a class="anchor" href="#simplifycontour">#</a> SimplifyContour</h3><ul><li><p>「Step.4」：对得到顶点数组做一个「simplify」。</p><ul><li>简化顶点轮廓<ul><li>把顶点数组内左下角和右上角的点加入「simplify」</li><li>每个点和后一个比较，如果两个点记录的 <code>neighbor.region_id</code> 或「<a href="#areatype">AreaType</a>」相同，则忽略</li><li>结果如下：按理图中所有点的 <code>neighbor.region_id</code> 都相同，所以只记录了左下和右上点</li></ul></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211101195636.png" alt="SimplifyVex" title="SimplifyVex"></p></li></ul><h3 id="distanceptseg"><a class="anchor" href="#distanceptseg">#</a> DistancePtSeg</h3><p>计算点到线段距离，如果点和线段没有垂线交点，那么按照点和线段两头的最小距离作为点到线段距离</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">float</span> <span class="token function">distancePtSeg</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> z<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre>						   <span class="token keyword">const</span> <span class="token keyword">int</span> px<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> pz<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>						   <span class="token keyword">const</span> <span class="token keyword">int</span> qx<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> qz<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">float</span> pqx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span>qx <span class="token operator">-</span> px<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">float</span> pqz <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span>qz <span class="token operator">-</span> pz<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">float</span> dx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x <span class="token operator">-</span> px<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token keyword">float</span> dz <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span>z <span class="token operator">-</span> pz<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token keyword">float</span> d <span class="token operator">=</span> pqx<span class="token operator">*</span>pqx <span class="token operator">+</span> pqz<span class="token operator">*</span>pqz<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">float</span> t <span class="token operator">=</span> pqx<span class="token operator">*</span>dx <span class="token operator">+</span> pqz<span class="token operator">*</span>dz<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>		t <span class="token operator">/=</span> d<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		t <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	</pre></td></tr><tr><td data-num="18"></td><td><pre>	dx <span class="token operator">=</span> px <span class="token operator">+</span> t<span class="token operator">*</span>pqx <span class="token operator">-</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	dz <span class="token operator">=</span> pz <span class="token operator">+</span> t<span class="token operator">*</span>pqz <span class="token operator">-</span> z<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	</pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token keyword">return</span> dx<span class="token operator">*</span>dx <span class="token operator">+</span> dz<span class="token operator">*</span>dz<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211109143656.png" alt="image-20211109143647366"></p><ul><li><p>「Step.4.1」：把距离误差过大的点加回「simplify」</p><ul><li>先按照顶点顺序进行排序</li><li>最大距离（ <code>C_3</code> 到 <code>AB</code> 线段）如果超过「<a href="#maxedgeerror">MaxEdgeError</a>」则把 <code>C_3</code> 也加入「simplify」数组</li><li>再次执行排序和计算距离，直到没有点到直线距离超过「<a href="#maxedgeerror">MaxEdgeError</a>」，则进行下一组顶点计算</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211101200427.png" alt="image-20211101200425525"></p></li><li><p>「Step.4.2」：对「simplify」中两点所组成的过长边进行切分。</p><ul><li><p>切分有两种，一种是切分贴墙的边，一种是切分「<a href="#areatype">AreaType</a>」的分界线，默认是切墙</p></li><li><p>相邻两个「simplify」中点的欧式距离超过「<a href="#maxedgelength">MaxEdgeLength</a>」且中间有省略的点，则进行切分</p><ul><li>切分规则直接查询两点中间编号的点作为中点，此处以 <code>C_1</code> 为中点切分</li><li>把 <code>C_1</code> 加入「simplify」并再次判断距离直到全部满足条件</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211101202713.png" alt="image-20211101202712192"></p></li><li><p>「Step.4.3」：更新「simplify」中点的数据</p><ul><li>继承自生的「边界标记」 <code>BORDER_VERTEX</code> 并继承下一个节点的「区域类型标记」 <code>AREA_BORDER</code></li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> simplified<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// The edge vertex flag is take from the current raw point,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// and the neighbour region is take from the next raw point.</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">const</span> <span class="token keyword">int</span> ai <span class="token operator">=</span> <span class="token punctuation">(</span>simplified<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> pn<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">const</span> <span class="token keyword">int</span> bi <span class="token operator">=</span> simplified<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    simplified<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span>ai<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>RC_CONTOUR_REG_MASK<span class="token operator">|</span>RC_AREA_BORDER<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span>bi<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> RC_BORDER_VERTEX<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ul></li><li><p>「Step.4.4」： <code>removeDegenerateSegments</code> ， 剔除重叠顶点，同「Region」内 xz 坐标相同的点只保留一个</p></li><li><p>「Step.5」：记录「Region」简化后的顶点轮廓数组，最终结果如下：</p></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211101204557.png" alt="Simplify" title="Simplify"></p><ul><li><p>「Step.6」：通过多边形面积计算，判断凹凸，并计算凹多边形和凸多边形顶点直线距离</p><ul><li><code>calcAreaOfPolygon2D</code> 计算多边形 xz-plane 上的面积，这里用于辨别多边形是否是凸多边形，<a href="#https://blog.csdn.net/Mikchy/article/details/81490908">参考链接</a></li><li>也可以通过多边形是顺时针还是逆时针辨别，逆时针是凹多边形，顺时针是凸多边形</li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">calcAreaOfPolygon2D</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> verts<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> nverts<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">int</span> area <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> nverts<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nverts<span class="token punctuation">;</span> j<span class="token operator">=</span>i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> vi <span class="token operator">=</span> <span class="token operator">&amp;</span>verts<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> vj <span class="token operator">=</span> <span class="token operator">&amp;</span>verts<span class="token punctuation">[</span>j<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		area <span class="token operator">+=</span> vi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> vj<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> vj<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> vi<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">return</span> <span class="token punctuation">(</span>area<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// > 0 is outlines else holes</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ul><h3 id="mergeregionholes"><a class="anchor" href="#mergeregionholes">#</a> MergeRegionHoles</h3><ul><li><p>「Step.7」：如果「Region」存在一个凸多边形和多个凹多边形，则进行合并 <code>mergeRegionHoles</code> ，<span class="exturl" data-url="aHR0cDovL3d3dy5naXNza3kubmV0L3BhcGVyL1VwbG9hZEZpbGVzXzQ0OTUvMjAxMjA3LzIwMTIwNzE4MTMxNzEwMzUucGRm">参考链接</span></p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211102153545.png" alt="image-20211102153535968"></p></li><li><p>「Step.7.1」：根据左下角顶点大小对凹多边形进行排序 <code>findLeftMostVertex</code></p></li></ul><h3 id="incone"><a class="anchor" href="#incone">#</a> InCone</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">bool</span>	<span class="token function">inCone</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> verts<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> pj<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> pi <span class="token operator">=</span> <span class="token operator">&amp;</span>verts<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> pi1 <span class="token operator">=</span> <span class="token operator">&amp;</span>verts<span class="token punctuation">[</span><span class="token function">next</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> pin1 <span class="token operator">=</span> <span class="token operator">&amp;</span>verts<span class="token punctuation">[</span><span class="token function">prev</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token comment">// If P[i] is a convex vertex [ i+1 left or on (i-1,i) ].</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">leftOn</span><span class="token punctuation">(</span>pin1<span class="token punctuation">,</span> pi<span class="token punctuation">,</span> pi1<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		<span class="token keyword">return</span> <span class="token function">left</span><span class="token punctuation">(</span>pi<span class="token punctuation">,</span> pj<span class="token punctuation">,</span> pin1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">left</span><span class="token punctuation">(</span>pj<span class="token punctuation">,</span> pi<span class="token punctuation">,</span> pi1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token comment">// Assume (i-1,i,i+1) not collinear.</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token comment">// else P[i] is reflex.</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">leftOn</span><span class="token punctuation">(</span>pi<span class="token punctuation">,</span> pj<span class="token punctuation">,</span> pi1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">leftOn</span><span class="token punctuation">(</span>pj<span class="token punctuation">,</span> pi<span class="token punctuation">,</span> pin1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>有两种满足 inCone 的情况：</p><ul><li>【Con.1 right】：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>p</mi><mi>i</mi><mi>n</mi><mn>1</mn><mi>p</mi><mi>i</mi></mrow><mo stretchy="true">→</mo></mover><mo>×</mo><mover accent="true"><mrow><mi>p</mi><mi>i</mi><mi>n</mi><mn>1</mn><mi>p</mi><mi>i</mi><mn>1</mn></mrow><mo stretchy="true">→</mo></mover><mo>&gt;</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\overrightarrow{pin1pi} \times \overrightarrow{pin1pi1} &gt;= 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.37596em;vertical-align:-.19444em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1815200000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord">1</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span></span></span><span class="svg-align" style="top:-3.65952em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="height:.522em;min-width:.888em"><svg width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.19444em"><span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.37596em;vertical-align:-.19444em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1815200000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord">1</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord">1</span></span></span><span class="svg-align" style="top:-3.65952em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="height:.522em;min-width:.888em"><svg width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.19444em"><span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:.36687em;vertical-align:0"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span>：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>p</mi><mi>i</mi><mi>n</mi><mn>1</mn><mi>p</mi><mi>i</mi></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{pin1pi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.37596em;vertical-align:-.19444em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1815200000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord">1</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span></span></span><span class="svg-align" style="top:-3.65952em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="height:.522em;min-width:.888em"><svg width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.19444em"><span></span></span></span></span></span></span></span></span> 顺时针旋转到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>p</mi><mi>i</mi><mi>n</mi><mn>1</mn><mi>p</mi><mi>i</mi><mn>1</mn></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{pin1pi1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.37596em;vertical-align:-.19444em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1815200000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord">1</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord">1</span></span></span><span class="svg-align" style="top:-3.65952em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="height:.522em;min-width:.888em"><svg width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.19444em"><span></span></span></span></span></span></span></span></span> 的夹角 ＞ 180°<ul><li>点 <code>pj</code> 在区域①、③、④满足条件</li></ul></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211103152752.png" alt="right"></p><ul><li>【Con.2 left】：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>p</mi><mi>i</mi><mi>n</mi><mn>1</mn><mi>p</mi><mi>i</mi></mrow><mo stretchy="true">→</mo></mover><mo>×</mo><mover accent="true"><mrow><mi>p</mi><mi>i</mi><mi>n</mi><mn>1</mn><mi>p</mi><mi>i</mi><mn>1</mn></mrow><mo stretchy="true">→</mo></mover><mo>&lt;</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\overrightarrow{pin1pi} \times \overrightarrow{pin1pi1} &lt;= 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.37596em;vertical-align:-.19444em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1815200000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord">1</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span></span></span><span class="svg-align" style="top:-3.65952em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="height:.522em;min-width:.888em"><svg width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.19444em"><span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.37596em;vertical-align:-.19444em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1815200000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord">1</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord">1</span></span></span><span class="svg-align" style="top:-3.65952em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="height:.522em;min-width:.888em"><svg width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.19444em"><span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&lt;</span></span><span class="base"><span class="strut" style="height:.36687em;vertical-align:0"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span>： <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>p</mi><mi>i</mi><mi>n</mi><mn>1</mn><mi>p</mi><mi>i</mi></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{pin1pi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.37596em;vertical-align:-.19444em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1815200000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord">1</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span></span></span><span class="svg-align" style="top:-3.65952em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="height:.522em;min-width:.888em"><svg width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.19444em"><span></span></span></span></span></span></span></span></span> 顺时针旋转到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>p</mi><mi>i</mi><mi>n</mi><mn>1</mn><mi>p</mi><mi>i</mi><mn>1</mn></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{pin1pi1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.37596em;vertical-align:-.19444em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1815200000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord">1</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord">1</span></span></span><span class="svg-align" style="top:-3.65952em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="height:.522em;min-width:.888em"><svg width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.19444em"><span></span></span></span></span></span></span></span></span> 的夹角 ≤ 180°<ul><li>点 <code>pj</code> 在区域①满足条件</li></ul></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211105181050.png" alt="left"></p><ul><li><p>「Step.7.2」：计算凸多边形连续顶点 <code>pi</code> 、 <code>pin1</code> 、 <code>pi1</code> 与凹多边形的任意点 <code>pj</code> 「<a href="#incone">InCone</a>」关系</p><ul><li>计算满足 「<a href="#incone">InCone</a>」 关系的顶点（凹多边形顶点在凸多边形内）的欧式距离 <code>dist(pi, pj)</code> 。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211102221432.png" alt="image-20211102221431191"></p><ul><li>计算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>p</mi><mi>i</mi><mi>p</mi><mi>j</mi></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{pipj}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.37596em;vertical-align:-.19444em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1815200000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:.05724em">j</span></span></span><span class="svg-align" style="top:-3.65952em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="height:.522em;min-width:.888em"><svg width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.19444em"><span></span></span></span></span></span></span></span></span> 和其他边是否相交 —— <code>intersectSegCountour</code> <span class="exturl" data-url="aHR0cHM6Ly93d3cuZ2Vla3Nmb3JnZWVrcy5vcmcvY2hlY2staWYtdHdvLWdpdmVuLWxpbmUtc2VnbWVudHMtaW50ZXJzZWN0Lw==">参考链接</span></li><li>不存在相交情况则记录下该凸多边形顶点 <code>pj</code> ，并把该凹多边形合并到凸多边形内 <a href="#mergecontours">MergeContours</a></li></ul></li></ul><h3 id="mergecontours"><a class="anchor" href="#mergecontours">#</a> MergeContours</h3><ul><li><p>「Step.8」：合并凹多边形到凸多边形内</p><ul><li>把所有凹多边形顶点拷贝到凸多边形顶点集内，顺带更新一下凸多边形顶点数量。</li><li><code>new_outline_vec_count = old_hole_vec_count + old_outline_vec_count + 2</code></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211103100712.png" alt="MergeContours"></p></li></ul><h2 id="build-polygons-mesh-from-contours"><a class="anchor" href="#build-polygons-mesh-from-contours">#</a> Build polygons mesh from contours</h2><p>通过「Region」的「Countour，构建「Mesh」，受到配置项「<a href="#vertsperpoly">VertsPerPoly</a>」影响</p><h3 id="buildpolymesh"><a class="anchor" href="#buildpolymesh">#</a> BuildPolyMesh</h3><ul><li><p>「Step.1」：遍历所有的「Countour」，找出所有的「切割点」 <code>diagonal</code></p><ul><li>取其中连续的四个顶点 <code>pin1</code> 、 <code>pi</code> 、 <code>pi1</code> 、 <code>pj</code></li><li>如果 <code>pin1</code> 、 <code>pi</code> 、 <code>pi1</code> 和 <code>pj</code> 满足「<a href="#incone">InCone</a>」关系，且不和自身的任意边相交</li><li>那么 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>p</mi><mi>i</mi><mi>p</mi><mi>j</mi></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{pipj}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.37596em;vertical-align:-.19444em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1815200000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:.05724em">j</span></span></span><span class="svg-align" style="top:-3.65952em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="height:.522em;min-width:.888em"><svg width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.19444em"><span></span></span></span></span></span></span></span></span> 一定是多边形内部的一个角平分线</li><li>下图中④、⑤都和自身边相交，②不满足「<a href="#incone">InCone</a>」关系，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">△</mi><mrow><mi>B</mi><mi>C</mi><mi>D</mi></mrow></mrow><annotation encoding="application/x-tex">\triangle{BCD}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord">△</span><span class="mord"><span class="mord mathnormal" style="margin-right:.05017em">B</span><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="mord mathnormal" style="margin-right:.02778em">D</span></span></span></span></span> 是凸多边形，E 在其外部</li><li>因此符合条件的只有①、③，对应的切割点是 <code>C</code> and <code>E</code></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211103181047.png" alt="image-20211103181045755"></p></li><li><p>「Step.2」：遍历所有满足条件的「切割点」，从相邻顶点距离最小的「切割点」开始切割，并对得到的两个多边形分别计算一次「切割点」 <code>diagonal</code> ，并继续切割，直到所有的「切割点」都被切掉</p><ul><li>这里还有个小瑕疵：如果存在轮廓重叠的情况下， <code>diagonal</code> 将找不出重叠部分的「切割点」这时需要把重叠情况也考虑进来，用 <code>diagonalLoose</code> 再做一次「切割点」计算</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211104110417.png" alt="image-20211104110416439"></p></li><li><p>「Step.3」：对顶点去重，并把三角形合并为多边形，合并条件如下：</p><ul><li>合并后的多边形顶点数不超过「<a href="#vertsperpoly">VertsPerPoly</a>」</li><li>合并的两个多边形有一条公共边</li><li>合并后的多边形必须是凸多边形</li></ul></li><li><p>「Step.4」：尝试移除带有边界标记 <code>RC_BORDER_VERTEX</code> 的顶点</p><ul><li>判断移除条件 <code>canRemoveVertex</code> ：<ul><li>剔除顶点后的的多边形边长要超过 <code>3</code></li><li>剔除顶点关联的非共享边不超过 <code>3</code></li></ul></li><li>剔除顶点操作 <code>removeVertex</code> ：<ul><li>删除顶点数据和关联顶点的多边形</li><li>重新按照边的首尾顺序拼接出新的多边形</li><li>对新的多边形进行切割及合并，参考「Step.1」、「Step.2」、「Step.3」</li><li>把新的多边形加入多边形集合</li></ul></li></ul></li><li><p>「Step.5」：计算多边形之间的相邻关系 <code>buildMeshAdjacency</code></p></li></ul><h2 id="create-detail-mesh-which-allows-to-access-approximate-height-on-each-polygon"><a class="anchor" href="#create-detail-mesh-which-allows-to-access-approximate-height-on-each-polygon">#</a> Create detail mesh which allows to access approximate height on each polygon</h2><p>根据采样步长和误差值把多边形细分成误差可接受范围内的三角形，受到配置项「<a href="#sampledistance">SampleDistance</a>」和「<a href="#maxsampleerror">MaxSampleError</a>」影响</p><h3 id="buildpolymeshdetail"><a class="anchor" href="#buildpolymeshdetail">#</a> BuildPolyMeshDetail</h3><ul><li><p>「Step.1」：计算所有多边形的 xz 平面上包围盒，以及每个多边形自身的包围盒</p></li><li><p>「Step.2」：计算多边形包围盒的各个单位点的高度值 <code>getHeightData</code> ，高度取值用位于该点的同 <code>region_id</code> 的「CompactSpan」上表面坐标 <code>CompactSpan.y</code></p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211105172709.png" alt="image-20211105172700890"></p><ul><li>如果一个多边形包围盒内没有任何「CompactSpan」的 <code>region_id</code> 相同，说明该多边形和其他多边形存在重叠， <code>region_id</code> 用了其他多边形的，因此采用 <code>seedArrayWithPolyCenter</code> 采样法<ul><li>首先查询所有「CompactSpan」，计算和多边形表面最接近的「CompactSpan」，并且从该「CompactSpan」出发遍历相邻「CompactSpan」，直到靠近多边形中点的「CompactSpan」，并用该中心点的「CompactSpan」上表面作为多边形中心点高度</li></ul></li></ul></li></ul><h3 id="buildpolydetail"><a class="anchor" href="#buildpolydetail">#</a> BuildPolyDetail</h3><ul><li><p>「Step.3」：切割多边形的边</p><ul><li>根据「<a href="#sampledistance">SampleDistance</a>」计算每条边的「切割点」，并计算「切割点」高度 <code>getHeight</code><ul><li>获取「切割点」对应的「CompactSpan」上表面高度</li><li>如果「切割点」本身没有对应的「CompactSpan」或者「CompactSpan」没有高度标记</li><li>则取周围一圈 <code>8</code> 个「CompactSpan」误差最小的高度</li><li>如果还是没有则再往外扩一圈，直到遇见一个有高度标记的「CompactSpan」作为该点高度</li></ul></li><li>计算所有「切割点」到边的距离，如果距离超过「<a href="#maxsampleerror">MaxSampleError</a>」则可以进行切割<ul><li>把「切割点」加入边顶点集合，并对新的顶点再次两个为边长计算到「切割点」距离</li><li>直到所有「切割点」都满足「<a href="#maxsampleerror">MaxSampleError</a>」或者切割定点数达到了 <code>32</code> 则终止。</li></ul></li><li>下图为单个边长切割流程<ul><li>红点：初始边长的顶点</li><li>绿点：需要尝试切割的点</li><li>蓝点：「切割点」的实际 <code>y</code> 坐标取值</li><li>虚线：「切割点」到边长的距离</li></ul></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211109153218.png" alt="image-20211109153216385"></p></li><li><p>「Step.4」：通过获得的「切割点」，对多边形进行切割</p><ul><li>切割算法： <code>triangulateHull</code><ul><li>取周长最小的三个连续顶点组成的三角形为起点开始切割</li><li>对比左右两个点 <code>nleft</code> 、 <code>nright</code> 到 <code>left</code> 、 <code>right</code> 的距离</li><li>其中最短的距离和作为下一个被切分出的三角形 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">△</mi><mrow><msub><mi>p</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><msub><mi>p</mi><mrow><mi>n</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><msub><mi>p</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></mrow></mrow><annotation encoding="application/x-tex">\triangle{p_{left}p_{nright}p_{right}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.980548em;vertical-align:-.286108em"></span><span class="mord">△</span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361079999999999em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.01968em">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:.10764em">f</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361079999999999em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:.03588em">g</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361079999999999em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:.03588em">g</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span></span></span></li><li>更新 <code>nright</code> 为 <code>right</code> 继续切割，直到所有「切割点」都被切割完毕</li></ul></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211109195728.png" alt="image-20211109195727268" title="triangulateHull"></p></li><li><p>「Step.5」：计算多边形的任意点到任意边线段的最短距离，仅计算分割前，不考虑 <code>y</code> 坐标，如果距离大于「<a href="#sampledistance">SampleDistance</a>」说明多边形较大，需要新增内部点来做进一步细化的切割</p><ul><li>根据 xz-plane 按照「<a href="#sampledistance">SampleDistance</a>」为大小，网格化多边形</li><li>筛选掉靠近多边形边的网格点</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211109200042.png" alt="image-20211109200041422"></p><ul><li><p>对剩下的点进行 <code>jittered</code> 采样，随机取点周围 <code>[-1, 1]</code> 偏移范围内的一点作为采样点计算采样点到所有切割出的三角形的距离最大值 <code>distToTriMesh</code></p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">float</span> <span class="token function">getJitterX</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">0x8da6b343</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffff</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">65535.0f</span> <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1.0f</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">float</span> <span class="token function">getJitterY</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">0xd8163841</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffff</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">65535.0f</span> <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1.0f</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul><li>计算采样点投影到三角形平面上的重心坐标 <code>u,v</code> ，<a href="https://hakuya.me/learning/games/Game101/%E4%B9%9D%E3%80%81Shading%EF%BC%88%E4%B8%8B%EF%BC%89%E2%80%94%E2%80%94Texture%20Mapping%20Cont/">重心坐标介绍</a></li><li>把中心坐标和采样点坐标的 y 轴差值作为采样点到三角形平面的距离</li><li>如果重心坐标落在三角形外，则距离为 <code>-1</code></li><li>如果距离最大的点超过了「<a href="#maxsampleerror">MaxSampleError</a>」，那边把该点新增到多边形</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211109175319.png" alt="image-20211109175317781"></p></li></ul></li></ul><h3 id="delaunayhull"><a class="anchor" href="#delaunayhull">#</a> DelaunayHull</h3><ul><li><p>「Step.6」重新建立切分后的三角形布局</p><ul><li>处理所有的顶点，根据相邻点建立连线，计算出线段和任意点组成的外接圆 <a href="#circumcircle">CircumCircle</a>，如果外接圆内不包含其它点，将组成该外接圆的三个点作为三角形的三个顶点，否则取连线和外接圆内的点生成更小的外接圆</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211109192516.png" alt="image-20211109192515449"></p><ul><li>把所有组成三角形的边记录下来，并记录边两侧的三角形编号 <code>completeFacet</code></li></ul></li></ul><h3 id="circumcircle"><a class="anchor" href="#circumcircle">#</a> CircumCircle</h3><p>构建三角形的外接圆，以 <code>p1</code> 为原点，计算两条边中垂线的交点，返回圆心和半径。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20211109182138.png" alt="image-20211109182137237"></p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">circumCircle</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span> p1<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span> p2<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span> p3<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre>						 <span class="token keyword">float</span><span class="token operator">*</span> c<span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token operator">&amp;</span> r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">float</span> EPS <span class="token operator">=</span> <span class="token number">1e-6f</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token comment">// Calculate the circle relative to p1, to avoid some precision issues.</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">float</span> v1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">float</span> v2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v3<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token function">rcVsub</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> p2<span class="token punctuation">,</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token function">rcVsub</span><span class="token punctuation">(</span>v3<span class="token punctuation">,</span> p3<span class="token punctuation">,</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">float</span> cp <span class="token operator">=</span> <span class="token function">vcross2</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fabsf</span><span class="token punctuation">(</span>cp<span class="token punctuation">)</span> <span class="token operator">></span> EPS<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">float</span> v1Sq <span class="token operator">=</span> <span class="token function">vdot2</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">float</span> v2Sq <span class="token operator">=</span> <span class="token function">vdot2</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">float</span> v3Sq <span class="token operator">=</span> <span class="token function">vdot2</span><span class="token punctuation">(</span>v3<span class="token punctuation">,</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>v1Sq<span class="token operator">*</span><span class="token punctuation">(</span>v2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-</span>v3<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> v2Sq<span class="token operator">*</span><span class="token punctuation">(</span>v3<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-</span>v1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> v3Sq<span class="token operator">*</span><span class="token punctuation">(</span>v1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-</span>v2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>cp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		c<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		c<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>v1Sq<span class="token operator">*</span><span class="token punctuation">(</span>v3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>v2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> v2Sq<span class="token operator">*</span><span class="token punctuation">(</span>v1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>v3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> v3Sq<span class="token operator">*</span><span class="token punctuation">(</span>v2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>v1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>cp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		r <span class="token operator">=</span> <span class="token function">vdist2</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token function">rcVadd</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> c<span class="token punctuation">,</span> p1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	</pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token function">rcVcopy</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> p1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="create-detour-data-from-recast-poly-mesh"><a class="anchor" href="#create-detour-data-from-recast-poly-mesh">#</a> Create Detour data from Recast poly mesh</h2><h3 id="createnavmeshdata"><a class="anchor" href="#createnavmeshdata">#</a> CreateNavMeshData</h3><p>把之前得到的数据调整一下数据结构进行存储</p><ul><li>「Step.1」Store header</li><li>「Step.2」Store vertices</li><li>「Step.3」Store polygons</li><li>「Step.4」Store detail meshes and vertices</li></ul><h3 id="createbvtree"><a class="anchor" href="#createbvtree">#</a> CreateBVTree</h3><p>构建 BVTree</p><ul><li>「Step.5」Store and create BVtree<ul><li>按照某个坐标轴进行二分划分空间，计算两边的 AABB 和「Poly」</li></ul></li></ul><h3 id="initnavmesh"><a class="anchor" href="#initnavmesh">#</a> InitNavMesh</h3><ul><li>「Step.6」初始化 navMesh，构建「Tile」，由于用的是「SoloMesh」方式，tile 只有 1 个，没啥操作</li></ul><h3 id="initnavquery"><a class="anchor" href="#initnavquery">#</a> InitNavQuery</h3><ul><li>「Step.7」初始化 navQuery，处理一下查询结构是否内存足够，不够的话 resize 一下，也没啥操作</li></ul><div class="tags"><a href="/tags/Recast-Navigation/" rel="tag"><i class="ic i-tag"></i> Recast Navigation</a> <a href="/tags/SoloMesh/" rel="tag"><i class="ic i-tag"></i> SoloMesh</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-12-29 09:36:04" itemprop="dateModified" datetime="2022-12-29T09:36:04+08:00">2022-12-29</time> </span><span id="learning/recastnavigation/SoloMesh/" class="item leancloud_visitors" data-flag-title="SoloMesh" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 充电</button><p>请我[恰饭]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="鑫酱(●'◡'●) 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="鑫酱(●'◡'●) 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>鑫酱(●'◡'●) <i class="ic i-at"><em>@</em></i>鑫酱</li><li class="link"><strong>本文链接：</strong> <a href="https://hakuya.me/learning/recastnavigation/SoloMesh/" title="SoloMesh">https://hakuya.me/learning/recastnavigation/SoloMesh/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/algorithm/random/random_number/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;wallpaper-1255596461.cos.ap-nanjing.myqcloud.com&#x2F;wallpaper (2).jpg" title="随机数测试"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 随机</span><h3>随机数测试</h3></a></div><div class="item right"><a href="/learning/recastnavigation/3D%E5%AF%BB%E8%B7%AFNavBound/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;wallpaper-1255596461.cos.ap-nanjing.myqcloud.com&#x2F;wallpaper_1.jpg" title="3D寻路NavBound"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 导航网格</span><h3>3D寻路NavBound</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#solomesh"><span class="toc-number">1.</span> <span class="toc-text">SoloMesh</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#initialize-build-config"><span class="toc-number">1.1.</span> <span class="toc-text">Initialize build config</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rasterization"><span class="toc-number">1.1.1.</span> <span class="toc-text">Rasterization</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cellsize"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">CellSize</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cellheight"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">CellHeight</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#voxels"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">Voxels</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#agent"><span class="toc-number">1.1.2.</span> <span class="toc-text">Agent</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#height"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">Height</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#radius"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">Radius</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#maxclimb"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">MaxClimb</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#maxslop"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">MaxSlop</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#region"><span class="toc-number">1.1.3.</span> <span class="toc-text">Region</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#minregionsize"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">MinRegionSize</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mergedregionsize"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">MergedRegionSize</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#partioning"><span class="toc-number">1.1.4.</span> <span class="toc-text">Partioning</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filtering"><span class="toc-number">1.1.5.</span> <span class="toc-text">Filtering</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#polygonization"><span class="toc-number">1.1.6.</span> <span class="toc-text">Polygonization</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#maxedgelength"><span class="toc-number">1.1.6.1.</span> <span class="toc-text">MaxEdgeLength</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#maxedgeerror"><span class="toc-number">1.1.6.2.</span> <span class="toc-text">MaxEdgeError</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vertsperpoly"><span class="toc-number">1.1.6.3.</span> <span class="toc-text">VertsPerPoly</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#detail-mesh"><span class="toc-number">1.1.7.</span> <span class="toc-text">Detail Mesh</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sampledistance"><span class="toc-number">1.1.7.1.</span> <span class="toc-text">SampleDistance</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#maxsampleerror"><span class="toc-number">1.1.7.2.</span> <span class="toc-text">MaxSampleError</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#convexvolumetool-%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.8.</span> <span class="toc-text">ConvexVolumeTool 相关配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#areatype"><span class="toc-number">1.1.8.1.</span> <span class="toc-text">AreaType</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rasterize-input-polygon-soup"><span class="toc-number">1.2.</span> <span class="toc-text">Rasterize input polygon soup</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rasterizetriangles"><span class="toc-number">1.2.1.</span> <span class="toc-text">RasterizeTriangles</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dividepoly"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">DividePoly</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#filter-walkables-surfaces"><span class="toc-number">1.3.</span> <span class="toc-text">Filter walkables surfaces</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#low-hanging-obstacles"><span class="toc-number">1.3.1.</span> <span class="toc-text">Low Hanging Obstacles</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ledge-spans"><span class="toc-number">1.3.2.</span> <span class="toc-text">Ledge Spans</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#walkable-low-height-spans"><span class="toc-number">1.3.3.</span> <span class="toc-text">Walkable Low Height Spans</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#partition-walkable-surface-to-simple-regions"><span class="toc-number">1.4.</span> <span class="toc-text">Partition walkable surface to simple regions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#buildcompactheightfield"><span class="toc-number">1.4.1.</span> <span class="toc-text">BuildCompactHeightfield</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#erodewalkablearea"><span class="toc-number">1.4.2.</span> <span class="toc-text">ErodeWalkableArea</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#markconvexpolyarea"><span class="toc-number">1.4.3.</span> <span class="toc-text">MarkConvexPolyArea</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#partition-the-heightfield%EF%B8%8F"><span class="toc-number">1.4.4.</span> <span class="toc-text">Partition the heightfield⭐️</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E7%AE%97%E6%B3%95"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">分层算法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#mergeandfilterlayerregions"><span class="toc-number">1.4.4.1.1.</span> <span class="toc-text">MergeAndFilterLayerRegions</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E8%B0%83%E5%88%86%E5%89%B2%E7%AE%97%E6%B3%95"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">单调分割算法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#mergeandfilterregions"><span class="toc-number">1.4.4.2.1.</span> <span class="toc-text">MergeAndFilterRegions</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#walkcontour"><span class="toc-number">1.4.4.2.2.</span> <span class="toc-text">WalkContour</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%B0%B4%E5%B2%AD%E7%AE%97%E6%B3%95"><span class="toc-number">1.4.4.3.</span> <span class="toc-text">分水岭算法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#calculatedistancefield"><span class="toc-number">1.4.4.3.1.</span> <span class="toc-text">CalculateDistanceField</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#boxblur"><span class="toc-number">1.4.4.3.2.</span> <span class="toc-text">BoxBlur</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#buildregions"><span class="toc-number">1.4.4.3.3.</span> <span class="toc-text">BuildRegions</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.4.5.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#trace-and-simplify-region-contours"><span class="toc-number">1.5.</span> <span class="toc-text">Trace and simplify region contours</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#buildcontours"><span class="toc-number">1.5.1.</span> <span class="toc-text">BuildContours</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getcornerheight"><span class="toc-number">1.5.2.</span> <span class="toc-text">GetCornerHeight</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#simplifycontour"><span class="toc-number">1.5.3.</span> <span class="toc-text">SimplifyContour</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#distanceptseg"><span class="toc-number">1.5.4.</span> <span class="toc-text">DistancePtSeg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mergeregionholes"><span class="toc-number">1.5.5.</span> <span class="toc-text">MergeRegionHoles</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#incone"><span class="toc-number">1.5.6.</span> <span class="toc-text">InCone</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mergecontours"><span class="toc-number">1.5.7.</span> <span class="toc-text">MergeContours</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#build-polygons-mesh-from-contours"><span class="toc-number">1.6.</span> <span class="toc-text">Build polygons mesh from contours</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#buildpolymesh"><span class="toc-number">1.6.1.</span> <span class="toc-text">BuildPolyMesh</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#create-detail-mesh-which-allows-to-access-approximate-height-on-each-polygon"><span class="toc-number">1.7.</span> <span class="toc-text">Create detail mesh which allows to access approximate height on each polygon</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#buildpolymeshdetail"><span class="toc-number">1.7.1.</span> <span class="toc-text">BuildPolyMeshDetail</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#buildpolydetail"><span class="toc-number">1.7.2.</span> <span class="toc-text">BuildPolyDetail</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delaunayhull"><span class="toc-number">1.7.3.</span> <span class="toc-text">DelaunayHull</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#circumcircle"><span class="toc-number">1.7.4.</span> <span class="toc-text">CircumCircle</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#create-detour-data-from-recast-poly-mesh"><span class="toc-number">1.8.</span> <span class="toc-text">Create Detour data from Recast poly mesh</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#createnavmeshdata"><span class="toc-number">1.8.1.</span> <span class="toc-text">CreateNavMeshData</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#createbvtree"><span class="toc-number">1.8.2.</span> <span class="toc-text">CreateBVTree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#initnavmesh"><span class="toc-number">1.8.3.</span> <span class="toc-text">InitNavMesh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#initnavquery"><span class="toc-number">1.8.4.</span> <span class="toc-text">InitNavQuery</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/learning/recastnavigation/Recast%20Navigation/" rel="bookmark" title="Recast Navigation">Recast Navigation</a></li><li class="active"><a href="/learning/recastnavigation/SoloMesh/" rel="bookmark" title="SoloMesh">SoloMesh</a></li><li><a href="/learning/recastnavigation/3D%E5%AF%BB%E8%B7%AFNavBound/" rel="bookmark" title="3D寻路NavBound">3D寻路NavBound</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="鑫酱(●'◡'●)" data-src="/images/avatar.jpg"><p class="name" itemprop="name">鑫酱(●'◡'●)</p><div class="description" itemprop="description">整天摸鱼，却妄想拯救世界的技术宅</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">100</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">24</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">53</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FsbGVuR1g=" title="https:&#x2F;&#x2F;github.com&#x2F;AllenGX"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTgwNTM4MjQy" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;80538242"><i class="ic i-cloud-music"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjE0MTM5MDcxNTNAcXEuY29t" title="mailto:1413907153@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>好友</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>网址</a></li><li class="item"><a href="/travellings/" rel="section"><i class="ic i-paper-plane"></i>传送门</a></li><li class="item"><a href="/mikutap/" rel="section"><i class="ic i-star"></i>Mikutap</a></li><li class="item"><a href="/restart/" rel="section"><i class="ic i-sun"></i>RestartLife</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/algorithm/random/random_number/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/learning/recastnavigation/3D%E5%AF%BB%E8%B7%AFNavBound/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/japanese/" title="分类于 日语">日语</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/japanese/primary/" title="分类于 日语初级">日语初级</a></div><span><a href="/learning/japanese/primary/%E5%BD%A2%E5%AE%B9%E8%AF%8D%E7%AF%87/" title="形容词篇">形容词篇</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/physx/" title="分类于 物理引擎">物理引擎</a></div><span><a href="/learning/physx/%E3%80%8CScene%20Queries%E3%80%8DAABBPruner/" title="「Scene Queries」AABBPruner">「Scene Queries」AABBPruner</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/python/" title="分类于 python">python</a></div><span><a href="/learning/programlanguage/python/Python-HotFix/" title="Python HotFix 热更新">Python HotFix 热更新</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/read/" title="分类于 阅读">阅读</a> <i class="ic i-angle-right"></i> <a href="/categories/read/logic/" title="分类于 逻辑学">逻辑学</a></div><span><a href="/read/logic/%E9%80%BB%E8%BE%91%E6%96%B0%E5%BC%95%E2%80%94%E2%80%94%E6%80%8E%E6%A0%B7%E8%BE%A8%E5%88%AB%E6%98%AF%E9%9D%9E/" title="逻辑新引——怎样辨别是非">逻辑新引——怎样辨别是非</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game202/" title="分类于 GAME202高质量实时渲染">GAME202高质量实时渲染</a></div><span><a href="/learning/games/Game202/%E4%B8%89%E3%80%81Real-time%20Environment%20Mapping/" title="三、Real-time Environment Mapping">三、Real-time Environment Mapping</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game101/" title="分类于 Games101图形渲染">Games101图形渲染</a></div><span><a href="/learning/games/Game101/%E4%BA%8C%E3%80%81Transformation/" title="二、Transformation">二、Transformation</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/cpp/" title="分类于 cpp">cpp</a></div><span><a href="/learning/programlanguage/cpp/%E5%8D%81%E3%80%81%E5%AF%B9%E8%B1%A1%E5%92%8C%E7%B1%BB/" title="十、对象和类">十、对象和类</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/cpp/" title="分类于 cpp">cpp</a></div><span><a href="/learning/programlanguage/cpp/%E5%8D%81%E5%85%AB%E3%80%81C++11%E6%96%B0%E5%8A%9F%E8%83%BD/" title="十八、C++11新功能">十八、C++11新功能</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/physx/" title="分类于 物理引擎">物理引擎</a></div><span><a href="/learning/physx/Collision%E5%88%86%E4%BA%AB/" title="Collision分享">Collision分享</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game101/" title="分类于 Games101图形渲染">Games101图形渲染</a></div><span><a href="/learning/games/Game101/%E5%8D%81%E4%BA%94%E3%80%81Ray%20Tracing%E2%80%94%E2%80%94Partitions/" title="十五、Ray Tracing——Partitions">十五、Ray Tracing——Partitions</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">鑫酱(●'◡'●) @ 个人博客</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">523k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">7:55</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"learning/recastnavigation/SoloMesh/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/animejs@3.2.0/lib/anime.min.js,npm/katex@0.12.0/dist/contrib/copy-tex.min.js,npm/frappe-charts@1.5.0/dist/frappe-charts.min.iife.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/quicklink@2/dist/quicklink.umd.js,gh/amehime/MiniValine@4.2.2-beta10/dist/MiniValine.min.js"></script><script src="/js/app.js?v=0.2.5"></script><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b6d809b500bd6f0040117088899bc7bf";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>