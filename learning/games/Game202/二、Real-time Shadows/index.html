<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="XqWEZ-KjvQT4IfXzxYvH-PEc--_zN6GqthY2jBsqOs4"><meta name="msvalidate.01" content="4E28E3FDD5912EBBB84869B17359650D"><meta name="baidu-site-verification" content="code-dwpSTDBLS2"><link rel="alternate" type="application/rss+xml" title="鑫酱" href="https://hakuya.me/rss.xml"><link rel="alternate" type="application/atom+xml" title="鑫酱" href="https://hakuya.me/atom.xml"><link rel="alternate" type="application/json" title="鑫酱" href="https://hakuya.me/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="图形学,线性代数,OpenGL"><link rel="canonical" href="https://hakuya.me/learning/games/Game202/%E4%BA%8C%E3%80%81Real-time%20Shadows/"><title>二、Real-time Shadows - GAME202高质量实时渲染 - Games系列 - 学习 | 个人博客 = 鑫酱 = 笔记本</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">二、Real-time Shadows</h1><div class="meta"><span class="item" title="创建时间：2021-06-05 17:11:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-06-05T17:11:00+08:00">2021-06-05</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>7.6k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>7 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">个人博客</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (4).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (11).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper_3.jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper_4.jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (23).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (22).jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learning/" itemprop="item" rel="index" title="分类于 学习"><span itemprop="name">学习</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learning/games/" itemprop="item" rel="index" title="分类于 Games系列"><span itemprop="name">Games系列</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learning/games/Game202/" itemprop="item" rel="index" title="分类于 GAME202高质量实时渲染"><span itemprop="name">GAME202高质量实时渲染</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://hakuya.me/learning/games/Game202/%E4%BA%8C%E3%80%81Real-time%20Shadows/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="鑫酱(●'◡'●)"><meta itemprop="description" content="笔记本, 整天摸鱼，却妄想拯救世界的技术宅"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="鑫酱"></span><div class="body md" itemprop="articleBody"><div class="note info"><p>以下为个人学习笔记整理，<span class="exturl" data-url="aHR0cHM6Ly9zaXRlcy5jcy51Y3NiLmVkdS9+bGluZ3FpL3RlYWNoaW5nL2dhbWVzMjAyLmh0bWw=">课程官网传送门</span>，<span class="exturl" data-url="aHR0cDovL2dhbWVzLWNuLm9yZy9mb3J1bXMvdG9waWMvZ2FtZXMyMDJ6dW95ZWh1aXpvbmcv">作业传送门</span>，<span class="exturl" data-url="aHR0cDovL3d3dy5zbWFydGNoYWlyLm9yZy9HQU1FUzIwMg==">会议系统传送门</span>。</p></div><h1 id="real-time-shadows"><a class="anchor" href="#real-time-shadows">#</a> Real-time Shadows</h1><ul><li>Shadow mapping</li><li>The math behind shadow mapping</li><li>Percentage closer soft shadows</li><li>Variance Soft Shadow Mapping</li><li>MIPMAP and Summed-Area Variance Shadow Maps</li><li>Moment shadow mapping</li><li>Distance field soft shadows</li></ul><h2 id="shadow-mapping"><a class="anchor" href="#shadow-mapping">#</a> Shadow mapping</h2><ul><li>2-Pass Algorithm：详细说明见 <a href="https://hakuya.me/learning/games/Game101/%E5%8D%81%E4%B8%89%E3%80%81Shadow%20Mapping/">Game101 Shadow Mapping</a><ul><li>【Pass1】The light pass generates the SM（shadow mapping）：从点光源出发，记录每个点的深度值</li><li>【Pass2】The camera pass uses the SM (recall last lecture)：从摄像机出发，如果两者深度值相同，则可以被看见，否则视作阴影。</li><li>【优点】：可以用 SM 对场景阴影进行表示，不需要场景实际的几何。</li><li>【缺点】：有走样（锯齿）和自遮挡现象「self occlusion」。</li></ul></li></ul><h3 id="self-occlusion"><a class="anchor" href="#self-occlusion">#</a> self occlusion</h3><p>由于光源向四周发出光线并记录深度的过程中，存在一个精度问题，并非每个点拥有一个深度值，而是某块范围拥有一个深度值，这种情况下将导致距离非常接近的两个点会存在互相遮挡的情况。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210602114250.png" alt="image-20210602114242919"></p><h4 id="adding-a-bias-to-reduce-self-occlusion"><a class="anchor" href="#adding-a-bias-to-reduce-self-occlusion">#</a> Adding a bias to reduce self occlusion</h4><p>增加一个误差值可以有效的降低自遮挡带来的问题，但是会让原本产生阴影的部分出现丢失。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210602115224.png" alt="image-20210602115223030"></p><h4 id="second-depth-shadow-mapping"><a class="anchor" href="#second-depth-shadow-mapping">#</a> Second-depth shadow mapping</h4><p>引入第二深度的概念，在一张 shodow mapping 中存储「最小深度」和「第二小深度」的中间值。</p><p>如果某个点的深度大于「中间值」或者小于「中间值」，那么它将会被遮挡或显示。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210602142355.png" alt="image-20210602142347697"></p><p>这样做也会有一些问题：</p><ul><li>所有物体必须有厚度，因为需要取到第二深度，如果物体只是一个面，那也毫无意义。</li><li>对于实时渲染来说，开销不值得。<ul><li>有很多多余的 <code>if</code> 判断。</li><li>有很多需要修改最小和次小深度的操作。</li></ul></li></ul><blockquote><p>RTR does not trust in COMPLEXITY</p></blockquote><h3 id="aliasing"><a class="anchor" href="#aliasing">#</a> Aliasing</h3><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210602144334.png" alt="image-20210602144333603"></p><h2 id="the-math-behind-shadow-mapping"><a class="anchor" href="#the-math-behind-shadow-mapping">#</a> The math behind shadow mapping</h2><h3 id="approximation-in-rtr"><a class="anchor" href="#approximation-in-rtr">#</a> Approximation in RTR</h3><p>在实时渲染中，一些复杂的计算过程往往会通过一些近似的方程所替代，从而提高运行效率。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210602144826.png" alt="image-20210602144825501"></p><p>何时是近似的？</p><ul><li>在 <code>g(x)</code> 的 max 和 min 越接近的时候。</li><li>在 <code>g(x)</code> 的有效积分域越小时。</li></ul><h4 id="in-shadow-mapping"><a class="anchor" href="#in-shadow-mapping">#</a> In Shadow Mapping</h4><p>把该性质应用于光照方程，把「Visibility 函数」单独进行积分，这样就可以视为「Visibility 函数」积分 ×「shading」</p><ul><li>shading：所有光源的光线照射到该点的强度，这部分内容可以记录在 shading mapping 内。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210602151932.png" alt="image-20210602151931734"></p><p>计算光照的时候，何时是近似的？</p><ul><li>当积分域很小，换句话说就是该点所接收到的光线范围很小：<ul><li>点光源 or 方向光源情况下，积分域很小。</li></ul></li><li>当函数曲线变化平滑（Smooth）时，换句话说光照在各个区域的强度变化不大：<ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">f_r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.10764em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>：物体本身的材质「BRDF」是 diffuse 的。<a href="https://hakuya.me/learning/games/Game101/%E5%8D%81%E5%85%AB%E3%80%81Materials%20and%20Appearances/">BRDF 相关介绍</a></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">L_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>： 有着恒定强度的光照的情况下。</li></ul></li></ul><h2 id="percentage-closer-soft-shadows"><a class="anchor" href="#percentage-closer-soft-shadows">#</a> Percentage closer soft shadows</h2><h3 id="percentage-closer-filteringpcf"><a class="anchor" href="#percentage-closer-filteringpcf">#</a> Percentage Closer Filtering（PCF）</h3><p>最初被用于抗锯齿，后来被用于制作软阴影（PCSS），主要原理是对一块范围内的阴影求平局（类似模糊效果）</p><ul><li><p>filtering 操作不直接处理 shadow map：</p><ul><li>对深度贴图做模糊处理，最终的阴影效果依旧是非 0 即 1，锯齿任然存在。</li><li>不是对已经存在锯齿的结果进行 filtering 操作，也不是对着色的结果做 filitering。</li></ul></li><li><p>处理办法：</p><ul><li>针对某个点，对其周围一定范围内的「shading point」和对应点的 「shadow map 深度值」进行比较，得到 0 or 1 组成的集合，再求平均。</li><li>「shading point」：从摄像机方向观察到的点周围的点。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210602191150.png" alt="image-20210602191149305"></p></li></ul><blockquote><p>PCF 不是对最终的阴影做模糊操作</p></blockquote><p>最终的阴影做模糊，最终的效果依旧还是会有锯齿</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210602191556.png" alt="image-20210602191555282"></p><p>用 PCF 处理后的图片</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210602191716.png" alt="image-20210602191714988"></p><p>当求平均的范围变得很大时，就实现了软阴影的效果</p><h3 id="percentage-closer-soft-shadowspcss"><a class="anchor" href="#percentage-closer-soft-shadowspcss">#</a> Percentage Closer Soft Shadows（PCSS）</h3><p>决定一个阴影究竟是软阴影还是硬阴影，取决于阴影和物体的距离</p><ul><li>Filter size（range）&lt;-&gt; blocker distance</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210602192324.png" alt="image-20210602192323735"></p><blockquote><p>点光源是不存在软阴影的，只有面光源才有软阴影，而且只有点光源才会有 shadow map。因此很多情况下，通常会用点光源生成 shadow map，然后视作面光源来做软阴影。</p></blockquote><h4 id="relative-average-projected-blocker-depth"><a class="anchor" href="#relative-average-projected-blocker-depth">#</a> Relative average projected blocker depth</h4><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>W</mi><mrow><mi>P</mi><mi>e</mi><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>r</mi><mi>a</mi></mrow></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>d</mi><mrow><mi>R</mi><mi>e</mi><mi>c</mi><mi>e</mi><mi>i</mi><mi>v</mi><mi>e</mi><mi>r</mi></mrow></msub><mo>−</mo><msub><mi>d</mi><mrow><mi>B</mi><mi>l</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>e</mi><mi>r</mi></mrow></msub><mo stretchy="false">)</mo><mo>⋅</mo><msub><mi>W</mi><mrow><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mi mathvariant="normal">/</mi><msub><mi>d</mi><mrow><mi>B</mi><mi>l</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>e</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">W_{Penumbra} = (d_{Receiver} - d_{Blocker}) \cdot W_{Light} / d_{Blocker}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">P</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.32833099999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.00773em">R</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:.03588em">v</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.05017em">B</span><span class="mord mathnormal mtight" style="margin-right:.01968em">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:.03148em">k</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361079999999999em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:.03588em">g</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.05017em">B</span><span class="mord mathnormal mtight" style="margin-right:.01968em">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:.03148em">k</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></span></p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210602192732.png" alt="image-20210602192731745"></p><h4 id="pcss-algorithm"><a class="anchor" href="#pcss-algorithm">#</a> PCSS algorithm</h4><ul><li>【step1】Blocker search：已知一个 「shading point」，通过点光源和「shading point」得到对应「shadow map」上的一个点。判断该点是否被遮挡，如果被遮挡，则该点为「blocker」，记下它的深度值。最终得到一张记录了所有「blocker」深度的图。再针对某个「blocker」，取其一定范围内的所有「blocker」的深度求平均。得到「average blocker」。</li><li>【step2】Penumbra estimation：通过「average blocker」计算出「filter size」。</li><li>【step3】Percentage Closer Filtering：用计算得到的「filter size」去对该点进行「PCF」处理。</li></ul><h4 id="思考求average-blocker所需的范围该是多大呢"><a class="anchor" href="#思考求average-blocker所需的范围该是多大呢">#</a> 思考：求「average blocker」所需的范围该是多大呢？</h4><ul><li>通过「light size」决定。</li><li>通过「shadow map」和 「light」的距离决定。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210602200136.png" alt="image-20210602200135269"></p><h3 id="a-deeper-look-at-pcf"><a class="anchor" href="#a-deeper-look-at-pcf">#</a> A Deeper Look at PCF</h3><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">[</mo><mi>w</mi><mo>∗</mo><mi>f</mi><mo stretchy="false">]</mo><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mrow><mi>q</mi><mi>ϵ</mi><mi>N</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow></munder><mi>w</mi><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>q</mi><mo stretchy="false">)</mo><mi>f</mi><mo stretchy="false">(</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">[w * f](p) = \sum_{q \epsilon N(p)} w(p,q)f(q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:.02691em">w</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mclose">]</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.5660100000000003em;vertical-align:-1.516005em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em"><span style="top:-1.808995em;margin-left:0"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">q</span><span class="mord mathnormal mtight">ϵ</span><span class="mord mathnormal mtight" style="margin-right:.10903em">N</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">p</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em"><span class="pstrut" style="height:3.05em"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.516005em"><span></span></span></span></span></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.02691em">w</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mclose">)</span></span></span></span></span></p><ul><li>Filter / convolution：<ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N(p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span>：点 <code>p</code> 邻域范围。</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">w(p,q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02691em">w</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mclose">)</span></span></span></span>：对 <code>p</code> 点周围的点 <code>q</code> ，根据点 <code>q</code> 和点 <code>p</code> 的距离进行加权。</li></ul></li></ul><h4 id="in-pcss"><a class="anchor" href="#in-pcss">#</a> In PCSS</h4><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mrow><mi>q</mi><mi>ϵ</mi><mi>N</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow></munder><mi>w</mi><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>q</mi><mo stretchy="false">)</mo><mo>⋅</mo><msup><mi>χ</mi><mo lspace="0em" rspace="0em">+</mo></msup><mo stretchy="false">[</mo><msub><mi>D</mi><mrow><mi>S</mi><mi>M</mi></mrow></msub><mo stretchy="false">(</mo><mi>q</mi><mo stretchy="false">)</mo><mo>−</mo><msub><mi>D</mi><mrow><mi>s</mi><mi>c</mi><mi>e</mi><mi>n</mi><mi>e</mi></mrow></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">V(x) = \sum_{q \epsilon N(p)} w(p,q) \cdot \chi^{+}[D_{SM}(q) - D_{scene}(x)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.5660100000000003em;vertical-align:-1.516005em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em"><span style="top:-1.808995em;margin-left:0"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">q</span><span class="mord mathnormal mtight">ϵ</span><span class="mord mathnormal mtight" style="margin-right:.10903em">N</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">p</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em"><span class="pstrut" style="height:3.05em"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.516005em"><span></span></span></span></span></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.02691em">w</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.071331em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.821331em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span></span></span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.32833099999999993em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.05764em">S</span><span class="mord mathnormal mtight" style="margin-right:.10903em">M</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>χ</mi><mo lspace="0em" rspace="0em">+</mo></msup><mo stretchy="false">[</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\chi^{+}[f(x)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.021331em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.771331em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span></span></span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span>：表示符号函数。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> 如果大于 0，最终的结果就是 1；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> 如果小于 0，最终的结果就是 0。</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mrow><mi>S</mi><mi>M</mi></mrow></msub><mo stretchy="false">(</mo><mi>q</mi><mo stretchy="false">)</mo><mo>−</mo><msub><mi>D</mi><mrow><mi>s</mi><mi>c</mi><mi>e</mi><mi>n</mi><mi>e</mi></mrow></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">D_{SM}(q) - D_{scene}(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.32833099999999993em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.05764em">S</span><span class="mord mathnormal mtight" style="margin-right:.10903em">M</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>：表示点 <code>q</code> 「shadows map」 的深度和 「shading point」 的深度差，一般表示「shading point」 <code>x</code> 是否被遮挡。</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>χ</mi><mo lspace="0em" rspace="0em">+</mo></msup><mo stretchy="false">[</mo><msub><mi>D</mi><mrow><mi>S</mi><mi>M</mi></mrow></msub><mo stretchy="false">(</mo><mi>q</mi><mo stretchy="false">)</mo><mo>−</mo><msub><mi>D</mi><mrow><mi>s</mi><mi>c</mi><mi>e</mi><mi>n</mi><mi>e</mi></mrow></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\chi^{+}[D_{SM}(q) - D_{scene}(x)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.021331em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.771331em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span></span></span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.32833099999999993em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.05764em">S</span><span class="mord mathnormal mtight" style="margin-right:.10903em">M</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span>：用来判断点 <code>p</code> 周围的点 <code>q</code> 是否被遮挡。</li></ul><blockquote><p>因此 PCF 并不是对 「shadows map」 做 「filtering」:</p></blockquote><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo mathvariant="normal">≠</mo><msup><mi>χ</mi><mo lspace="0em" rspace="0em">+</mo></msup><mo stretchy="false">{</mo><mo stretchy="false">[</mo><mi>w</mi><mo>∗</mo><msub><mi>D</mi><mrow><mi>S</mi><mi>M</mi></mrow></msub><mo stretchy="false">]</mo><mo stretchy="false">(</mo><mi>q</mi><mo stretchy="false">)</mo><mo>−</mo><msub><mi>D</mi><mrow><mi>s</mi><mi>c</mi><mi>e</mi><mi>n</mi><mi>e</mi></mrow></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">V(x) \ne \chi^{+}\{[w * D_{SM}](q) - D_{scene}(x) \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.071331em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.821331em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span></span></span></span></span></span></span></span></span><span class="mopen">{</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:.02691em">w</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.32833099999999993em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.05764em">S</span><span class="mord mathnormal mtight" style="margin-right:.10903em">M</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose">}</span></span></span></span></span></p><p>如果对 「shadows map」 做 「filtering」，最终的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">V(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> 只能是非 0 即 1。</p><blockquote><p>同样，PCF 也不是对图像的最终结果做「filtering」：</p></blockquote><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo mathvariant="normal">≠</mo><munder><mo>∑</mo><mrow><mi>y</mi><mi>ϵ</mi><mi>N</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></munder><mi>w</mi><mo stretchy="false">(</mo><mi>y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mi>V</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">V(x) \ne \sum_{y \epsilon N(x)} w(y,x) V(y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.5660100000000003em;vertical-align:-1.516005em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em"><span style="top:-1.808995em;margin-left:0"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">y</span><span class="mord mathnormal mtight">ϵ</span><span class="mord mathnormal mtight" style="margin-right:.10903em">N</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em"><span class="pstrut" style="height:3.05em"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.516005em"><span></span></span></span></span></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.02691em">w</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="mclose">)</span></span></span></span></span></p><h2 id="variance-soft-shadow-mapping"><a class="anchor" href="#variance-soft-shadow-mapping">#</a> Variance Soft Shadow Mapping</h2><p>VSSM 用于解决 PCSS 效率低下的问题。[Fast blocker search【step1】and filtering【step3】](#PCSS algorithm)。</p><h3 id="faststep3"><a class="anchor" href="#faststep3">#</a> Fast【step3】</h3><p>【step1】和【step3】比较慢的地方在于求某个区域内数值的平均。以【step3】这项操作为例，求区域内遮挡 1 和未遮挡 0 的平均，可以进一步理解为，区域内 1 的占比。</p><p>因此原本需要求得一个范围内「遮挡」和「未遮挡」的平均变为需要知道一个区域内，比「shading point」深度值大的点（遮挡）的占比。</p><h4 id="如何求得比shading-point深度值大的点的占比呢"><a class="anchor" href="#如何求得比shading-point深度值大的点的占比呢">#</a> 如何求得比「shading point」深度值大的点的占比呢？</h4><ul><li>首先，我们假设深度值的分布是符合正态分布的，或者说近似正态分布。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210604152009.png" alt="image-20210604152002308"></p><ul><li><p>为了确定一个正态分布曲线，需要知道样本的「均值」和「方差」</p><ul><li><p>如何得到样本的「均值」？</p><ul><li>「<a href="https://hakuya.me/learning/games/Game101/%E4%B9%9D%E3%80%81Shading%EF%BC%88%E4%B8%8B%EF%BC%89%E2%80%94%E2%80%94Texture%20Mapping%20Cont/">MipMap</a>」本身就是一个很好的求均值解决方案（但仅限矩形区域，且不够准确）。</li><li>Summed Area Tables（SAT）</li></ul></li><li><p>如何得到样标的「方差」？</p><ul><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><msup><mi>X</mi><mn>2</mn></msup><mo stretchy="false">)</mo><mo>−</mo><msup><mi>E</mi><mn>2</mn></msup><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Var(X) = E(X^2) - E^2(X)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mclose">)</span></span></span></span>：方差 = 平方的期望 - 期望的平方。</p><ul><li>期望的平方：可以用上述求得的「均值」。</li><li>平方的期望：需要另外一张「shadow map」用于存储深度的平方，之后再通过上述方法求其均值。</li></ul></li><li><p>因此，需要单独一张「shadow map」用于存储深度的平方。</p></li></ul></li></ul></li><li><p>得到了曲线的正态分布，接下来就需要求占比了</p><ul><li>通过正态分布的 「PDF（Gaussian Distribution Function）」 曲线，求得 「CDF（Cumulative Distribution Function）」 曲线，便可以获取占比。</li></ul></li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210604154231.png" alt="image-20210604154230169"></p><h4 id="不是正态分布咋办"><a class="anchor" href="#不是正态分布咋办">#</a> 不是正态分布咋办？</h4><p>万能的近似函数又来了，为了能够满足任何分布曲线。「CDF」曲线可以用「切比雪夫不等式」转成通用格式：</p><p>该函数可以满足任何分布曲线，但是有一定程度上的误差，且如果 <code>t</code> 在分布函数的左半侧，结果会更加的不准确。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo>&gt;</mo><mi>t</mi><mo stretchy="false">)</mo><mo>≤</mo><mfrac><msup><mi>σ</mi><mn>2</mn></msup><mrow><msup><mi>σ</mi><mn>2</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mi>t</mi><mo>−</mo><mi>μ</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">P(x&gt;t) ≤ \frac{\sigma^2}{\sigma^2 + (t - \mu)^2 }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.427108em;vertical-align:-.936em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.740108em"><span style="top:-2.9890000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal">μ</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.740108em"><span style="top:-2.9890000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210604163646.png" alt="image-20210604163644954"></p><h4 id="总结-faststep3"><a class="anchor" href="#总结-faststep3">#</a> 总结 Fast【step3】</h4><ul><li><p>预处理</p><ul><li>得到一张记录深度的「shadow map」。</li><li>得到一张记录深度平方的「shadow map」。</li></ul></li><li><p>运行时</p><ul><li>获取某点的深度平均值「MipMap」。O (1)</li><li>获取某点的深度平方的平均值「MipMap」。O (1)</li><li>得到占比概率（[Visibility 函数](#In Shadow Mapping)）。O (1)</li><li>干掉了采样和高消耗的循环。</li></ul></li><li><p>缺陷</p><ul><li>不支持实时情况下的深度变化，如果有深度变化需求需要动态修改「shadow map」</li></ul></li></ul><h3 id="faststep1"><a class="anchor" href="#faststep1">#</a> Fast【step1】</h3><p>【step3】的优化告一段落，接下来看【step1】的问题。【step1】需要查询周围的「blocker」并且需要求出所有「blocker」的「平均深度」。</p><ul><li>需要对每个「块」进行遍历，效率低下。</li><li>需要对所有「blocker」深度求平均。</li><li>特别注意：「blocker」是被遮挡的「块」，即深度值小于「shadping point」的「块」—— 图中蓝色部分。</li></ul><p>假设「shadping point」的深度是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">t = 7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.61508em;vertical-align:0"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">7</span></span></span></span>。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210604170122.png" alt="image-20210604170121434"></p><ul><li>Blocker（z &lt; t）的平均值记为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mrow><mi>o</mi><mi>c</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Z_{occ}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>。</li><li>Non-blocker（z &gt; t）的平均值记为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mrow><mi>u</mi><mi>n</mi><mi>o</mi><mi>c</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Z_{unocc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>。</li><li>因此，可以推导出如下公式：<ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">N_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.10903em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 表示 Non-blocker 数量</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">N_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.10903em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 表示 Blocker 数量</li></ul></li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><msub><mi>N</mi><mn>1</mn></msub><mi>N</mi></mfrac><msub><mi>Z</mi><mrow><mi>u</mi><mi>n</mi><mi>o</mi><mi>c</mi><mi>c</mi></mrow></msub><mo>+</mo><mfrac><msub><mi>N</mi><mn>2</mn></msub><mi>N</mi></mfrac><msub><mi>Z</mi><mrow><mi>o</mi><mi>c</mi><mi>c</mi></mrow></msub><mo>=</mo><msub><mi>Z</mi><mrow><mi>A</mi><mi>v</mi><mi>g</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\frac{N_1}{N} Z_{unocc} + \frac{N_2}{N} Z_{occ} = Z_{Avg}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.04633em;vertical-align:-.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.10903em">N</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.10903em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:2.04633em;vertical-align:-.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.10903em">N</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.10903em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.969438em;vertical-align:-.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.328331em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:.03588em">v</span><span class="mord mathnormal mtight" style="margin-right:.03588em">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span></span></span></p><h4 id="z_unocc-未知如何求z_occ"><a class="anchor" href="#z_unocc-未知如何求z_occ">#</a> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mrow><mi>u</mi><mi>n</mi><mi>o</mi><mi>c</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Z_{unocc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 未知，如何求<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mrow><mi>o</mi><mi>c</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Z_{occ}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>?</h4><p>需要计算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mrow><mi>o</mi><mi>c</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Z_{occ}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>N</mi><mn>2</mn></msub><mo separator="true">,</mo><mi>N</mi><mo separator="true">,</mo><msub><mi>Z</mi><mrow><mi>A</mi><mi>v</mi><mi>g</mi></mrow></msub></mrow><annotation encoding="application/x-tex">N_1,N_2,N,Z_{Avg}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.969438em;vertical-align:-.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.10903em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.10903em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.328331em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:.03588em">v</span><span class="mord mathnormal mtight" style="margin-right:.03588em">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span></span> 均已知。</p><ul n_2=""><li>不妨做个大胆的假设：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mrow><mi>u</mi><mi>n</mi><mi>o</mi><mi>c</mi><mi>c</mi></mrow></msub><mo>=</mo><mi>t</mi><mo>=</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">Z_{unocc} = t = 7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.61508em;vertical-align:0"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">7</span></span></span></span>。</li><li>最终： Z_{occ} = \frac{NZ_{Avg} - N_1t}</li></ul><h2 id="mipmap-and-summed-area-variance-shadow-maps"><a class="anchor" href="#mipmap-and-summed-area-variance-shadow-maps">#</a> MIPMAP and Summed-Area Variance Shadow Maps</h2><h3 id="mipmap"><a class="anchor" href="#mipmap">#</a> MIPMAP</h3><p>MipMap 的介绍可以回顾 <a href="https://hakuya.me/learning/games/Game101/%E4%B9%9D%E3%80%81Shading%EF%BC%88%E4%B8%8B%EF%BC%89%E2%80%94%E2%80%94Texture%20Mapping%20Cont/">Game101 的 Texture Mapping</a>。</p><p>MipMap 有几个缺陷：</p><ul><li>处理均值采用的是切分网格形式的平均。因此，被切分出的网格内任意一点的范围平均都是同样的结果，并不是真正意义上的取某个点周围的一定范围进行平均。</li><li>对于非矩形的区域没有办法很好的支持。</li><li>对于矩形区域，如果边长不是 <code>2</code> 的阶乘，例如 <code>6</code> ，这样就需要对 <code>4</code> 和 <code>8</code> 来做三线性插值。</li></ul><h3 id="summed-area-tablessat"><a class="anchor" href="#summed-area-tablessat">#</a> Summed Area Tables（SAT）</h3><h4 id="prefix-sum-algorithm"><a class="anchor" href="#prefix-sum-algorithm">#</a> Prefix sum algorithm</h4><p>「SAT」的核心在于前向求和算法，假设输入的内容是一个一维数组，经过前向求和算法后会得到一个新的一维数组，数组内每个元素记录的是前面 <code>N</code> 个元素的总和。因此，计算中间某 <code>X</code> 个连续的数只和将变得非常简单。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210604185232.png" alt="image-20210604185231336"></p><p>一维数组内的求和解决了，接下来思考一下二维数组应当如何处理呢？</p><p>原理类似，每个点距离一个从远点到该点组成的矩形面积的数据总和。通过类似求面积的方式，最终就能得到某个点的周围一个矩形空间内的点总和。</p><p>「蓝色方块」的面积便可以这么计算：「蓝色方块」=「大绿色方块」-「两个黄色方块」+「绿色小方块」</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210604185744.png" alt="image-20210604185743202"></p><h4 id="总结"><a class="anchor" href="#总结">#</a> 总结</h4><ul><li>「SAT」计算结果非常准确。</li><li>需要额外 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mo>×</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(m \times n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 的空间存储「SAT」。</li><li>求解平均值速度提升到了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span> 。</li></ul><h2 id="moment-shadow-mapping"><a class="anchor" href="#moment-shadow-mapping">#</a> Moment shadow mapping</h2><p>「MSM」用于解决「VSSM」的误差问题，「VSSM」的很多计算都是基于「正态分布」实现的，换句话说，如果分布曲线不是接近「正态分布」的情况下，结果将变得不准确。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210604191325.png" alt="image-20210604191324638"></p><h3 id="issues1深度值不符合正态分布"><a class="anchor" href="#issues1深度值不符合正态分布">#</a> 【Issues1】深度值不符合正态分布</h3><p>深度值不符会使得「Visibility 函数」的结果不准，最终会使得画面偏暗或者偏亮</p><ul><li>偏暗：这种情况下还能够接收。</li><li>偏亮：偏亮则会出现漏光效果。阴影的某块区域会比周围更亮</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210604191611.png" alt="image-20210604191610613"></p><blockquote><p>Light leaking</p></blockquote><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210604192059.png" alt="image-20210604192058658"></p><h3 id="issues2由于切比雪夫不等式的特性-t-在分布曲线左侧时误差会非常大"><a class="anchor" href="#issues2由于切比雪夫不等式的特性-t-在分布曲线左侧时误差会非常大">#</a> 【Issues2】由于「切比雪夫不等式」的特性， <code>t</code> 在分布曲线左侧时误差会非常大。</h3><blockquote><p>non-planarity artifact</p></blockquote><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210604192327.png" alt="image-20210604192326738"></p><h3 id="目的"><a class="anchor" href="#目的">#</a> 目的</h3><p>「MSM」主要是用来解决非正态分布情况下「VSSM」带来的误差【Issues1】。</p><p>为此，「MSM」引入了一个「higher order moments」来描述一个分布。</p><h4 id="moments"><a class="anchor" href="#moments">#</a> Moments</h4><p>由于「VSSM」的「正态分布曲线」是通过均值和均值平方计算得到的。因此可以成「VSSM」使用了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo separator="true">,</mo><msup><mi>x</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">x,x^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 两种「moments」。「MSM」则是想通过使用更多的「moments」让结果变得更准确。</p><h4 id="结论"><a class="anchor" href="#结论">#</a> 结论</h4><p>如果用前 n 阶「moments」，便可以表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">m/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">m</span><span class="mord">/</span><span class="mord">2</span></span></span></span> 阶的函数。</p><p>「PCF」函数本身是个 <code>2</code> 阶函数，由于「PCF」的结果比较准确。如果想要「VSSM」结果接近「PCF」，则需要使用前 4 阶「moments」。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210604193535.png" alt="image-20210604193534176"></p><h3 id="总结-2"><a class="anchor" href="#总结-2">#</a> 总结</h3><p>理论上越多个「moments」能达到的效果将会越好。存储上可能会有一定的消耗，另外：如何根据前 n 阶「moments」得到近似「PCF」（有两个台阶）的函数也是一个非常复杂的问题。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210604194422.png" alt="image-20210604194421532"></p><h2 id="distance-field-soft-shadows"><a class="anchor" href="#distance-field-soft-shadows">#</a> Distance field soft shadows</h2><p>「SDF」是一种更加高效的计算软阴影的实现方案。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210605153340.png" alt="image-20210605153332611"></p><h3 id="distance-functions"><a class="anchor" href="#distance-functions">#</a> Distance Functions</h3><p>定义空间中每个点到最近的一个物体表面的距离（带正负号）</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210605153619.png" alt="image-20210605153617492"></p><h3 id="blending-support"><a class="anchor" href="#blending-support">#</a> Blending Support</h3><p>距离函数（Distance Functions）支持对多个简单的几何物体的距离场做「Blending」得到复杂几何物体的距离场</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210605162058.png" alt="image-20210605162057236"></p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210605162120.png" alt="image-20210605162119251"></p><h3 id="usages-of-distance-fields"><a class="anchor" href="#usages-of-distance-fields">#</a> Usages of Distance Fields</h3><h4 id="usage1ray-marchingsphere-tracingto-perform-ray-sdf-intersection"><a class="anchor" href="#usage1ray-marchingsphere-tracingto-perform-ray-sdf-intersection">#</a> 【Usage1】：Ray marching（sphere tracing）to perform ray-SDF intersection。</h4><p>核心目的是用于对射线求交。</p><ul><li>获取起始点的 「Distance」，获得射线的传播方向「Distance」距离的下一个点的「Distance」并继续推进。</li><li>移动一定距离后或者遇到某个物体表面时，算法结束，便可以快速获取射线是否命中物体表面，在射线碰撞检测方面使用较多，效率高。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210605162200.png" alt="image-20210605162159033"></p><h4 id="usage2use-sdf-to-determine-theapproxpercentage-of-occlusion"><a class="anchor" href="#usage2use-sdf-to-determine-theapproxpercentage-of-occlusion">#</a> 【Usage2】：Use SDF to determine the（approx）percentage of occlusion。</h4><p>核心目的是求得视锥的「可视率」。该情况下「Distance」一般不带符号</p><ul><li>从「shading point」往某个方向查询，中间遇到了「Distance」不为 0 的点时，记录一下，直到遇到遮挡或者光源时停止。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210605164547.png" alt="image-20210605163751251"></p><ul><li>视锥范围就是「Distance」不为 0 的点和「shading point」形成的最小切线角度 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">\theta_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210605164016.png" alt="image-20210605164014990"></p><ul><li>视锥的「可视率」就是 (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">\theta_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> / 整个视锥角度)。</li></ul><h4 id="如何提高可视率计算效率"><a class="anchor" href="#如何提高可视率计算效率">#</a> 如何提高「可视率」计算效率？</h4><p>还是老办法，用一个近似函数来代替～</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210605164745.png" alt="image-20210605164743959"></p><p>并且引入一个系数 <code>k</code> 用于调节整个系统的「敏感度」，即：什么时候完全在阴影内，什么时候完全不在。</p><ul><li>如果 <code>k = 100</code> ，那么超过 <code>0.1</code> 以上的「可视率」就可以认为是完全不在阴影内，这样的效果会让阴影变得更加「硬」，边界分明。</li><li>同理，如果 <code>k = 2</code> ，那么超过 <code>0.5</code> 以上的可是「可视率」才能认为是完全不在阴影内，剩下的地方都是从非阴影到阴影的过渡，这样的效果就更像「软阴影」。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210605164848.png" alt="image-20210605164847254"></p><h3 id="distance-fieldvisualization"><a class="anchor" href="#distance-fieldvisualization">#</a> Distance Field：Visualization</h3><p>针对场景中每个物体计算「Distance Field」，然后对图内每个点取所有物体内记录该点「Distance」的最小值作为「Distance」的最终值。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210605165645.png" alt="image-20210605165643770"></p><h3 id="总结-3"><a class="anchor" href="#总结-3">#</a> 总结</h3><ul><li><p>「SDF」的优点：</p><ul><li>速度快</li><li>高质量</li></ul></li><li><p>「SDF」的缺点：</p><ul><li>需要预处理</li><li>需要庞大的存储空间</li></ul></li></ul><h3 id="antialiased-infinite-resolution-characters-in-rtr"><a class="anchor" href="#antialiased-infinite-resolution-characters-in-rtr">#</a> Antialiased / infinite resolution characters in RTR</h3><p>基于距离函数的无锯齿字符</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/20210605171030.png" alt="image-20210605171029847"></p><div class="tags"><a href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" rel="tag"><i class="ic i-tag"></i> 图形学</a> <a href="/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" rel="tag"><i class="ic i-tag"></i> 线性代数</a> <a href="/tags/OpenGL/" rel="tag"><i class="ic i-tag"></i> OpenGL</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-12-29 09:36:04" itemprop="dateModified" datetime="2022-12-29T09:36:04+08:00">2022-12-29</time> </span><span id="learning/games/Game202/二、Real-time Shadows/" class="item leancloud_visitors" data-flag-title="二、Real-time Shadows" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 充电</button><p>请我[恰饭]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="鑫酱(●'◡'●) 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="鑫酱(●'◡'●) 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>鑫酱(●'◡'●) <i class="ic i-at"><em>@</em></i>鑫酱</li><li class="link"><strong>本文链接：</strong> <a href="https://hakuya.me/learning/games/Game202/%E4%BA%8C%E3%80%81Real-time%20Shadows/" title="二、Real-time Shadows">https://hakuya.me/learning/games/Game202/二、Real-time Shadows/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/learning/games/Game202/%E4%B8%80%E3%80%81Recap%20of%20CG%20Basics/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;wallpaper-1255596461.cos.ap-nanjing.myqcloud.com&#x2F;wallpaper_3.jpg" title="一、Recap of CG Basics"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> GAME202高质量实时渲染</span><h3>一、Recap of CG Basics</h3></a></div><div class="item right"><a href="/learning/games/Game202/%E4%B8%89%E3%80%81Real-time%20Environment%20Mapping/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;wallpaper-1255596461.cos.ap-nanjing.myqcloud.com&#x2F;wallpaper (21).jpg" title="三、Real-time Environment Mapping"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> GAME202高质量实时渲染</span><h3>三、Real-time Environment Mapping</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#real-time-shadows"><span class="toc-number">1.</span> <span class="toc-text">Real-time Shadows</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#shadow-mapping"><span class="toc-number">1.1.</span> <span class="toc-text">Shadow mapping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#self-occlusion"><span class="toc-number">1.1.1.</span> <span class="toc-text">self occlusion</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#adding-a-bias-to-reduce-self-occlusion"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">Adding a bias to reduce self occlusion</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#second-depth-shadow-mapping"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">Second-depth shadow mapping</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aliasing"><span class="toc-number">1.1.2.</span> <span class="toc-text">Aliasing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#the-math-behind-shadow-mapping"><span class="toc-number">1.2.</span> <span class="toc-text">The math behind shadow mapping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#approximation-in-rtr"><span class="toc-number">1.2.1.</span> <span class="toc-text">Approximation in RTR</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#in-shadow-mapping"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">In Shadow Mapping</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#percentage-closer-soft-shadows"><span class="toc-number">1.3.</span> <span class="toc-text">Percentage closer soft shadows</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#percentage-closer-filteringpcf"><span class="toc-number">1.3.1.</span> <span class="toc-text">Percentage Closer Filtering（PCF）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#percentage-closer-soft-shadowspcss"><span class="toc-number">1.3.2.</span> <span class="toc-text">Percentage Closer Soft Shadows（PCSS）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#relative-average-projected-blocker-depth"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">Relative average projected blocker depth</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pcss-algorithm"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">PCSS algorithm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%80%83%E6%B1%82average-blocker%E6%89%80%E9%9C%80%E7%9A%84%E8%8C%83%E5%9B%B4%E8%AF%A5%E6%98%AF%E5%A4%9A%E5%A4%A7%E5%91%A2"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">思考：求「average blocker」所需的范围该是多大呢？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a-deeper-look-at-pcf"><span class="toc-number">1.3.3.</span> <span class="toc-text">A Deeper Look at PCF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#in-pcss"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">In PCSS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#variance-soft-shadow-mapping"><span class="toc-number">1.4.</span> <span class="toc-text">Variance Soft Shadow Mapping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#faststep3"><span class="toc-number">1.4.1.</span> <span class="toc-text">Fast【step3】</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%B1%82%E5%BE%97%E6%AF%94shading-point%E6%B7%B1%E5%BA%A6%E5%80%BC%E5%A4%A7%E7%9A%84%E7%82%B9%E7%9A%84%E5%8D%A0%E6%AF%94%E5%91%A2"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">如何求得比「shading point」深度值大的点的占比呢？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E6%98%AF%E6%AD%A3%E6%80%81%E5%88%86%E5%B8%83%E5%92%8B%E5%8A%9E"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">不是正态分布咋办？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-faststep3"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">总结 Fast【step3】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#faststep1"><span class="toc-number">1.4.2.</span> <span class="toc-text">Fast【step1】</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#z_unocc-%E6%9C%AA%E7%9F%A5%E5%A6%82%E4%BD%95%E6%B1%82z_occ"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">ZunoccZ_{unocc}Zunocc​ 未知，如何求ZoccZ_{occ}Zocc​?</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mipmap-and-summed-area-variance-shadow-maps"><span class="toc-number">1.5.</span> <span class="toc-text">MIPMAP and Summed-Area Variance Shadow Maps</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mipmap"><span class="toc-number">1.5.1.</span> <span class="toc-text">MIPMAP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#summed-area-tablessat"><span class="toc-number">1.5.2.</span> <span class="toc-text">Summed Area Tables（SAT）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#prefix-sum-algorithm"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">Prefix sum algorithm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#moment-shadow-mapping"><span class="toc-number">1.6.</span> <span class="toc-text">Moment shadow mapping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#issues1%E6%B7%B1%E5%BA%A6%E5%80%BC%E4%B8%8D%E7%AC%A6%E5%90%88%E6%AD%A3%E6%80%81%E5%88%86%E5%B8%83"><span class="toc-number">1.6.1.</span> <span class="toc-text">【Issues1】深度值不符合正态分布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#issues2%E7%94%B1%E4%BA%8E%E5%88%87%E6%AF%94%E9%9B%AA%E5%A4%AB%E4%B8%8D%E7%AD%89%E5%BC%8F%E7%9A%84%E7%89%B9%E6%80%A7-t-%E5%9C%A8%E5%88%86%E5%B8%83%E6%9B%B2%E7%BA%BF%E5%B7%A6%E4%BE%A7%E6%97%B6%E8%AF%AF%E5%B7%AE%E4%BC%9A%E9%9D%9E%E5%B8%B8%E5%A4%A7"><span class="toc-number">1.6.2.</span> <span class="toc-text">【Issues2】由于「切比雪夫不等式」的特性， t 在分布曲线左侧时误差会非常大。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84"><span class="toc-number">1.6.3.</span> <span class="toc-text">目的</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#moments"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">Moments</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">结论</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">1.6.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#distance-field-soft-shadows"><span class="toc-number">1.7.</span> <span class="toc-text">Distance field soft shadows</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#distance-functions"><span class="toc-number">1.7.1.</span> <span class="toc-text">Distance Functions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#blending-support"><span class="toc-number">1.7.2.</span> <span class="toc-text">Blending Support</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#usages-of-distance-fields"><span class="toc-number">1.7.3.</span> <span class="toc-text">Usages of Distance Fields</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#usage1ray-marchingsphere-tracingto-perform-ray-sdf-intersection"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">【Usage1】：Ray marching（sphere tracing）to perform ray-SDF intersection。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#usage2use-sdf-to-determine-theapproxpercentage-of-occlusion"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">【Usage2】：Use SDF to determine the（approx）percentage of occlusion。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98%E5%8F%AF%E8%A7%86%E7%8E%87%E8%AE%A1%E7%AE%97%E6%95%88%E7%8E%87"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">如何提高「可视率」计算效率？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#distance-fieldvisualization"><span class="toc-number">1.7.4.</span> <span class="toc-text">Distance Field：Visualization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-number">1.7.5.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#antialiased-infinite-resolution-characters-in-rtr"><span class="toc-number">1.7.6.</span> <span class="toc-text">Antialiased &#x2F; infinite resolution characters in RTR</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/learning/games/Game202/%E4%B8%80%E3%80%81Recap%20of%20CG%20Basics/" rel="bookmark" title="一、Recap of CG Basics">一、Recap of CG Basics</a></li><li class="active"><a href="/learning/games/Game202/%E4%BA%8C%E3%80%81Real-time%20Shadows/" rel="bookmark" title="二、Real-time Shadows">二、Real-time Shadows</a></li><li><a href="/learning/games/Game202/%E4%B8%89%E3%80%81Real-time%20Environment%20Mapping/" rel="bookmark" title="三、Real-time Environment Mapping">三、Real-time Environment Mapping</a></li><li><a href="/learning/games/Game202/%E5%9B%9B%E3%80%81Real-time%20Global%20Illumination/" rel="bookmark" title="四、Real-time Global Illumination">四、Real-time Global Illumination</a></li><li><a href="/learning/games/Game202/%E4%BA%94%E3%80%81Real-time%20Physically-based%20Materials/" rel="bookmark" title="五、Real-time Physically-based Materials">五、Real-time Physically-based Materials</a></li><li><a href="/learning/games/Game202/%E5%85%AD%E3%80%81Real-time%20Ray%20Tracing/" rel="bookmark" title="六、Real-time Ray Tracing">六、Real-time Ray Tracing</a></li><li><a href="/learning/games/Game202/%E4%B8%83%E3%80%81Practical%20Industrial%20Solutions/" rel="bookmark" title="七、Practical Industrial Solutions">七、Practical Industrial Solutions</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="鑫酱(●'◡'●)" data-src="/images/avatar.jpg"><p class="name" itemprop="name">鑫酱(●'◡'●)</p><div class="description" itemprop="description">整天摸鱼，却妄想拯救世界的技术宅</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">100</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">24</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">53</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FsbGVuR1g=" title="https:&#x2F;&#x2F;github.com&#x2F;AllenGX"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTgwNTM4MjQy" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;80538242"><i class="ic i-cloud-music"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjE0MTM5MDcxNTNAcXEuY29t" title="mailto:1413907153@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>好友</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>网址</a></li><li class="item"><a href="/travellings/" rel="section"><i class="ic i-paper-plane"></i>传送门</a></li><li class="item"><a href="/mikutap/" rel="section"><i class="ic i-star"></i>Mikutap</a></li><li class="item"><a href="/restart/" rel="section"><i class="ic i-sun"></i>RestartLife</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/learning/games/Game202/%E4%B8%80%E3%80%81Recap%20of%20CG%20Basics/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/learning/games/Game202/%E4%B8%89%E3%80%81Real-time%20Environment%20Mapping/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game101/" title="分类于 Games101图形渲染">Games101图形渲染</a></div><span><a href="/learning/games/Game101/%E5%8D%81%E5%85%AB%E3%80%81Materials%20and%20Appearances/" title="十八、Materials and Appearances">十八、Materials and Appearances</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/python/" title="分类于 python">python</a></div><span><a href="/learning/programlanguage/python/Python-watchdog/" title="基于 watchdog 实现自动化更新">基于 watchdog 实现自动化更新</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/unreal/" title="分类于 UE">UE</a></div><span><a href="/learning/unreal/UE%20Delegate/" title="UE Delegate">UE Delegate</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/learning/unreal/UE5%20%E6%9D%82%E9%A1%B9%E8%AE%B0%E5%BD%95/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/japanese/" title="分类于 日语">日语</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/japanese/primary/" title="分类于 日语初级">日语初级</a></div><span><a href="/learning/japanese/primary/%E5%8A%A8%E8%AF%8D%E7%AF%87/" title="动词篇">动词篇</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/cpp/" title="分类于 cpp">cpp</a></div><span><a href="/learning/programlanguage/cpp/%E5%8D%81%E5%9B%9B%E3%80%81C++%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81%E9%87%8D%E7%94%A8/" title="十四、C++中的代码重用">十四、C++中的代码重用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game202/" title="分类于 GAME202高质量实时渲染">GAME202高质量实时渲染</a></div><span><a href="/learning/games/Game202/%E4%B8%83%E3%80%81Practical%20Industrial%20Solutions/" title="七、Practical Industrial Solutions">七、Practical Industrial Solutions</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/physx/" title="分类于 物理引擎">物理引擎</a></div><span><a href="/learning/physx/PhysX%E5%86%85%E7%BD%AE%E5%AE%B9%E5%99%A8%E4%BB%8B%E7%BB%8D/" title="PhysX内置容器介绍">PhysX内置容器介绍</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/algorithm/" title="分类于 算法">算法</a> <i class="ic i-angle-right"></i> <a href="/categories/algorithm/random/" title="分类于 随机">随机</a></div><span><a href="/algorithm/random/random_number/" title="随机数测试">随机数测试</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/cpp/" title="分类于 cpp">cpp</a></div><span><a href="/learning/programlanguage/cpp/%E5%8D%81%E4%BA%8C%E3%80%81%E7%B1%BB%E5%92%8C%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/" title="十二、类和动态内存分配">十二、类和动态内存分配</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">鑫酱(●'◡'●) @ 个人博客</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">523k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">7:55</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"learning/games/Game202/二、Real-time Shadows/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/animejs@3.2.0/lib/anime.min.js,npm/katex@0.12.0/dist/contrib/copy-tex.min.js,npm/frappe-charts@1.5.0/dist/frappe-charts.min.iife.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/quicklink@2/dist/quicklink.umd.js,gh/amehime/MiniValine@4.2.2-beta10/dist/MiniValine.min.js"></script><script src="/js/app.js?v=0.2.5"></script><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b6d809b500bd6f0040117088899bc7bf";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>