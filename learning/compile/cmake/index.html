<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="XqWEZ-KjvQT4IfXzxYvH-PEc--_zN6GqthY2jBsqOs4"><meta name="msvalidate.01" content="4E28E3FDD5912EBBB84869B17359650D"><meta name="baidu-site-verification" content="code-dwpSTDBLS2"><link rel="alternate" type="application/rss+xml" title="鑫酱" href="https://hakuya.me/rss.xml"><link rel="alternate" type="application/atom+xml" title="鑫酱" href="https://hakuya.me/atom.xml"><link rel="alternate" type="application/json" title="鑫酱" href="https://hakuya.me/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="cmake,编译"><link rel="canonical" href="https://hakuya.me/learning/compile/cmake/"><title>cmake - 编译相关 - 学习 | 个人博客 = 鑫酱 = 笔记本</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">cmake</h1><div class="meta"><span class="item" title="创建时间：2022-04-24 15:02:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-04-24T15:02:00+08:00">2022-04-24</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>16k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>14 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">个人博客</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (10).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (1).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (6).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (18).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper_6.jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper_5.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learning/" itemprop="item" rel="index" title="分类于 学习"><span itemprop="name">学习</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learning/compile/" itemprop="item" rel="index" title="分类于 编译相关"><span itemprop="name">编译相关</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://hakuya.me/learning/compile/cmake/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="鑫酱(●'◡'●)"><meta itemprop="description" content="笔记本, 整天摸鱼，却妄想拯救世界的技术宅"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="鑫酱"></span><div class="body md" itemprop="articleBody"><div class="note info"><p>以下为个人学习笔记整理。<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMXZSNHkxdTc3aD9zcG1faWRfZnJvbT0zMzMuOTk5LjAuMA==">B 站课程传送门</span></p></div><h1 id="cmake"><a class="anchor" href="#cmake">#</a> CMake</h1><p>CMake 是用来统一编译代码，相当于是执行编译的自动化脚本。定义 CMakeLists.txt 以后，就不需要对项目代码进行逐个的编译。</p><h2 id="编译一个简单代码"><a class="anchor" href="#编译一个简单代码">#</a> 编译一个简单代码</h2><blockquote><p>main.cpp</p></blockquote><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"hello world"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>CMakeLists.txt</p></blockquote><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">project</span><span class="token punctuation">(</span>CMakeTest<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">set</span><span class="token punctuation">(</span>SRC_LIST main.cpp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">message</span><span class="token punctuation">(</span>STATUS <span class="token string">"This is BINARY dir "</span> <span class="token punctuation">$&#123;</span><span class="token variable">HELLO_BINARY_DIR</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">message</span><span class="token punctuation">(</span>STATUS <span class="token string">"This is SOURCE dir "</span> <span class="token punctuation">$&#123;</span><span class="token variable">HELLO_SOURCE_DIR</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello <span class="token punctuation">$&#123;</span>SRC_LIST<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>在命令行执行 <code>cmake .</code> 表示运行当前目录下的 CMakeLists.txt</p><blockquote><p>output</p></blockquote><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>-- The C compiler identification is GNU <span class="token number">7.3</span>.1</pre></td></tr><tr><td data-num="2"></td><td><pre>-- The CXX compiler identification is GNU <span class="token number">7.3</span>.1</pre></td></tr><tr><td data-num="3"></td><td><pre>-- Check <span class="token keyword">for</span> working C compiler: /usr/lib64/ccache/cc</pre></td></tr><tr><td data-num="4"></td><td><pre>-- Check <span class="token keyword">for</span> working C compiler: /usr/lib64/ccache/cc - works</pre></td></tr><tr><td data-num="5"></td><td><pre>-- Detecting C compiler ABI info</pre></td></tr><tr><td data-num="6"></td><td><pre>-- Detecting C compiler ABI info - <span class="token keyword">done</span></pre></td></tr><tr><td data-num="7"></td><td><pre>-- Detecting C compile features</pre></td></tr><tr><td data-num="8"></td><td><pre>-- Detecting C compile features - <span class="token keyword">done</span></pre></td></tr><tr><td data-num="9"></td><td><pre>-- Check <span class="token keyword">for</span> working CXX compiler: /usr/lib64/ccache/c++</pre></td></tr><tr><td data-num="10"></td><td><pre>-- Check <span class="token keyword">for</span> working CXX compiler: /usr/lib64/ccache/c++ - works</pre></td></tr><tr><td data-num="11"></td><td><pre>-- Detecting CXX compiler ABI info</pre></td></tr><tr><td data-num="12"></td><td><pre>-- Detecting CXX compiler ABI info - <span class="token keyword">done</span></pre></td></tr><tr><td data-num="13"></td><td><pre>-- Detecting CXX compile features</pre></td></tr><tr><td data-num="14"></td><td><pre>-- Detecting CXX compile features - <span class="token keyword">done</span></pre></td></tr><tr><td data-num="15"></td><td><pre>-- This is BINARY <span class="token function">dir</span> /data/rwbyguo/cmake_test</pre></td></tr><tr><td data-num="16"></td><td><pre>-- This is SOURCE <span class="token function">dir</span> /data/rwbyguo/cmake_test</pre></td></tr><tr><td data-num="17"></td><td><pre>-- Configuring <span class="token keyword">done</span></pre></td></tr><tr><td data-num="18"></td><td><pre>-- Generating <span class="token keyword">done</span></pre></td></tr><tr><td data-num="19"></td><td><pre>-- Build files have been written to: /data/rwbyguo/cmake_test</pre></td></tr></table></figure><p>会发现多出来了几个文件</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre>├── CMakeCache<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="3"></td><td><pre>├── CMakeFiles</pre></td></tr><tr><td data-num="4"></td><td><pre>│   ├── <span class="token number">3.17</span><span class="token punctuation">.</span><span class="token number">2</span></pre></td></tr><tr><td data-num="5"></td><td><pre>│   │   ├── CMakeCCompiler<span class="token punctuation">.</span>cmake</pre></td></tr><tr><td data-num="6"></td><td><pre>│   │   ├── CMakeCXXCompiler<span class="token punctuation">.</span>cmake</pre></td></tr><tr><td data-num="7"></td><td><pre>│   │   ├── CMakeDetermineCompilerABI_C<span class="token punctuation">.</span>bin</pre></td></tr><tr><td data-num="8"></td><td><pre>│   │   ├── CMakeDetermineCompilerABI_CXX<span class="token punctuation">.</span>bin</pre></td></tr><tr><td data-num="9"></td><td><pre>│   │   ├── CMakeSystem<span class="token punctuation">.</span>cmake</pre></td></tr><tr><td data-num="10"></td><td><pre>│   │   ├── CompilerIdC</pre></td></tr><tr><td data-num="11"></td><td><pre>│   │   │   ├── a<span class="token punctuation">.</span>out</pre></td></tr><tr><td data-num="12"></td><td><pre>│   │   │   ├── CMakeCCompilerId<span class="token punctuation">.</span>c</pre></td></tr><tr><td data-num="13"></td><td><pre>│   │   │   └── tmp</pre></td></tr><tr><td data-num="14"></td><td><pre>│   │   └── CompilerIdCXX</pre></td></tr><tr><td data-num="15"></td><td><pre>│   │       ├── a<span class="token punctuation">.</span>out</pre></td></tr><tr><td data-num="16"></td><td><pre>│   │       ├── CMakeCXXCompilerId<span class="token punctuation">.</span>cpp</pre></td></tr><tr><td data-num="17"></td><td><pre>│   │       └── tmp</pre></td></tr><tr><td data-num="18"></td><td><pre>│   ├── cmake<span class="token punctuation">.</span>check_cache</pre></td></tr><tr><td data-num="19"></td><td><pre>│   ├── CMakeDirectoryInformation<span class="token punctuation">.</span>cmake</pre></td></tr><tr><td data-num="20"></td><td><pre>│   ├── CMakeOutput<span class="token punctuation">.</span>log</pre></td></tr><tr><td data-num="21"></td><td><pre>│   ├── CMakeTmp</pre></td></tr><tr><td data-num="22"></td><td><pre>│   ├── hello<span class="token punctuation">.</span>dir</pre></td></tr><tr><td data-num="23"></td><td><pre>│   │   ├── build<span class="token punctuation">.</span>make</pre></td></tr><tr><td data-num="24"></td><td><pre>│   │   ├── cmake_clean<span class="token punctuation">.</span>cmake</pre></td></tr><tr><td data-num="25"></td><td><pre>│   │   ├── CXX<span class="token punctuation">.</span>includecache</pre></td></tr><tr><td data-num="26"></td><td><pre>│   │   ├── DependInfo<span class="token punctuation">.</span>cmake</pre></td></tr><tr><td data-num="27"></td><td><pre>│   │   ├── depend<span class="token punctuation">.</span>internal</pre></td></tr><tr><td data-num="28"></td><td><pre>│   │   ├── depend<span class="token punctuation">.</span>make</pre></td></tr><tr><td data-num="29"></td><td><pre>│   │   ├── flags<span class="token punctuation">.</span>make</pre></td></tr><tr><td data-num="30"></td><td><pre>│   │   ├── link<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="31"></td><td><pre>│   │   ├── main<span class="token punctuation">.</span>cpp<span class="token punctuation">.</span>o</pre></td></tr><tr><td data-num="32"></td><td><pre>│   │   └── progress<span class="token punctuation">.</span>make</pre></td></tr><tr><td data-num="33"></td><td><pre>│   ├── Makefile2</pre></td></tr><tr><td data-num="34"></td><td><pre>│   ├── Makefile<span class="token punctuation">.</span>cmake</pre></td></tr><tr><td data-num="35"></td><td><pre>│   ├── progress<span class="token punctuation">.</span>marks</pre></td></tr><tr><td data-num="36"></td><td><pre>│   └── TargetDirectories<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="37"></td><td><pre>├── cmake_install<span class="token punctuation">.</span>cmake</pre></td></tr><tr><td data-num="38"></td><td><pre>├── CMakeLists<span class="token punctuation">.</span>txt <span class="token comment">//</span></pre></td></tr><tr><td data-num="39"></td><td><pre>├── main<span class="token punctuation">.</span>cpp <span class="token comment">//</span></pre></td></tr><tr><td data-num="40"></td><td><pre>└── Makefile</pre></td></tr></table></figure><p>在执行 make 操作，来编译生成的 Makefile</p><blockquote><p>output</p></blockquote><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>rwbyguo@VM-218-157-centos cmake_test<span class="token punctuation">]</span><span class="token variable">$make</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Scanning dependencies of target hello</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello.dir/main.cpp.o</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable hello</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target hello</pre></td></tr></table></figure><p>会得到一个编译后的可执行文件 hello</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">|</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="3"></td><td><pre>├── hello <span class="token comment">// new</span></pre></td></tr><tr><td data-num="4"></td><td><pre>├── main<span class="token punctuation">.</span>cpp</pre></td></tr><tr><td data-num="5"></td><td><pre>└── Makefile</pre></td></tr><tr><td data-num="6"></td><td><pre>    </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>rwbyguo@VM<span class="token operator">-</span><span class="token number">218</span><span class="token operator">-</span><span class="token number">157</span><span class="token operator">-</span>centos cmake_test<span class="token punctuation">]</span>$<span class="token punctuation">.</span><span class="token operator">/</span>hello </pre></td></tr><tr><td data-num="8"></td><td><pre>hello world</pre></td></tr></table></figure><h2 id="语法介绍"><a class="anchor" href="#语法介绍">#</a> 语法介绍</h2><h3 id="project-关键字"><a class="anchor" href="#project-关键字">#</a> project 关键字</h3><p>指定工程名和支持语言，默认情况下支持所有语言 <code>project($&#123;project_name&#125; [language])</code></p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">project</span><span class="token punctuation">(</span>CMakeTest<span class="token punctuation">)</span>  		<span class="token comment"># 支持所有语言</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">project</span><span class="token punctuation">(</span>CMakeTest CXX<span class="token punctuation">)</span>		<span class="token comment"># 支持 c++</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">project</span><span class="token punctuation">(</span>CMakeTest C CXX<span class="token punctuation">)</span>	<span class="token comment"># 支持 c++ 和 c</span></pre></td></tr></table></figure><p>该指令会隐式创建两个变量 <code>$&#123;project_name&#125;_BINARY_DIR</code> 、 <code>$&#123;project_name&#125;_SOURCE_DIR</code></p><p>另外还有两个预定义变量值和它们一致 <code>PROJECT_BINARY_DIR</code> 、 <code>PROJECT_SOURCE_DIR</code></p><h3 id="set-关键字"><a class="anchor" href="#set-关键字">#</a> set 关键字</h3><p>声明变量，并且支持多个</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">set</span><span class="token punctuation">(</span>SRC_LIST main.cpp m1.cpp m2.cpp<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="message-关键字"><a class="anchor" href="#message-关键字">#</a> message 关键字</h3><p>向终端输出用户自定义的信息，类似 print。包含多种类型的信息，具体说明参考<span class="exturl" data-url="aHR0cHM6Ly9jbWFrZS5vcmcvY21ha2UvaGVscC92My4wL2NvbW1hbmQvbWVzc2FnZS5odG1s">官方文档</span>：</p><ul><li>SEND_ERROR：产生错误，会继续运行 CMakeLists.txt 内的指令，但是不会构建</li><li>STATUS：输出前缀带有「— —」的信息</li><li>FAIL_ERROR：终止运行 CMakeLists.txt 内的指令，且停止构建</li><li>WARNING：警告，但是会继续运行和构建</li></ul><h3 id="add_executable-关键字"><a class="anchor" href="#add_executable-关键字">#</a> add_executable 关键字</h3><p>用来生成可执行文件，包含两个参数，一个是可执行文件名，一个是源文件： <code>add_executable($&#123;executable_name&#125; $&#123;source_list&#125;)</code></p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello main.cpp m1.cpp m2.cpp<span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="语法的基本原则"><a class="anchor" href="#语法的基本原则">#</a> 语法的基本原则</h2><ul><li>变量值的获取需要使用 <code>$&#123;&#125;</code> ，如果在 IF 语句内使用变量则可直接用变量名。</li><li>指令内的参数都是用 <code>()</code> 包裹，参数之间可以用 <code>;</code> 或者 空格 分隔。</li><li>关键字不区分大小写，但是参数和变量区分大小写。</li></ul><h3 id="注意事项"><a class="anchor" href="#注意事项">#</a> 注意事项</h3><ul><li>set 指令如果参数里面带有空格的话，需要用双引号括起来 <code>&quot;arg 1&quot;</code></li><li>add_executable 指令内的源文件可以不加 <code>.cpp</code> 后缀，但是建议还是加上</li></ul><h2 id="内部构建和外部构建"><a class="anchor" href="#内部构建和外部构建">#</a> 内部构建和外部构建</h2><ul><li>上面例子就是内部构建，会获得很多临时文件</li><li>外部构建可以指定生成文件都放在单独的目录下，推荐使用外部构建</li></ul><p>外部构建介绍：</p><p>在目录下创建一个单独的目录 <code>debugbuild</code> ，然后在 <code>debugbuild</code> 执行 <code>cmake ..</code> 即可</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>rwbyguo@VM-218-157-centos cmake_test<span class="token punctuation">]</span><span class="token variable">$cd</span> debugbuild/</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>rwbyguo@VM-218-157-centos debugbuild<span class="token punctuation">]</span><span class="token variable">$cmake</span> <span class="token punctuation">..</span></pre></td></tr><tr><td data-num="3"></td><td><pre>-- The C compiler identification is GNU <span class="token number">7.3</span>.1</pre></td></tr><tr><td data-num="4"></td><td><pre>-- The CXX compiler identification is GNU <span class="token number">7.3</span>.1</pre></td></tr><tr><td data-num="5"></td><td><pre>-- Check <span class="token keyword">for</span> working C compiler: /usr/lib64/ccache/cc</pre></td></tr><tr><td data-num="6"></td><td><pre>-- Check <span class="token keyword">for</span> working C compiler: /usr/lib64/ccache/cc - works</pre></td></tr><tr><td data-num="7"></td><td><pre>-- Detecting C compiler ABI info</pre></td></tr><tr><td data-num="8"></td><td><pre>-- Detecting C compiler ABI info - <span class="token keyword">done</span></pre></td></tr><tr><td data-num="9"></td><td><pre>-- Detecting C compile features</pre></td></tr><tr><td data-num="10"></td><td><pre>-- Detecting C compile features - <span class="token keyword">done</span></pre></td></tr><tr><td data-num="11"></td><td><pre>-- Check <span class="token keyword">for</span> working CXX compiler: /usr/lib64/ccache/c++</pre></td></tr><tr><td data-num="12"></td><td><pre>-- Check <span class="token keyword">for</span> working CXX compiler: /usr/lib64/ccache/c++ - works</pre></td></tr><tr><td data-num="13"></td><td><pre>-- Detecting CXX compiler ABI info</pre></td></tr><tr><td data-num="14"></td><td><pre>-- Detecting CXX compiler ABI info - <span class="token keyword">done</span></pre></td></tr><tr><td data-num="15"></td><td><pre>-- Detecting CXX compile features</pre></td></tr><tr><td data-num="16"></td><td><pre>-- Detecting CXX compile features - <span class="token keyword">done</span></pre></td></tr><tr><td data-num="17"></td><td><pre>-- This is BINARY <span class="token function">dir</span> /data/rwbyguo/cmake_test/debugbuild</pre></td></tr><tr><td data-num="18"></td><td><pre>-- This is SOURCE <span class="token function">dir</span> /data/rwbyguo/cmake_test</pre></td></tr><tr><td data-num="19"></td><td><pre>-- Configuring <span class="token keyword">done</span></pre></td></tr><tr><td data-num="20"></td><td><pre>-- Generating <span class="token keyword">done</span></pre></td></tr><tr><td data-num="21"></td><td><pre>-- Build files have been written to: /data/rwbyguo/cmake_test/debugbuild</pre></td></tr></table></figure><p>这时候它的 <code>BINARY</code> 和 <code>SOURCE</code> 路径就不一样了。</p><h2 id="编译一个工程"><a class="anchor" href="#编译一个工程">#</a> 编译一个工程</h2><h3 id="工程目录结构"><a class="anchor" href="#工程目录结构">#</a> 工程目录结构</h3><p>常规的 C++ 工程目录如下，需要编译哪个目录就在哪个目录下面创建一个 CMakeLists.txt：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre>├── CMakeLists<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="3"></td><td><pre>├── debugbuild			<span class="token comment">//cmake 生成的文件路径</span></pre></td></tr><tr><td data-num="4"></td><td><pre>├── external			<span class="token comment">// 存放项目引用的第三方库</span></pre></td></tr><tr><td data-num="5"></td><td><pre>│   └── CMakeLists<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="6"></td><td><pre>├── resource			<span class="token comment">// 存放项目资源文件</span></pre></td></tr><tr><td data-num="7"></td><td><pre>├── run</pre></td></tr><tr><td data-num="8"></td><td><pre>│   └── bin				<span class="token comment">// 存放项目可执行的 bin 文件</span></pre></td></tr><tr><td data-num="9"></td><td><pre>└── src					<span class="token comment">// 存放项目代码</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    ├── CMakeLists<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="11"></td><td><pre>    └── main<span class="token punctuation">.</span>cpp</pre></td></tr></table></figure><h2 id="进阶语法"><a class="anchor" href="#进阶语法">#</a> 进阶语法</h2><h3 id="file-关键字"><a class="anchor" href="#file-关键字">#</a> file 关键字</h3><p>文件操作命令，用法：</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>WRITE filename <span class="token string">"message to write"</span>... <span class="token punctuation">)</span> <span class="token comment"># 将消息写入 filename</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>APPEND filename <span class="token string">"message to write"</span>... <span class="token punctuation">)</span> <span class="token comment"># 将消息追加写入 filename</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>READ filename variable [LIMIT numBytes] [OFFSET offset] [HEX]<span class="token punctuation">)</span> <span class="token comment"># 从 filename 读取消息到 variable</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>&lt;MD5|SHA1|SHA224|SHA256|SHA384|SHA512<span class="token punctuation">></span> filename variable<span class="token punctuation">)</span> <span class="token comment"># 计算 filename 的加密哈希到 variable</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span><span class="token property">STRINGS</span> filename variable [LIMIT_COUNT num] <span class="token comment"># 将解析 filename 中的 ASCII 字符串列表并将其存储在 variable 中。二进制数据 和 回车会被忽略</span></pre></td></tr><tr><td data-num="6"></td><td><pre>     [LIMIT_INPUT numBytes] [LIMIT_OUTPUT numBytes]</pre></td></tr><tr><td data-num="7"></td><td><pre>     [LENGTH_MINIMUM numBytes] [LENGTH_MAXIMUM numBytes]</pre></td></tr><tr><td data-num="8"></td><td><pre>     [NEWLINE_CONSUME] [REGEX regex]</pre></td></tr><tr><td data-num="9"></td><td><pre>     [NO_HEX_CONVERSION]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>GLOB variable [RELATIVE path] [globbing expressions]...<span class="token punctuation">)</span> <span class="token comment"># 生成 variable 用来存储 RELATIVE path 下所有满足 globbing expressions 的文件</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>GLOB_RECURSE variable [RELATIVE path] <span class="token comment"># 和 GLOB 类似，但不仅仅匹配文件，还匹配目录</span></pre></td></tr><tr><td data-num="12"></td><td><pre>     [FOLLOW_SYMLINKS] [globbing expressions]...<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>RENAME &lt;oldname<span class="token punctuation">></span> &lt;newname<span class="token punctuation">></span><span class="token punctuation">)</span> <span class="token comment"># 移动文件或目录，操作是原子性的</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>REMOVE [file1 ...]<span class="token punctuation">)</span> <span class="token comment"># 删除文件，包括子目录</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>REMOVE_RECURSE [file1 ...]<span class="token punctuation">)</span> <span class="token comment"># 删除目录或文件，包括子目录</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>MAKE_DIRECTORY [directory1 directory2 ...]<span class="token punctuation">)</span> <span class="token comment"># 创建目录，支持不存在父目录的创建</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>RELATIVE_PATH variable directory file<span class="token punctuation">)</span> <span class="token comment"># 获取 directory 和 file 的相对路径关系并保存在 variable。</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>TO_CMAKE_PATH path result<span class="token punctuation">)</span> <span class="token comment"># 将路径转为 unix 的 cmake 样式</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>TO_NATIVE_PATH path result<span class="token punctuation">)</span> <span class="token comment"># 将路径转为 windows 的 cmake 样式</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>DOWNLOAD url file [INACTIVITY_TIMEOUT timeout] <span class="token comment"># 将 url 内容下载到 file</span></pre></td></tr><tr><td data-num="21"></td><td><pre>     [<span class="token property">TIMEOUT</span> timeout] [STATUS status] [LOG log] [SHOW_PROGRESS]</pre></td></tr><tr><td data-num="22"></td><td><pre>     [EXPECTED_HASH ALGO=value] [EXPECTED_MD5 sum]</pre></td></tr><tr><td data-num="23"></td><td><pre>     [TLS_VERIFY on|off] [TLS_CAINFO file]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>UPLOAD filename url [INACTIVITY_TIMEOUT timeout] <span class="token comment"># 将 filename 内容上传到 url</span></pre></td></tr><tr><td data-num="25"></td><td><pre>     [<span class="token property">TIMEOUT</span> timeout] [STATUS status] [LOG log] [SHOW_PROGRESS]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>TIMESTAMP filename variable [&lt;format string<span class="token punctuation">></span>] [UTC]<span class="token punctuation">)</span> <span class="token comment"># 获取 filename 修改的时间字符串到 variable</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>GENERATE OUTPUT output_file <span class="token comment"># 将 input_file | input_content 内容写入 output_file</span></pre></td></tr><tr><td data-num="28"></td><td><pre>     &lt;INPUT input_file|CONTENT input_content<span class="token punctuation">></span></pre></td></tr><tr><td data-num="29"></td><td><pre>     [CONDITION expression]<span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="常见用法"><a class="anchor" href="#常见用法">#</a> 常见用法：</h4><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">file</span><span class="token punctuation">(</span>GLOB_RECURSE my_src *.cpp *.h<span class="token punctuation">)</span> <span class="token comment"># 获取当前路径下的所有 .cpp 和 .h</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">add_executable</span><span class="token punctuation">(</span>my_executable <span class="token punctuation">$&#123;</span>my_src<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment"># 编译出可执行文件</span></pre></td></tr></table></figure><h3 id="macroendmacro-关键字"><a class="anchor" href="#macroendmacro-关键字">#</a> macro/endmacro 关键字</h3><p>定义宏，用来给其他 CMakeLists.txt 使用。</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">macro</span><span class="token punctuation">(</span>&lt;name<span class="token punctuation">></span> [arg1 [arg2 [arg3 ...]]]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token comment"># dosomthing ...</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">endmacro</span><span class="token punctuation">(</span>&lt;name<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="include-关键字"><a class="anchor" href="#include-关键字">#</a> include 关键字</h3><p>引用 .cmake 文件，使用其中定义的变量或者其他函数</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">include</span><span class="token punctuation">(</span>&lt;file|module<span class="token punctuation">></span> [OPTIONAL] [RESULT_VARIABLE &lt;VAR<span class="token punctuation">></span>]</pre></td></tr><tr><td data-num="2"></td><td><pre>                      [NO_POLICY_SCOPE]<span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="配合-macro-使用"><a class="anchor" href="#配合-macro-使用">#</a> 配合 macro 使用：</h4><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># xxx.cmake</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">macro</span><span class="token punctuation">(</span>myfunc msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">message</span><span class="token punctuation">(</span>STATUS <span class="token punctuation">$&#123;</span>msg<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">endmacro</span><span class="token punctuation">(</span>myfunc msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># CMakeLists.txt</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">include</span><span class="token punctuation">(</span>xxx.cmake<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">myfunc</span><span class="token punctuation">(</span><span class="token string">"this is msg"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="ifendif-关键字"><a class="anchor" href="#ifendif-关键字">#</a> if/endif 关键字</h3><p>条件语句：</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token comment"># dosomthing ...</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">elseif</span> <span class="token punctuation">(</span>expression<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token comment"># dosomthing ...</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="foreachendforeach-关键字"><a class="anchor" href="#foreachendforeach-关键字">#</a> foreach/endforeach 关键字</h3><p>循环语句，语法和 python 比较类似：</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">foreach</span><span class="token punctuation">(</span>loop_var arg1 arg2 ...<span class="token punctuation">)</span> <span class="token comment"># foreach(var IN list_xxx) | foreach(var RANGE start stop [step])</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token comment"># dosomthing ...</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">endforeach</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="configure_file-关键字"><a class="anchor" href="#configure_file-关键字">#</a> configure_file 关键字</h3><p>将一个文件复制到另一个位置，并对文件内容进行修改</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">configure_file</span><span class="token punctuation">(</span>&lt;input<span class="token punctuation">></span> &lt;output<span class="token punctuation">></span></pre></td></tr><tr><td data-num="2"></td><td><pre>               [COPYONLY] [ESCAPE_QUOTES] [@ONLY]</pre></td></tr><tr><td data-num="3"></td><td><pre>               [NEWLINE_STYLE [<span class="token variable">UNIX</span>|DOS|<span class="token variable">WIN32</span>|LF|CRLF] ]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>               </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># example</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">configure_file</span><span class="token punctuation">(</span>file1 /src/file1<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="math-关键字"><a class="anchor" href="#math-关键字">#</a> math 关键字</h3><p>进行数学运算的函数</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">math</span><span class="token punctuation">(</span>EXPR &lt;output variable<span class="token punctuation">></span> &lt;math expression<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># example</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">math</span><span class="token punctuation">(</span>EXPR var <span class="token string">"8 * 8"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="string-关键字"><a class="anchor" href="#string-关键字">#</a> string 关键字</h3><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>REGEX MATCH &lt;regular_expression<span class="token punctuation">></span>		<span class="token comment"># 正则匹配字符串，返回首个匹配项</span></pre></td></tr><tr><td data-num="2"></td><td><pre>       &lt;output variable<span class="token punctuation">></span> &lt;input<span class="token punctuation">></span> [&lt;input<span class="token punctuation">></span>...]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>REGEX MATCHALL &lt;regular_expression<span class="token punctuation">></span>	<span class="token comment"># 正则匹配字符串，尽可能多的匹配</span></pre></td></tr><tr><td data-num="4"></td><td><pre>       &lt;output variable<span class="token punctuation">></span> &lt;input<span class="token punctuation">></span> [&lt;input<span class="token punctuation">></span>...]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>REGEX REPLACE &lt;regular_expression<span class="token punctuation">></span>	<span class="token comment"># 正则匹配字符串，尽可能多的匹配，匹配成功后进行替换</span></pre></td></tr><tr><td data-num="6"></td><td><pre>       &lt;replace_expression<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span></pre></td></tr><tr><td data-num="7"></td><td><pre>       &lt;input<span class="token punctuation">></span> [&lt;input<span class="token punctuation">></span>...]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>REPLACE &lt;match_string<span class="token punctuation">></span>			  <span class="token comment"># 非正则模式下尽可能多的字符串匹配和替换</span></pre></td></tr><tr><td data-num="9"></td><td><pre>       &lt;replace_string<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span></pre></td></tr><tr><td data-num="10"></td><td><pre>       &lt;input<span class="token punctuation">></span> [&lt;input<span class="token punctuation">></span>...]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>CONCAT &lt;output variable<span class="token punctuation">></span> [&lt;input<span class="token punctuation">></span>...]<span class="token punctuation">)</span> <span class="token comment"># 字符串拼接类似 "".join</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>&lt;MD5|SHA1|SHA224|SHA256|SHA384|SHA512<span class="token punctuation">></span> <span class="token comment"># 计算字符串的加密哈希</span></pre></td></tr><tr><td data-num="13"></td><td><pre>       &lt;output variable<span class="token punctuation">></span> &lt;input<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># 字符串比较</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>COMPARE <span class="token operator">EQUAL</span> &lt;string1<span class="token punctuation">></span> &lt;string2<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>COMPARE NOTEQUAL &lt;string1<span class="token punctuation">></span> &lt;string2<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>COMPARE <span class="token operator">LESS</span> &lt;string1<span class="token punctuation">></span> &lt;string2<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>COMPARE <span class="token operator">GREATER</span> &lt;string1<span class="token punctuation">></span> &lt;string2<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>ASCII &lt;number<span class="token punctuation">></span> [&lt;number<span class="token punctuation">></span> ...] &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span> <span class="token comment"># 将字符串中的数字转为 ASCII 编码</span></pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token comment"># 字符串转换</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>CONFIGURE &lt;string1<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span></pre></td></tr><tr><td data-num="23"></td><td><pre>       [@ONLY] [ESCAPE_QUOTES]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>TOUPPER &lt;string1<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>TOLOWER &lt;string1<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>LENGTH &lt;string<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span> <span class="token comment"># 获取长度</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>SUBSTRING &lt;string<span class="token punctuation">></span> &lt;begin<span class="token punctuation">></span> &lt;length<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span> <span class="token comment"># 字符串切片</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>STRIP &lt;string<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span> <span class="token comment"># 字符去空格和 tab</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>RANDOM [LENGTH &lt;length<span class="token punctuation">></span>] [ALPHABET &lt;alphabet<span class="token punctuation">></span>] <span class="token comment"># 生成固定长度随机字符串</span></pre></td></tr><tr><td data-num="31"></td><td><pre>       [RANDOM_SEED &lt;seed<span class="token punctuation">></span>] &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>FIND &lt;string<span class="token punctuation">></span> &lt;substring<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span> [REVERSE]<span class="token punctuation">)</span> <span class="token comment"># 查找给定字串的下标</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>TIMESTAMP &lt;output variable<span class="token punctuation">></span> [&lt;format string<span class="token punctuation">></span>] [UTC]<span class="token punctuation">)</span> <span class="token comment"># 输出当前时间字符串</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">string</span><span class="token punctuation">(</span>MAKE_C_IDENTIFIER &lt;input string<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span> <span class="token comment"># will write a string which can be used as an identifier in C.</span></pre></td></tr></table></figure><h3 id="option-关键字"><a class="anchor" href="#option-关键字">#</a> option 关键字</h3><p>相当于创建一个 bool 类型的变量</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">option</span><span class="token punctuation">(</span>&lt;option_variable<span class="token punctuation">></span> <span class="token string">"help string describing option"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>       [initial value]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>       </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># example</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">option</span><span class="token punctuation">(</span>NEED_CHECK_CONFIG <span class="token string">"是否需要检查配置"</span> <span class="token boolean">ON</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>NEED_CHECK_CONFIG<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token comment"># dosomething ...</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">endif</span> <span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="add_definitions-关键字"><a class="anchor" href="#add_definitions-关键字">#</a> add_definitions 关键字</h3><p>搭配 option 使用，可以指定某个 option 不生效</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">add_definitions</span><span class="token punctuation">(</span>-DFOO -DBAR ...<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># example</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">add_definitions</span><span class="token punctuation">(</span><span class="token string">"-DNEED_CHECK_CONFIG"</span><span class="token punctuation">)</span> <span class="token comment"># NEED_CHECK_CONFIG  on -> off</span></pre></td></tr></table></figure><h3 id="list-关键字"><a class="anchor" href="#list-关键字">#</a> list 关键字</h3><p>比较简单，就是 list 容器和各项操作</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">list</span><span class="token punctuation">(</span>LENGTH &lt;list<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">list</span><span class="token punctuation">(</span>GET &lt;list<span class="token punctuation">></span> &lt;element index<span class="token punctuation">></span> [&lt;element index<span class="token punctuation">></span> ...]</pre></td></tr><tr><td data-num="3"></td><td><pre>     &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">list</span><span class="token punctuation">(</span>APPEND &lt;list<span class="token punctuation">></span> [&lt;element<span class="token punctuation">></span> ...]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">list</span><span class="token punctuation">(</span>FIND &lt;list<span class="token punctuation">></span> &lt;value<span class="token punctuation">></span> &lt;output variable<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">list</span><span class="token punctuation">(</span>INSERT &lt;list<span class="token punctuation">></span> &lt;element_index<span class="token punctuation">></span> &lt;element<span class="token punctuation">></span> [&lt;element<span class="token punctuation">></span> ...]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">list</span><span class="token punctuation">(</span>REMOVE_ITEM &lt;list<span class="token punctuation">></span> &lt;value<span class="token punctuation">></span> [&lt;value<span class="token punctuation">></span> ...]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">list</span><span class="token punctuation">(</span>REMOVE_AT &lt;list<span class="token punctuation">></span> &lt;index<span class="token punctuation">></span> [&lt;index<span class="token punctuation">></span> ...]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">list</span><span class="token punctuation">(</span>REMOVE_DUPLICATES &lt;list<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">list</span><span class="token punctuation">(</span>REVERSE &lt;list<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">list</span><span class="token punctuation">(</span>SORT &lt;list<span class="token punctuation">></span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="install-关键字"><a class="anchor" href="#install-关键字">#</a> install 关键字</h3><p>指定执行 <code>cmake install</code> 时运行的安装规则。<span class="exturl" data-url="aHR0cHM6Ly9jbWFrZS5vcmcvY21ha2UvaGVscC9sYXRlc3QvY29tbWFuZC9pbnN0YWxsLmh0bWw=">官方文档</span></p><p>其中，一个内置变量经常被使用： <code>CMAKE_INSTALL_PREFIX=/usr/local</code></p><h4 id="常见安装模板"><a class="anchor" href="#常见安装模板">#</a> 常见安装模板</h4><p>安装非目标程序（shell 脚本）</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">install</span><span class="token punctuation">(</span>&lt;FILES|PROGRAMS<span class="token punctuation">></span> files... DESTINATION &lt;dir<span class="token punctuation">></span></pre></td></tr><tr><td data-num="2"></td><td><pre>        [PERMISSIONS permissions...]</pre></td></tr><tr><td data-num="3"></td><td><pre>        [CONFIGURATIONS [Debug|Release|...]]</pre></td></tr><tr><td data-num="4"></td><td><pre>        [COMPONENT &lt;component<span class="token punctuation">></span>]</pre></td></tr><tr><td data-num="5"></td><td><pre>        [RENAME &lt;name<span class="token punctuation">></span>] [OPTIONAL]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># example FILES</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 把 README COPYRIGHT 两个文件安装到 $&#123;CMAKE_INSTALL_PREFIX&#125;/doc 下</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">install</span><span class="token punctuation">(</span>FILES README COPYRIGHT DESTINATION /doc<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># example PROGRAMS</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 把 build.sh 安装到 $&#123;CMAKE_INSTALL_PREFIX&#125;/shell 下</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">install</span><span class="token punctuation">(</span>PROGRAMS build.sh DESTINATION /shell<span class="token punctuation">)</span></pre></td></tr></table></figure><p>安装一个或多个目录内容：</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">install</span><span class="token punctuation">(</span>DIRECTORY dirs... DESTINATION &lt;dir<span class="token punctuation">></span></pre></td></tr><tr><td data-num="2"></td><td><pre>        [FILE_PERMISSIONS permissions...]</pre></td></tr><tr><td data-num="3"></td><td><pre>        [DIRECTORY_PERMISSIONS permissions...]</pre></td></tr><tr><td data-num="4"></td><td><pre>        [USE_SOURCE_PERMISSIONS] [OPTIONAL]</pre></td></tr><tr><td data-num="5"></td><td><pre>        [CONFIGURATIONS [Debug|Release|...]]</pre></td></tr><tr><td data-num="6"></td><td><pre>        [COMPONENT &lt;component<span class="token punctuation">></span>] [FILES_MATCHING]</pre></td></tr><tr><td data-num="7"></td><td><pre>        [[PATTERN &lt;pattern<span class="token punctuation">></span> | REGEX &lt;regex<span class="token punctuation">></span>]</pre></td></tr><tr><td data-num="8"></td><td><pre>         [EXCLUDE] [PERMISSIONS permissions...]] [...]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>         </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># example DIRECTORY</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 把 doc 目录下的内容安装到 $&#123;CMAKE_INSTALL_PREFIX&#125;/doc 下</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">install</span><span class="token punctuation">(</span>DIRECTORY doc/ DESTINATION /doc<span class="token punctuation">)</span></pre></td></tr></table></figure><p>安装常用的可选项：</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">install</span><span class="token punctuation">(</span>TARGETS targets... [EXPORT &lt;export-name<span class="token punctuation">></span>]</pre></td></tr><tr><td data-num="2"></td><td><pre>        [RUNTIME_DEPENDENCIES args...|RUNTIME_DEPENDENCY_SET &lt;set-name<span class="token punctuation">></span>]</pre></td></tr><tr><td data-num="3"></td><td><pre>        [[ARCHIVE|LIBRARY|RUNTIME|OBJECTS|<span class="token property">FRAMEWORK</span>|<span class="token property">BUNDLE</span>|</pre></td></tr><tr><td data-num="4"></td><td><pre>          <span class="token property">PRIVATE_HEADER</span>|<span class="token property">PUBLIC_HEADER</span>|<span class="token property">RESOURCE</span>|FILE_SET &lt;set-name<span class="token punctuation">></span>]</pre></td></tr><tr><td data-num="5"></td><td><pre>         [DESTINATION &lt;dir<span class="token punctuation">></span>]</pre></td></tr><tr><td data-num="6"></td><td><pre>         [PERMISSIONS permissions...]</pre></td></tr><tr><td data-num="7"></td><td><pre>         [CONFIGURATIONS [Debug|Release|...]]</pre></td></tr><tr><td data-num="8"></td><td><pre>         [COMPONENT &lt;component<span class="token punctuation">></span>]</pre></td></tr><tr><td data-num="9"></td><td><pre>         [NAMELINK_COMPONENT &lt;component<span class="token punctuation">></span>]</pre></td></tr><tr><td data-num="10"></td><td><pre>         [OPTIONAL] [<span class="token property">EXCLUDE_FROM_ALL</span>]</pre></td></tr><tr><td data-num="11"></td><td><pre>         [NAMELINK_ONLY|NAMELINK_SKIP]</pre></td></tr><tr><td data-num="12"></td><td><pre>        ] [...]</pre></td></tr><tr><td data-num="13"></td><td><pre>        [INCLUDES DESTINATION [&lt;dir<span class="token punctuation">></span> ...]]</pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># example TARGETS</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 把 arenasvr 按照 RUNTIME 模式安装到 $&#123;CMAKE_INSTALL_PREFIX&#125;/as/bin 下</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">install</span><span class="token punctuation">(</span>TARGETS arenasvr RUNTIME DESTINATION <span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_INSTALL_PREFIX</span><span class="token punctuation">&#125;</span>/as/bin<span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="targets"><a class="anchor" href="#targets">#</a> TARGETS</h4><p>${targets} 用来指定需要安装的源文件</p><h4 id="export"><a class="anchor" href="#export">#</a> EXPORT</h4><p targets="">指定安装后的文件名，默认为 $</p><h4 id="target-type"><a class="anchor" href="#target-type">#</a> Target Type</h4><p>指定 targets 的类型，如果 DESTINATION 没有设置情况下，不同类型的默认安装路径由 GNUInstallDirs Variable 决定</p><table><thead><tr><th style="text-align:left">Target Type</th><th>类型说明</th><th style="text-align:left">GNUInstallDirs Variable</th><th style="text-align:left">Built-In Default</th></tr></thead><tbody><tr><td style="text-align:left"><code>RUNTIME</code></td><td>可执行文件 | DLLs</td><td style="text-align:left"><code>$&#123;CMAKE_INSTALL_BINDIR&#125;</code></td><td style="text-align:left"><code>bin</code></td></tr><tr><td style="text-align:left"><code>LIBRARY</code></td><td>共享库</td><td style="text-align:left"><code>$&#123;CMAKE_INSTALL_LIBDIR&#125;</code></td><td style="text-align:left"><code>lib</code></td></tr><tr><td style="text-align:left"><code>ARCHIVE</code></td><td>静态库 | .lib | .dll</td><td style="text-align:left"><code>$&#123;CMAKE_INSTALL_LIBDIR&#125;</code></td><td style="text-align:left"><code>lib</code></td></tr><tr><td style="text-align:left"><code>FILE_SET</code> (type <code>HEADERS</code> )</td><td>文件集，会保留目录结构进行安装</td><td style="text-align:left"><code>$&#123;CMAKE_INSTALL_INCLUDEDIR&#125;</code></td><td style="text-align:left"><code>include</code></td></tr></tbody></table><h4 id="destination"><a class="anchor" href="#destination">#</a> DESTINATION</h4><p>指定安装目录，相对路径默认以 CMAKE_INSTALL_PREFIX 为根目录</p><h4 id="permissions"><a class="anchor" href="#permissions">#</a> PERMISSIONS</h4><p>指定安装文件的权限</p><h4 id="configurations"><a class="anchor" href="#configurations">#</a> CONFIGURATIONS</h4><p>指定安装构建的规则：Debug | Release</p><h2 id="静态库和动态库的构建"><a class="anchor" href="#静态库和动态库的构建">#</a> 静态库和动态库的构建</h2><h3 id="两者区别"><a class="anchor" href="#两者区别">#</a> 两者区别</h3><ul><li>静态库的扩展名一般为 .a 或 .lib；动态库的扩展名一般为 .so 或 .dll</li><li>静态库在编译是会直接整合到目标程序中，目标程序在编译完成后可独立运行</li><li>动态链接库在编译时不会放到连接的目标程序中，目标程序在运行过程中动态加载，因此目标程序不可独立运行</li></ul><h3 id="add_library-关键字"><a class="anchor" href="#add_library-关键字">#</a> add_library 关键字</h3><p>添加共享库构建项</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">add_library</span><span class="token punctuation">(</span>&lt;name<span class="token punctuation">></span> [<span class="token namespace">STATIC</span> | <span class="token namespace">SHARED</span> | MODULE]</pre></td></tr><tr><td data-num="2"></td><td><pre>            [<span class="token property">EXCLUDE_FROM_ALL</span>]</pre></td></tr><tr><td data-num="3"></td><td><pre>            source1 [source2 ...]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># example</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">add_library</span><span class="token punctuation">(</span>lib_func <span class="token namespace">STATIC</span> lib_func.cpp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 构建时会得到 lib$&#123;name&#125;.xx 的库文件，例如这里对 lib_func 的构建结果为 liblib_func.a</span></pre></td></tr></table></figure><table><thead><tr><th>关键字</th><th>作用</th></tr></thead><tbody><tr><td>STATIC</td><td>生成静态库， .a 或 .lib</td></tr><tr><td>SHARED</td><td>生成动态库， .so 或 .dll</td></tr><tr><td>MODULE</td><td>生成动态库，可以在运行过程中通过 dlopen 动态加载， .so 或 .dll</td></tr></tbody></table><p>在根目录下新建一个 lib 文件，并且写个简单的函数：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre>├── CMakeLists<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="3"></td><td><pre>├── lib</pre></td></tr><tr><td data-num="4"></td><td><pre>│   ├── CMakeLists<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="5"></td><td><pre>│   ├── lib<span class="token punctuation">.</span>cpp</pre></td></tr><tr><td data-num="6"></td><td><pre>│   └── lib<span class="token punctuation">.</span>h</pre></td></tr><tr><td data-num="7"></td><td><pre>└── src</pre></td></tr><tr><td data-num="8"></td><td><pre>    ├── CMakeLists<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="9"></td><td><pre>    └── main<span class="token punctuation">.</span>cpp</pre></td></tr></table></figure><blockquote><p>lib/CMakeLists.txt</p></blockquote><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">add_library</span><span class="token punctuation">(</span>lib_func <span class="token namespace">STATIC</span> lib.cpp<span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>src/CMakeLists.txt</p></blockquote><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello main.cpp<span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>CMakeLists.txt</p></blockquote><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">project</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>lib bin/lib<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>src bin/src<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="add_subdirectory-关键字"><a class="anchor" href="#add_subdirectory-关键字">#</a> add_subdirectory 关键字</h3><p>添加需要编译的子目录，可以指定编译文件的路径</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>source_dir [binary_dir]</pre></td></tr><tr><td data-num="2"></td><td><pre>                 [<span class="token property">EXCLUDE_FROM_ALL</span>]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                 </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># example 编译 src 下面的 CMakeLists.txt 并把结果输出到 $&#123;PROJECT_SOURCE_DIR&#125;/bin/src 下</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>src bin/src<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="include_directories-关键字"><a class="anchor" href="#include_directories-关键字">#</a> include_directories 关键字</h3><p>添加外部库，可以避免在引用外部库头文件的时候，提示找不到头文件</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>/data/rwbyguo/cmake_test/src/main.cpp:2:10: 致命错误：lib.h：没有那个文件或目录</pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token comment">#include "lib.h"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>          ^~~~~~~</pre></td></tr><tr><td data-num="4"></td><td><pre>编译中断。</pre></td></tr></table></figure><p>用法：</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">include_directories</span><span class="token punctuation">(</span>[AFTER|BEFORE] [SYSTEM] dir1 [dir2 ...]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># example</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">include_directories</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/lib<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello main.cpp<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="target_link_libraries-关键字"><a class="anchor" href="#target_link_libraries-关键字">#</a> target_link_libraries 关键字</h3><p>为可执行程序添加链接库，可以避免在使用动态库中函数的时候找不到对应的实现</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>CMakeFiles/hello.dir/main.o：在函数‘main’中：</pre></td></tr><tr><td data-num="2"></td><td><pre>main.cpp:<span class="token punctuation">(</span>.text+0x5<span class="token punctuation">)</span>：对‘lib_func<span class="token punctuation">(</span><span class="token punctuation">)</span>’未定义的引用</pre></td></tr><tr><td data-num="3"></td><td><pre>collect2: 错误：ld 返回 <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>bin/src/hello<span class="token punctuation">]</span> 错误 <span class="token number">1</span></pre></td></tr><tr><td data-num="5"></td><td><pre>make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>bin/src/CMakeFiles/hello.dir/all<span class="token punctuation">]</span> 错误 <span class="token number">2</span></pre></td></tr><tr><td data-num="6"></td><td><pre>make: *** <span class="token punctuation">[</span>all<span class="token punctuation">]</span> 错误 <span class="token number">2</span></pre></td></tr></table></figure><p>添加需要连接的共享库：</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>&lt;target<span class="token punctuation">></span> [item1 [item2 [...]]]</pre></td></tr><tr><td data-num="2"></td><td><pre>                      [[debug|optimized|general] &lt;item<span class="token punctuation">></span>] ...<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># example 记得 target_link_libraries 需要放在 add_executable 后面</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">include_directories</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/lib<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">set</span><span class="token punctuation">(</span>LIB_FUNC_PATH <span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/debugbuild/bin/lib<span class="token punctuation">)</span> <span class="token comment">#/data/rwbyguo/cmake_test/debugbuild/bin/lib</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello main.cpp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>hello <span class="token punctuation">$&#123;</span>LIB_FUNC_PATH<span class="token punctuation">&#125;</span>/liblib_func.a<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="link_directories-关键字"><a class="anchor" href="#link_directories-关键字">#</a> link_directories 关键字</h3><p>添加非标准的共享库搜索路径，可以简化链接库时的路径设置，搭配 <code>target_link_libraries</code> 使用</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">link_directories</span><span class="token punctuation">(</span>directory1 directory2 ...<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># example</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">include_directories</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/lib<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">set</span><span class="token punctuation">(</span>LIB_FUNC_PATH <span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/debugbuild/bin/lib<span class="token punctuation">)</span> <span class="token comment">#/data/rwbyguo/cmake_test/debugbuild/bin/lib</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">link_directories</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span>LIB_FUNC_PATH<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello main.cpp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>hello liblib_func.a<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="link_libraries-关键字"><a class="anchor" href="#link_libraries-关键字">#</a> link_libraries 关键字</h3><p>连接库，可以不需要指定 target，相等于 target_link_libraries 提前版本。</p><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">link_libraries</span><span class="token punctuation">(</span>library1 &lt;debug | optimized<span class="token punctuation">></span> library2 ...<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># example</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">include_directories</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/lib<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">set</span><span class="token punctuation">(</span>LIB_FUNC_PATH <span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/debugbuild/bin/lib<span class="token punctuation">)</span> <span class="token comment">#/data/rwbyguo/cmake_test/debugbuild/bin/lib</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">link_libraries</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span>LIB_FUNC_PATH<span class="token punctuation">&#125;</span>/liblib_func.a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello main.cpp<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="find_package-关键字"><a class="anchor" href="#find_package-关键字">#</a> find_package 关键字</h3><p>查找并加载外部包，支持两种搜索方式：</p><ul><li><strong>Module mode</strong>：CMake 先从 <code>CMAKE_MODULE_PATH</code> 搜索一个名为 的文件 <code>Find&lt;PackageName&gt;.cmake</code> 。</li><li><strong>Config mode</strong>：CMake 会搜索一个名为 <code>&lt;lowercasePackageName&gt;-config.cmake</code> | <code>&lt;PackageName&gt;Config.cmake</code> 的文件。查找流程较为复杂，见<span class="exturl" data-url="aHR0cHM6Ly9jbWFrZS5vcmcvY21ha2UvaGVscC9sYXRlc3QvY29tbWFuZC9maW5kX3BhY2thZ2UuaHRtbCNzZWFyY2gtcHJvY2VkdXJl">官方文档</span></li></ul><figure class="highlight cmake"><figcaption data-lang="CMake"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">find_package</span><span class="token punctuation">(</span>&lt;package<span class="token punctuation">></span> [version] [EXACT] [QUIET]</pre></td></tr><tr><td data-num="2"></td><td><pre>             [REQUIRED] [[COMPONENTS] [components...]]</pre></td></tr><tr><td data-num="3"></td><td><pre>             [CONFIG|NO_MODULE]</pre></td></tr><tr><td data-num="4"></td><td><pre>             [NO_POLICY_SCOPE]</pre></td></tr><tr><td data-num="5"></td><td><pre>             [NAMES name1 [name2 ...]]</pre></td></tr><tr><td data-num="6"></td><td><pre>             [CONFIGS config1 [config2 ...]]</pre></td></tr><tr><td data-num="7"></td><td><pre>             [HINTS path1 [path2 ... ]]</pre></td></tr><tr><td data-num="8"></td><td><pre>             [PATHS path1 [path2 ... ]]</pre></td></tr><tr><td data-num="9"></td><td><pre>             [PATH_SUFFIXES suffix1 [suffix2 ...]]</pre></td></tr><tr><td data-num="10"></td><td><pre>             [NO_DEFAULT_PATH]</pre></td></tr><tr><td data-num="11"></td><td><pre>             [NO_CMAKE_ENVIRONMENT_PATH]</pre></td></tr><tr><td data-num="12"></td><td><pre>             [NO_CMAKE_PATH]</pre></td></tr><tr><td data-num="13"></td><td><pre>             [NO_SYSTEM_ENVIRONMENT_PATH]</pre></td></tr><tr><td data-num="14"></td><td><pre>             [NO_CMAKE_PACKAGE_REGISTRY]</pre></td></tr><tr><td data-num="15"></td><td><pre>             [NO_CMAKE_BUILDS_PATH]</pre></td></tr><tr><td data-num="16"></td><td><pre>             [NO_CMAKE_SYSTEM_PATH]</pre></td></tr><tr><td data-num="17"></td><td><pre>             [NO_CMAKE_SYSTEM_PACKAGE_REGISTRY]</pre></td></tr><tr><td data-num="18"></td><td><pre>             [<span class="token variable">CMAKE_FIND_ROOT_PATH_BOTH</span> |</pre></td></tr><tr><td data-num="19"></td><td><pre>              ONLY_CMAKE_FIND_ROOT_PATH |</pre></td></tr><tr><td data-num="20"></td><td><pre>              NO_CMAKE_FIND_ROOT_PATH]<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>              </pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># example 官方提供了 protobuf 的配置 https://cmake.org/cmake/help/latest/module/FindProtobuf.html</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">#protobuf</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">set</span><span class="token punctuation">(</span>PROTOBUF_DIR <span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/external/protobuf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">set</span><span class="token punctuation">(</span>PROTOBUF_INCLUDE_DIR <span class="token punctuation">$&#123;</span>PROTOBUF_DIR<span class="token punctuation">&#125;</span>/include<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">set</span><span class="token punctuation">(</span>PROTOBUF_LIBRARY_DIR <span class="token punctuation">$&#123;</span>PROTOBUF_DIR<span class="token punctuation">&#125;</span>/lib<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">set</span><span class="token punctuation">(</span>PROTOBUF_PROTOC_EXECUTABLE <span class="token punctuation">$&#123;</span>PROTOBUF_DIR<span class="token punctuation">&#125;</span>/bin/protoc<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">MSVC</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">set</span><span class="token punctuation">(</span>PROTOBUF_PROTOC_EXECUTABLE <span class="token punctuation">$&#123;</span>PROTOBUF_DIR<span class="token punctuation">&#125;</span>/bin/protoc.exe<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token variable">MSVC</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">set</span><span class="token punctuation">(</span>PROTOBUF_LIBRARY <span class="token punctuation">$&#123;</span>PROTOBUF_LIBRARY_DIR<span class="token punctuation">&#125;</span>/libprotobuf.a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">set</span><span class="token punctuation">(</span>PROTOBUF_LIBRARY_DEBUG <span class="token punctuation">$&#123;</span>PROTOBUF_LIBRARY_DIR<span class="token punctuation">&#125;</span>/libprotobuf.a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token keyword">set</span><span class="token punctuation">(</span>PROTOBUF_IMPORT_DIRS<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">find_package</span><span class="token punctuation">(</span>Protobuf REQUIRED<span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="exact"><a class="anchor" href="#exact">#</a> EXACT</h4><p>要求 version 版本匹配</p><h4 id="quirt"><a class="anchor" href="#quirt">#</a> QUIRT</h4><p>如果引入外部包失败，不提示消息</p><h4 id="required"><a class="anchor" href="#required">#</a> REQUIRED</h4><p>如果引入外部包失败，停止编译流程，并提示错误消息</p><h2 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9jbWFrZS5vcmcvY21ha2UvaGVscC92My4wL21hbnVhbC9jbWFrZS1jb21tYW5kcy43Lmh0bWw=">cmake 官方文档</span></li></ul><div class="tags"><a href="/tags/cmake/" rel="tag"><i class="ic i-tag"></i> cmake</a> <a href="/tags/%E7%BC%96%E8%AF%91/" rel="tag"><i class="ic i-tag"></i> 编译</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-12-29 09:36:04" itemprop="dateModified" datetime="2022-12-29T09:36:04+08:00">2022-12-29</time> </span><span id="learning/compile/cmake/" class="item leancloud_visitors" data-flag-title="cmake" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 充电</button><p>请我[恰饭]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="鑫酱(●'◡'●) 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="鑫酱(●'◡'●) 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>鑫酱(●'◡'●) <i class="ic i-at"><em>@</em></i>鑫酱</li><li class="link"><strong>本文链接：</strong> <a href="https://hakuya.me/learning/compile/cmake/" title="cmake">https://hakuya.me/learning/compile/cmake/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/learning/physx/PhysX%E2%80%94%E2%80%94Memory%20Management%E7%AF%87/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;wallpaper-1255596461.cos.ap-nanjing.myqcloud.com&#x2F;wallpaper_6.jpg" title="PhysX——Memory Management篇"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 物理引擎</span><h3>PhysX——Memory Management篇</h3></a></div><div class="item right"><a href="/learning/unreal/UE%20%E8%93%9D%E5%9B%BE%E7%AF%87/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;wallpaper-1255596461.cos.ap-nanjing.myqcloud.com&#x2F;wallpaper (21).jpg" title="UE 蓝图篇"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> UE</span><h3>UE 蓝图篇</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#cmake"><span class="toc-number">1.</span> <span class="toc-text">CMake</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E4%BB%A3%E7%A0%81"><span class="toc-number">1.1.</span> <span class="toc-text">编译一个简单代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">语法介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#project-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.2.1.</span> <span class="toc-text">project 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.2.2.</span> <span class="toc-text">set 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#message-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.2.3.</span> <span class="toc-text">message 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add_executable-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.2.4.</span> <span class="toc-text">add_executable 关键字</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E5%88%99"><span class="toc-number">1.3.</span> <span class="toc-text">语法的基本原则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.3.1.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E5%A4%96%E9%83%A8%E6%9E%84%E5%BB%BA"><span class="toc-number">1.4.</span> <span class="toc-text">内部构建和外部构建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E4%B8%80%E4%B8%AA%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">编译一个工程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.1.</span> <span class="toc-text">工程目录结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E8%AF%AD%E6%B3%95"><span class="toc-number">1.6.</span> <span class="toc-text">进阶语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#file-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.6.1.</span> <span class="toc-text">file 关键字</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%94%A8%E6%B3%95"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">常见用法：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#macroendmacro-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.6.2.</span> <span class="toc-text">macro&#x2F;endmacro 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.6.3.</span> <span class="toc-text">include 关键字</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E5%90%88-macro-%E4%BD%BF%E7%94%A8"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">配合 macro 使用：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ifendif-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.6.4.</span> <span class="toc-text">if&#x2F;endif 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#foreachendforeach-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.6.5.</span> <span class="toc-text">foreach&#x2F;endforeach 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#configure_file-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.6.6.</span> <span class="toc-text">configure_file 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#math-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.6.7.</span> <span class="toc-text">math 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#string-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.6.8.</span> <span class="toc-text">string 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#option-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.6.9.</span> <span class="toc-text">option 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add_definitions-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.6.10.</span> <span class="toc-text">add_definitions 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.6.11.</span> <span class="toc-text">list 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#install-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.6.12.</span> <span class="toc-text">install 关键字</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%AE%89%E8%A3%85%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.6.12.1.</span> <span class="toc-text">常见安装模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#targets"><span class="toc-number">1.6.12.2.</span> <span class="toc-text">TARGETS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#export"><span class="toc-number">1.6.12.3.</span> <span class="toc-text">EXPORT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#target-type"><span class="toc-number">1.6.12.4.</span> <span class="toc-text">Target Type</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#destination"><span class="toc-number">1.6.12.5.</span> <span class="toc-text">DESTINATION</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#permissions"><span class="toc-number">1.6.12.6.</span> <span class="toc-text">PERMISSIONS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#configurations"><span class="toc-number">1.6.12.7.</span> <span class="toc-text">CONFIGURATIONS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%BA%93%E5%92%8C%E5%8A%A8%E6%80%81%E5%BA%93%E7%9A%84%E6%9E%84%E5%BB%BA"><span class="toc-number">1.7.</span> <span class="toc-text">静态库和动态库的构建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E8%80%85%E5%8C%BA%E5%88%AB"><span class="toc-number">1.7.1.</span> <span class="toc-text">两者区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add_library-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.7.2.</span> <span class="toc-text">add_library 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add_subdirectory-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.7.3.</span> <span class="toc-text">add_subdirectory 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include_directories-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.7.4.</span> <span class="toc-text">include_directories 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#target_link_libraries-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.7.5.</span> <span class="toc-text">target_link_libraries 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#link_directories-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.7.6.</span> <span class="toc-text">link_directories 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#link_libraries-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.7.7.</span> <span class="toc-text">link_libraries 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#find_package-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.7.8.</span> <span class="toc-text">find_package 关键字</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#exact"><span class="toc-number">1.7.8.1.</span> <span class="toc-text">EXACT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#quirt"><span class="toc-number">1.7.8.2.</span> <span class="toc-text">QUIRT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#required"><span class="toc-number">1.7.8.3.</span> <span class="toc-text">REQUIRED</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">1.8.</span> <span class="toc-text">参考链接</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/learning/compile/cmake/" rel="bookmark" title="cmake">cmake</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="鑫酱(●'◡'●)" data-src="/images/avatar.jpg"><p class="name" itemprop="name">鑫酱(●'◡'●)</p><div class="description" itemprop="description">整天摸鱼，却妄想拯救世界的技术宅</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">110</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">25</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">67</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FsbGVuR1g=" title="https:&#x2F;&#x2F;github.com&#x2F;AllenGX"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTgwNTM4MjQy" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;80538242"><i class="ic i-cloud-music"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjE0MTM5MDcxNTNAcXEuY29t" title="mailto:1413907153@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>好友</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>网址</a></li><li class="item"><a href="/travellings/" rel="section"><i class="ic i-paper-plane"></i>传送门</a></li><li class="item"><a href="/mikutap/" rel="section"><i class="ic i-star"></i>Mikutap</a></li><li class="item"><a href="/restart/" rel="section"><i class="ic i-sun"></i>RestartLife</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/learning/physx/PhysX%E2%80%94%E2%80%94Memory%20Management%E7%AF%87/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/learning/unreal/UE%20%E8%93%9D%E5%9B%BE%E7%AF%87/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game101/" title="分类于 Games101图形渲染">Games101图形渲染</a></div><span><a href="/learning/games/Game101/%E4%BA%8C%E5%8D%81%E4%B8%89%E3%80%81Animation%EF%BC%88%E4%B8%8A%EF%BC%89/" title="二十三、Animation（上）">二十三、Animation（上）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/python/" title="分类于 python">python</a></div><span><a href="/learning/programlanguage/python/Python-Build-In/" title="python内建函数">python内建函数</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game202/" title="分类于 GAME202高质量实时渲染">GAME202高质量实时渲染</a></div><span><a href="/learning/games/Game202/%E4%B8%89%E3%80%81Real-time%20Environment%20Mapping/" title="三、Real-time Environment Mapping">三、Real-time Environment Mapping</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/unreal/" title="分类于 UE">UE</a></div><span><a href="/learning/unreal/UE%20%E8%B5%84%E4%BA%A7%E5%AF%BC%E5%87%BA%E5%92%8C%E5%8A%A0%E8%BD%BD/" title="UE 资产导出和加载">UE 资产导出和加载</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/physx/" title="分类于 物理引擎">物理引擎</a></div><span><a href="/learning/physx/PhysX%E2%80%94%E2%80%94Memory%20Management%E7%AF%87/" title="PhysX——Memory Management篇">PhysX——Memory Management篇</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game101/" title="分类于 Games101图形渲染">Games101图形渲染</a></div><span><a href="/learning/games/Game101/%E5%8D%81%E4%B8%83%E3%80%81Ray%20Tracing%E2%80%94%E2%80%94Monte%20Carlo%20Path%20Tracing/" title="十七、Ray Tracing——Monte Carlo Path Tracing">十七、Ray Tracing——Monte Carlo Path Tracing</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/physx/" title="分类于 物理引擎">物理引擎</a></div><span><a href="/learning/physx/PhysX%E2%80%94%E2%80%94GJK%20&&%20EPA/" title="PhysX——GJK &amp;&amp; EPA">PhysX——GJK && EPA</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/cpp/" title="分类于 cpp">cpp</a></div><span><a href="/learning/programlanguage/cpp/%E5%8D%81%E5%85%AB%E3%80%81C++11%E6%96%B0%E5%8A%9F%E8%83%BD/" title="十八、C++11新功能">十八、C++11新功能</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/japanese/" title="分类于 日语">日语</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/japanese/primary/" title="分类于 日语初级">日语初级</a></div><span><a href="/learning/japanese/primary/%E5%8D%81%E4%B8%80%E3%80%81%E5%B0%8F%E9%87%8E%E5%96%9C%E6%AC%A2%E5%94%B1%E6%AD%8C/" title="十一、小野喜欢唱歌">十一、小野喜欢唱歌</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/unreal/" title="分类于 UE">UE</a></div><span><a href="/learning/unreal/Unreal%20%E6%8F%A1%E6%89%8B%E6%B5%81%E7%A8%8B/" title="Unreal 握手流程">Unreal 握手流程</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">鑫酱(●'◡'●) @ 个人博客</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">639k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">9:41</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"learning/compile/cmake/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/animejs@3.2.0/lib/anime.min.js,npm/katex@0.12.0/dist/contrib/copy-tex.min.js,npm/frappe-charts@1.5.0/dist/frappe-charts.min.iife.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/quicklink@2/dist/quicklink.umd.js,gh/amehime/MiniValine@4.2.2-beta10/dist/MiniValine.min.js"></script><script src="/js/app.js?v=0.2.5"></script><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b6d809b500bd6f0040117088899bc7bf";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>