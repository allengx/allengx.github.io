<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="XqWEZ-KjvQT4IfXzxYvH-PEc--_zN6GqthY2jBsqOs4"><meta name="msvalidate.01" content="4E28E3FDD5912EBBB84869B17359650D"><meta name="baidu-site-verification" content="code-dwpSTDBLS2"><link rel="alternate" type="application/rss+xml" title="鑫酱" href="https://hakuya.me/rss.xml"><link rel="alternate" type="application/atom+xml" title="鑫酱" href="https://hakuya.me/atom.xml"><link rel="alternate" type="application/json" title="鑫酱" href="https://hakuya.me/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="UE,Delegate"><link rel="canonical" href="https://hakuya.me/learning/unreal/UE%20Delegate/"><title>UE Delegate - UE - 学习 | 个人博客 = 鑫酱 = 笔记本</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">UE Delegate</h1><div class="meta"><span class="item" title="创建时间：2022-11-24 16:19:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-11-24T16:19:00+08:00">2022-11-24</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>18k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>17 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">个人博客</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (2).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (15).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (6).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper_4.jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (7).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (26).jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learning/" itemprop="item" rel="index" title="分类于 学习"><span itemprop="name">学习</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learning/unreal/" itemprop="item" rel="index" title="分类于 UE"><span itemprop="name">UE</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://hakuya.me/learning/unreal/UE%20Delegate/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="鑫酱(●'◡'●)"><meta itemprop="description" content="笔记本, 整天摸鱼，却妄想拯救世界的技术宅"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="鑫酱"></span><div class="body md" itemprop="articleBody"><div class="note info"><p>本篇内容和源码均参考 UE5。</p></div><h1 id="delegate-委托"><a class="anchor" href="#delegate-委托">#</a> Delegate 委托</h1><p>委托是 Unreal 对于 C++ 函数的一种封装。在 Unreal 中，委托也被分成以下几种类型：</p><ul><li>Delegate：简单委托，支持绑定单个执行函数。</li><li>MulticaseDelegate：多播委托，支持绑定一个或多个执行函数。</li><li>Event：事件，带有访问权限控制的多播委托，需要设置可以触发该多播委托的友元类。</li><li>DynamicDelegate：动态委托，支持动态绑定单个执行函数。</li><li>DynamicMulticaseDelegate：动态多播委托，支持动态绑定一个或多个执行函数。</li><li>SparseDynamicDelegate：稀疏动态委托，可以理解为另一种存储形式的 DynamicMulticaseDelegate。</li></ul><h2 id="delegate-简单委托"><a class="anchor" href="#delegate-简单委托">#</a> Delegate 简单委托</h2><p>Delegate 通过宏定义进行声明： <code>DECLARE_DELEGATE_XXXParams</code> ，宏展开后内容如下：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// example:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">DECLARE_DELEGATE_TwoParams</span><span class="token punctuation">(</span>FOnQuaternionCommitted<span class="token punctuation">,</span> FQuat<span class="token punctuation">,</span> ETextCommit<span class="token operator">::</span>Type<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 展开结果:</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">typedef</span> TDelegate<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span>FQuat<span class="token punctuation">,</span> ETextCommit<span class="token operator">::</span>Type<span class="token punctuation">)</span><span class="token operator">></span> FOnQuaternionCommitted<span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="tdelegate"><a class="anchor" href="#tdelegate">#</a> TDelegate</h3><p>Delegate 声明实际上是对 <strong>TDelegate</strong> 模板类的声明。<strong>TDelegate</strong> 最终会继承 <strong>UserPolicy</strong> 中的 <strong>FDelegateExtras</strong>。</p><p>而 <strong>UserPolicy</strong> 是外部定义的模板类，默认为 <strong>FDefaultDelegateUserPolicy</strong>，<strong>FDelegateExtras</strong> 默认为 <strong>FDelegateBase</strong>：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// TDelegate 本身的定义:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">DelegateSignature</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">UserPolicy</span> <span class="token operator">=</span> FDefaultDelegateUserPolicy<span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TDelegate</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token comment">// ...</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">InRetValType</span><span class="token punctuation">,</span> <span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> ParamTypes<span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">UserPolicy</span><span class="token operator">></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TDelegate</span><span class="token operator">&lt;</span><span class="token function">InRetValType</span><span class="token punctuation">(</span>ParamTypes<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> UserPolicy<span class="token operator">></span> <span class="token operator">:</span> <span class="token keyword">public</span> TDelegateBase<span class="token operator">&lt;</span>UserPolicy<span class="token operator">></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token comment">// ...  </span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">UserPolicy</span><span class="token operator">></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TDelegateBase</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> UserPolicy<span class="token operator">::</span><span class="token class-name">FDelegateExtras</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">FDefaultDelegateUserPolicy</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token keyword">using</span> FDelegateInstanceExtras  <span class="token operator">=</span> IDelegateInstance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token keyword">using</span> FDelegateExtras          <span class="token operator">=</span> FDelegateBase<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token keyword">using</span> FMulticastDelegateExtras <span class="token operator">=</span> TMulticastDelegateBase<span class="token operator">&lt;</span>FDefaultDelegateUserPolicy<span class="token operator">></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>FDelegateBase</strong> 提供了对 Delegate 的内存管理，所有 <strong>TDelegate</strong> 的创建销毁底层都是基于 <strong>FDelegateBase</strong>。</p><h3 id="delegate-instance"><a class="anchor" href="#delegate-instance">#</a> Delegate Instance</h3><p>Unreal 基于成员函数的类型及函数特性对 Delegate 又划分出了多个不同的实例：</p><ul><li><strong>TBaseRawMethodDelegateInstance</strong>：任意 C++ 类型的<strong>成员函数</strong>委托，对象通过指针进行存储，如果对象被销毁，执行不安全。</li><li><strong>TBaseSPMethodDelegateInstance</strong>：任意 C++ 类型的<strong>成员函数</strong>委托，通过一个线程安全的共享指针来存储委托所绑定的对象，执行是安全的。</li><li><strong>TBaseUFunctionDelegateInstance</strong>：<strong>UObject 对象类型</strong>的<strong> UFunction 函数</strong>委托，基于反射进行查找因此必须是 UFunction 函数，构造时可以只提供<strong>函数名</strong>，提供弱引用指针绑定 UObject 因此也是安全的。</li><li><strong>TBaseUObjectMethodDelegateInstance</strong>：<strong>UObject 对象类型</strong>的<strong>成员函数</strong>委托，构造时需要提供函数指针，对 UObject 也是弱引用，因此执行是安全的。</li><li><strong>TBaseFunctorDelegateInstance</strong>：任意类型的<strong>函数</strong>委托，存储函数指针，执行是安全的。</li><li><strong>TWeakBaseFunctorDelegateInstance</strong>：任意类型的<strong>成员函数</strong>委托，保存的是对象的弱引用，执行是安全的。</li><li><strong>TBaseStaticDelegateInstance</strong>：静态 C++ 函数指针，存储函数指针，执行是安全的。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/image-20221029100815344.png" alt="image-20221029100815344"></p><p>所有 <strong>Delegate Instance</strong> 最终都继承自 <strong>UserPolicy</strong> 中的 <strong>FDelegateInstanceExtras</strong>，并各自实现了函数绑定规则。</p><h4 id="delegate-instance-实例化"><a class="anchor" href="#delegate-instance-实例化">#</a> Delegate Instance 实例化</h4><p>TDelegate 为所有类型的 <strong>Delegate Instance</strong> 提供了实例化的接口：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre>* Static: Creates a raw C++ pointer global function delegate</pre></td></tr><tr><td data-num="3"></td><td><pre>*/</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> VarTypes<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre>UE_NODISCARD <span class="token keyword">inline</span> <span class="token keyword">static</span> TDelegate<span class="token operator">&lt;</span><span class="token function">RetValType</span><span class="token punctuation">(</span>ParamTypes<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> UserPolicy<span class="token operator">></span> <span class="token function">CreateStatic</span><span class="token punctuation">(</span><span class="token keyword">typename</span> <span class="token class-name">TIdentity</span><span class="token operator">&lt;</span><span class="token function">RetValType</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ParamTypes<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> VarTypes<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">::</span>Type InFunc<span class="token punctuation">,</span> VarTypes<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Vars<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	TDelegate<span class="token operator">&lt;</span><span class="token function">RetValType</span><span class="token punctuation">(</span>ParamTypes<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> UserPolicy<span class="token operator">></span> Result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token class-name">TBaseStaticDelegateInstance</span><span class="token operator">&lt;</span>FuncType<span class="token punctuation">,</span> UserPolicy<span class="token punctuation">,</span> VarTypes<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">Create</span><span class="token punctuation">(</span>Result<span class="token punctuation">,</span> InFunc<span class="token punctuation">,</span> Vars<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token keyword">return</span> Result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// ...</span></pre></td></tr></table></figure><p>所有类型的 <strong>Delegate Instance</strong> 都在自己的 Create 接口中通过 <strong>FDelegateBase</strong> 提供的 <strong>new</strong> 函数实现内存分配和实例化（自己创建自己了属于是😃</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>FORCEINLINE <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Create</span><span class="token punctuation">(</span>FDelegateBase<span class="token operator">&amp;</span> Base<span class="token punctuation">,</span> FFuncPtr InFunc<span class="token punctuation">,</span> VarTypes<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Vars<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">new</span> <span class="token punctuation">(</span>Base<span class="token punctuation">)</span> <span class="token function">UnwrappedThisType</span><span class="token punctuation">(</span>InFunc<span class="token punctuation">,</span> Vars<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">FDelegateBase</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    FDelegateAllocatorType<span class="token operator">::</span>ForElementType<span class="token operator">&lt;</span>FAlignedInlineDelegateType<span class="token operator">></span> DelegateAllocator<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	int32 DelegateSize<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">friend</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size_t Size<span class="token punctuation">,</span> FDelegateBase<span class="token operator">&amp;</span> Base<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">Allocate</span><span class="token punctuation">(</span>int32 Size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>IDelegateInstance<span class="token operator">*</span> CurrentInstance <span class="token operator">=</span> <span class="token function">GetDelegateInstanceProtected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>			CurrentInstance<span class="token operator">-></span><span class="token operator">~</span><span class="token function">IDelegateInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>		int32 NewDelegateSize <span class="token operator">=</span> <span class="token class-name">FMath</span><span class="token operator">::</span><span class="token function">DivideAndRoundUp</span><span class="token punctuation">(</span>Size<span class="token punctuation">,</span> <span class="token punctuation">(</span>int32<span class="token punctuation">)</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>FAlignedInlineDelegateType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>DelegateSize <span class="token operator">!=</span> NewDelegateSize<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>			DelegateAllocator<span class="token punctuation">.</span><span class="token function">ResizeAllocation</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> NewDelegateSize<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>FAlignedInlineDelegateType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>			DelegateSize <span class="token operator">=</span> NewDelegateSize<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>		<span class="token keyword">return</span> DelegateAllocator<span class="token punctuation">.</span><span class="token function">GetAllocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size_t Size<span class="token punctuation">,</span> FDelegateBase<span class="token operator">&amp;</span> Base<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token keyword">return</span> Base<span class="token punctuation">.</span><span class="token function">Allocate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>int32<span class="token punctuation">)</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>new</strong> 会调用 <strong>Base.Allocate</strong> 分配给 <strong>Delegate Instance</strong> 内存空间，并在该空间内构造 <strong>Delegate Instance</strong>，而由于该空间被 FDelegateBase 中的 <strong>DelegateAllocator</strong> 所管理，因此 Create 最终返回的是 <strong>TDelegate</strong> 模板实例。</p><p>这样，就通过 <strong>TDelegate</strong> 静态函数构造出了个新的 <strong>TDelegate</strong> 实例，TDelegate 实例中还包含了一个 <strong>Delegate Instance</strong> 并绑定了一个该类型的执行函数上。</p><h2 id="multicasedelegate-多播委托"><a class="anchor" href="#multicasedelegate-多播委托">#</a> MulticaseDelegate 多播委托</h2><p>同理，MulticaseDelegate 的宏定义为： <code>DECLARE_MULTICAST_DELEGATE_XXXParams</code> ，宏展开后内容如下：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// example:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">DECLARE_MULTICAST_DELEGATE_TwoParams</span><span class="token punctuation">(</span>FNewItemEvent<span class="token punctuation">,</span> <span class="token keyword">const</span> FVisualLoggerDBRow<span class="token operator">&amp;</span><span class="token punctuation">,</span> int32<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 展开结果:</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">typedef</span> TMulticastDelegate<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token keyword">const</span> FVisualLoggerDBRow<span class="token operator">&amp;</span><span class="token punctuation">,</span> int32<span class="token punctuation">)</span><span class="token operator">></span> FNewItemEvent<span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="tmulticastdelegate"><a class="anchor" href="#tmulticastdelegate">#</a> TMulticastDelegate</h3><p>MulticaseDelegate 声明实际上是对 <strong>TMulticastDelegate</strong> 模板类的声明。而 <strong>TMulticastDelegate</strong> 最终会继承 <strong>UserPolicy</strong> 中的 <strong>FMulticastDelegateExtras</strong>。</p><p>默认为 <strong>TMulticastDelegateBase<fdefaultdelegateuserpolicy></fdefaultdelegateuserpolicy></strong>：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> ParamTypes<span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">UserPolicy</span><span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TMulticastDelegate</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span>ParamTypes<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> UserPolicy<span class="token operator">></span> <span class="token operator">:</span> <span class="token keyword">public</span> UserPolicy<span class="token operator">::</span>FMulticastDelegateExtras</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token comment">// ...</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">using</span> FMulticastDelegateExtras <span class="token operator">=</span> TMulticastDelegateBase<span class="token operator">&lt;</span>FDefaultDelegateUserPolicy<span class="token operator">></span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>TMulticastDelegateBase</strong> 本质上是 <strong>TDelegateBase</strong> 的数组，多播（<strong>Broadcast</strong>）其实是对所有已注册的 TDelegateBase 的<strong>倒序</strong>执行（<strong>ExecuteIfSafe</strong>）：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TMulticastDelegateBase</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token comment">/** Holds the collection of delegate instances to invoke. */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	InvocationListType InvocationList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token comment">/** Holds a lock counter for the invocation list. */</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token keyword">mutable</span> int32 InvocationListLockCount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> ParamTypes<span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">UserPolicy</span><span class="token operator">></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TMulticastDelegate</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span>ParamTypes<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> UserPolicy<span class="token operator">></span> <span class="token operator">:</span> <span class="token keyword">public</span> UserPolicy<span class="token operator">::</span>FMulticastDelegateExtras</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token keyword">void</span> <span class="token function">Broadcast</span><span class="token punctuation">(</span>ParamTypes<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Params<span class="token punctuation">)</span> <span class="token keyword">const</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		<span class="token keyword">bool</span> NeedsCompaction <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token class-name">Super</span><span class="token operator">::</span><span class="token function">LockInvocationList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>			<span class="token keyword">const</span> InvocationListType<span class="token operator">&amp;</span> LocalInvocationList <span class="token operator">=</span> <span class="token class-name">Super</span><span class="token operator">::</span><span class="token function">GetInvocationList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>             <span class="token comment">// call bound functions in reverse order, so we ignore any instances that may be added by callees</span></pre></td></tr><tr><td data-num="21"></td><td><pre>			<span class="token keyword">for</span> <span class="token punctuation">(</span>int32 InvocationListIndex <span class="token operator">=</span> LocalInvocationList<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> InvocationListIndex <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>InvocationListIndex<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>				<span class="token keyword">const</span> FDelegate<span class="token operator">&amp;</span> DelegateBase <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> FDelegate<span class="token operator">&amp;</span><span class="token punctuation">)</span>LocalInvocationList<span class="token punctuation">[</span>InvocationListIndex<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>				IDelegateInstance<span class="token operator">*</span> DelegateInstanceInterface <span class="token operator">=</span> <span class="token class-name">Super</span><span class="token operator">::</span><span class="token function">GetDelegateInstanceProtectedHelper</span><span class="token punctuation">(</span>DelegateBase<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>				<span class="token keyword">if</span> <span class="token punctuation">(</span>DelegateInstanceInterface <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DelegateInstanceInterfaceType<span class="token operator">*</span><span class="token punctuation">)</span>DelegateInstanceInterface<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">ExecuteIfSafe</span><span class="token punctuation">(</span>Params<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>				<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>					NeedsCompaction <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>		<span class="token class-name">Super</span><span class="token operator">::</span><span class="token function">UnlockInvocationList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>NeedsCompaction<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>			<span class="token keyword">const_cast</span><span class="token operator">&lt;</span>TMulticastDelegate<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">CompactInvocationList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="event-事件"><a class="anchor" href="#event-事件">#</a> Event 事件</h2><p>Event 本质上就是一个 <strong>MulticaseDelegate</strong> 多播委托。唯一的区别在于 Event 需要指定调用的类型。通过友元类控制，并非所有对象都可以触发 Event。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// example:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">DECLARE_EVENT_TwoParams</span><span class="token punctuation">(</span>UEngine<span class="token punctuation">,</span> FLevelActorOuterChangedEvent<span class="token punctuation">,</span> AActor<span class="token operator">*</span><span class="token punctuation">,</span> UObject<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 展开结果:</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">FLevelActorOuterChangedEvent</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">TMulticastDelegate</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token class-name">AActor</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">UObject</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span> <span class="token keyword">friend</span> <span class="token keyword">class</span> <span class="token class-name">UEngine</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="dynamicdelegate-动态委托"><a class="anchor" href="#dynamicdelegate-动态委托">#</a> DynamicDelegate 动态委托</h2><p>相比于简单委托，动态委托采用了另一套实现体系 ——<strong>TBaseDynamicDelegate</strong>。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// example:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">DECLARE_DYNAMIC_DELEGATE_TwoParams</span><span class="token punctuation">(</span>FOnItemSelected<span class="token punctuation">,</span> UUserWidget<span class="token operator">*</span><span class="token punctuation">,</span> Widget<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">,</span> Selected<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 展开结果:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>FID_Engine_Plugins_Experimental_CommonUI_Source_CommonUI_Public_CommonUITypes_h_176_DELEGATE</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">FOnItemSelected</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">TBaseDynamicDelegate</span><span class="token operator">&lt;</span><span class="token class-name">FWeakObjectPtr</span><span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token punctuation">,</span> <span class="token class-name">UUserWidget</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">FOnItemSelected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">explicit</span> <span class="token function">FOnItemSelected</span><span class="token punctuation">(</span><span class="token keyword">const</span> TScriptDelegate<span class="token operator">&lt;</span><span class="token operator">></span> <span class="token operator">&amp;</span>InScriptDelegate<span class="token punctuation">)</span> <span class="token operator">:</span> TBaseDynamicDelegate<span class="token operator">&lt;</span>FWeakObjectPtr<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token punctuation">,</span> UUserWidget <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">></span><span class="token punctuation">(</span>InScriptDelegate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">Execute</span><span class="token punctuation">(</span>UUserWidget <span class="token operator">*</span>InParam1<span class="token punctuation">,</span> <span class="token keyword">bool</span> InParam2<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token function">checkSlow</span><span class="token punctuation">(</span><span class="token function">IsBound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token function">FOnItemSelected_DelegateWrapper</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> InParam1<span class="token punctuation">,</span> InParam2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">inline</span> <span class="token keyword">bool</span> <span class="token function">ExecuteIfBound</span><span class="token punctuation">(</span>UUserWidget <span class="token operator">*</span>InParam1<span class="token punctuation">,</span> <span class="token keyword">bool</span> InParam2<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsBound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token function">FOnItemSelected_DelegateWrapper</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> InParam1<span class="token punctuation">,</span> InParam2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>可以看到 <strong>Execute</strong> 和 <strong>ExecuteIfBound</strong> 都调用了 <strong>FOnItemSelected_DelegateWrapper</strong>，但并没有 FOnItemSelected_DelegateWrapper 的声明和定义</p><p>答案其实在 <strong>FID_Engine_Plugins_Experimental_CommonUI_Source_CommonUI_Public_CommonUITypes_h_176_DELEGATE</strong> 中， <code>FID_Engine_Plugins_Experimental_CommonUI_Source_CommonUI_Public_CommonUITypes_h_176_DELEGATE</code> 本身是一个宏定义，它的定义规则通过 Unreal 的 UHT 生成在 XXX.generated.h 文件内：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">FID_Engine_Plugins_Experimental_CommonUI_Source_CommonUI_Public_CommonUITypes_h_176_DELEGATE </span><span class="token punctuation">\</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token expression"><span class="token keyword">struct</span> <span class="token class-name">_Script_CommonUI_eventOnItemSelected_Parms</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token expression"><span class="token punctuation">&#123;</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token expression">UUserWidget<span class="token operator">*</span> Widget<span class="token punctuation">;</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token expression"><span class="token keyword">bool</span> Selected<span class="token punctuation">;</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token expression"><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token expression"><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">FOnItemSelected_DelegateWrapper</span><span class="token punctuation">(</span><span class="token keyword">const</span> FScriptDelegate<span class="token operator">&amp;</span> OnItemSelected<span class="token punctuation">,</span> UUserWidget<span class="token operator">*</span> Widget<span class="token punctuation">,</span> <span class="token keyword">bool</span> Selected<span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token expression"><span class="token punctuation">&#123;</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token expression">_Script_CommonUI_eventOnItemSelected_Parms Parms<span class="token punctuation">;</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token expression">Parms<span class="token punctuation">.</span>Widget<span class="token operator">=</span>Widget<span class="token punctuation">;</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token expression">Parms<span class="token punctuation">.</span>Selected<span class="token operator">=</span>Selected <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token expression">OnItemSelected<span class="token punctuation">.</span>ProcessDelegate<span class="token operator">&lt;</span>UObject<span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Parms<span class="token punctuation">)</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token expression"><span class="token punctuation">&#125;</span></span></pre></td></tr></table></figure><p>因此最终展开结果应该是这样：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">_Script_CommonUI_eventOnItemSelected_Parms</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    UUserWidget <span class="token operator">*</span>Widget<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">bool</span> Selected<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">FOnItemSelected_DelegateWrapper</span><span class="token punctuation">(</span><span class="token keyword">const</span> FScriptDelegate <span class="token operator">&amp;</span>OnItemSelected<span class="token punctuation">,</span> UUserWidget <span class="token operator">*</span>Widget<span class="token punctuation">,</span> <span class="token keyword">bool</span> Selected<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    _Script_CommonUI_eventOnItemSelected_Parms Parms<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    Parms<span class="token punctuation">.</span>Widget <span class="token operator">=</span> Widget<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    Parms<span class="token punctuation">.</span>Selected <span class="token operator">=</span> Selected <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    OnItemSelected<span class="token punctuation">.</span>ProcessDelegate<span class="token operator">&lt;</span>UObject<span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Parms<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">FOnItemSelected</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">TBaseDynamicDelegate</span><span class="token operator">&lt;</span><span class="token class-name">FWeakObjectPtr</span><span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token punctuation">,</span> <span class="token class-name">UUserWidget</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">FOnItemSelected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">explicit</span> <span class="token function">FOnItemSelected</span><span class="token punctuation">(</span><span class="token keyword">const</span> TScriptDelegate<span class="token operator">&lt;</span><span class="token operator">></span> <span class="token operator">&amp;</span>InScriptDelegate<span class="token punctuation">)</span> <span class="token operator">:</span> TBaseDynamicDelegate<span class="token operator">&lt;</span>FWeakObjectPtr<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token punctuation">,</span> UUserWidget <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">></span><span class="token punctuation">(</span>InScriptDelegate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">Execute</span><span class="token punctuation">(</span>UUserWidget <span class="token operator">*</span>InParam1<span class="token punctuation">,</span> <span class="token keyword">bool</span> InParam2<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token function">checkSlow</span><span class="token punctuation">(</span><span class="token function">IsBound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token function">FOnItemSelected_DelegateWrapper</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> InParam1<span class="token punctuation">,</span> InParam2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">inline</span> <span class="token keyword">bool</span> <span class="token function">ExecuteIfBound</span><span class="token punctuation">(</span>UUserWidget <span class="token operator">*</span>InParam1<span class="token punctuation">,</span> <span class="token keyword">bool</span> InParam2<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsBound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token function">FOnItemSelected_DelegateWrapper</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> InParam1<span class="token punctuation">,</span> InParam2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="tscriptdelegate"><a class="anchor" href="#tscriptdelegate">#</a> TScriptDelegate</h3><p><strong>TScriptDelegate</strong> 是所有 DynamicDelegate 的基类，提供绑定 / 解绑 / 执行等基础接口。相比于简单委托在绑定完成后，只能通过 <strong>Delegate Instance</strong> 销毁重建的形式来切换绑定对象；<strong>TScriptDelegate</strong> 采用了更优雅的<strong>动态</strong>绑定机制，即通过<strong>对象实例指针</strong> &amp;&amp; <strong>函数名</strong> 利用反射机制的绑定流程。然而反射机制的实现，依赖于 <strong>UObject</strong> 对象关联的 UClass 中包含的元数据，因此动态委托的绑定函数也必须是 <strong>UFunction</strong> 类型。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">TWeakPtr</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">RetValType</span><span class="token punctuation">,</span> <span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> ParamTypes<span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TBaseDynamicDelegate</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">TScriptDelegate</span><span class="token operator">&lt;</span><span class="token class-name">TWeakPtr</span><span class="token operator">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">TWeakPtr</span> <span class="token operator">=</span> FWeakObjectPtr<span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TScriptDelegate</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token comment">/**</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	 * Binds a UFunction to this delegate.</pre></td></tr><tr><td data-num="12"></td><td><pre>	 *</pre></td></tr><tr><td data-num="13"></td><td><pre>	 * @param InObject The object to call the function on.</pre></td></tr><tr><td data-num="14"></td><td><pre>	 * @param InFunctionName The name of the function to call.</pre></td></tr><tr><td data-num="15"></td><td><pre>	 */</pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token keyword">void</span> <span class="token function">BindUFunction</span><span class="token punctuation">(</span> UObject<span class="token operator">*</span> InObject<span class="token punctuation">,</span> <span class="token keyword">const</span> FName<span class="token operator">&amp;</span> InFunctionName <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		Object <span class="token operator">=</span> InObject<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		FunctionName <span class="token operator">=</span> InFunctionName<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    </pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	 * Unbinds this delegate</pre></td></tr><tr><td data-num="24"></td><td><pre>	 */</pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token keyword">void</span> <span class="token function">Unbind</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		Object <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		FunctionName <span class="token operator">=</span> NAME_None<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    </pre></td></tr><tr><td data-num="31"></td><td><pre>     <span class="token comment">/**</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	 * Executes a delegate by calling the named function on the object bound to the delegate.  You should</pre></td></tr><tr><td data-num="33"></td><td><pre>	 * always first verify that the delegate is safe to execute by calling IsBound() before calling this function.</pre></td></tr><tr><td data-num="34"></td><td><pre>	 * In general, you should never call this function directly.  Instead, call Execute() on a derived class.</pre></td></tr><tr><td data-num="35"></td><td><pre>	 *</pre></td></tr><tr><td data-num="36"></td><td><pre>	 * @param	Parameters		Parameter structure</pre></td></tr><tr><td data-num="37"></td><td><pre>	 */</pre></td></tr><tr><td data-num="38"></td><td><pre>	<span class="token comment">//CORE_API void ProcessDelegate(void* Parameters) const;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>	<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">UObjectTemplate</span><span class="token operator">></span></pre></td></tr><tr><td data-num="40"></td><td><pre>	<span class="token keyword">void</span> <span class="token function">ProcessDelegate</span><span class="token punctuation">(</span> <span class="token keyword">void</span><span class="token operator">*</span> Parameters <span class="token punctuation">)</span> <span class="token keyword">const</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>		<span class="token comment">// sure IsBound() returns true before calling ProcessDelegate()!</span></pre></td></tr><tr><td data-num="43"></td><td><pre>		UObjectTemplate<span class="token operator">*</span> ObjectPtr <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span> UObjectTemplate<span class="token operator">*</span> <span class="token operator">></span><span class="token punctuation">(</span> Object<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// Down-cast</span></pre></td></tr><tr><td data-num="44"></td><td><pre>		<span class="token function">checkSlow</span><span class="token punctuation">(</span> <span class="token function">IsValid</span><span class="token punctuation">(</span>ObjectPtr<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>		<span class="token comment">// Object *must* implement the specified function</span></pre></td></tr><tr><td data-num="47"></td><td><pre>		UFunction<span class="token operator">*</span> Function <span class="token operator">=</span> ObjectPtr<span class="token operator">-></span><span class="token function">FindFunctionChecked</span><span class="token punctuation">(</span> FunctionName <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>		<span class="token comment">// Execute the delegate!</span></pre></td></tr><tr><td data-num="50"></td><td><pre>		ObjectPtr<span class="token operator">-></span><span class="token function">ProcessEvent</span><span class="token punctuation">(</span>Function<span class="token punctuation">,</span> Parameters<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre></pre></td></tr><tr><td data-num="55"></td><td><pre>UFunction<span class="token operator">*</span> <span class="token class-name">UObject</span><span class="token operator">::</span><span class="token function">FindFunctionChecked</span><span class="token punctuation">(</span> FName InName <span class="token punctuation">)</span> <span class="token keyword">const</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>	UFunction<span class="token operator">*</span> Result <span class="token operator">=</span> <span class="token function">FindFunction</span><span class="token punctuation">(</span>InName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>Result <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="59"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>		<span class="token function">UE_LOG</span><span class="token punctuation">(</span>LogScriptCore<span class="token punctuation">,</span> Fatal<span class="token punctuation">,</span> <span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"Failed to find function %s in %s"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>InName<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token function">GetFullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>	<span class="token keyword">return</span> Result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre>UFunction<span class="token operator">*</span> <span class="token class-name">UObject</span><span class="token operator">::</span><span class="token function">FindFunction</span><span class="token punctuation">(</span> FName InName <span class="token punctuation">)</span> <span class="token keyword">const</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>	<span class="token keyword">return</span> <span class="token function">GetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">FindFunctionByName</span><span class="token punctuation">(</span>InName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="dynamicmulticasedelegate-动态多播委托"><a class="anchor" href="#dynamicmulticasedelegate-动态多播委托">#</a> DynamicMulticaseDelegate 动态多播委托</h2><p>该委托可以动态绑定一组成员函数，对于支持编辑器形式 (需要动态增删) 的事件调用非常的有效（尤其是蓝图</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// example:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">DECLARE_DYNAMIC_MULTICAST_DELEGATE_TwoParams</span><span class="token punctuation">(</span>FOnBeforePopup<span class="token punctuation">,</span> FString<span class="token punctuation">,</span> URL<span class="token punctuation">,</span> FString<span class="token punctuation">,</span> Frame<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 展开结果:</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">WebBrowser_eventOnBeforePopup_Parms</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    FString URL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    FString Frame<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">FOnBeforePopup_DelegateWrapper</span><span class="token punctuation">(</span><span class="token keyword">const</span> FMulticastScriptDelegate <span class="token operator">&amp;</span>OnBeforePopup<span class="token punctuation">,</span> <span class="token keyword">const</span> FString <span class="token operator">&amp;</span>URL<span class="token punctuation">,</span> <span class="token keyword">const</span> FString <span class="token operator">&amp;</span>Frame<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    WebBrowser_eventOnBeforePopup_Parms Parms<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    Parms<span class="token punctuation">.</span>URL <span class="token operator">=</span> URL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    Parms<span class="token punctuation">.</span>Frame <span class="token operator">=</span> Frame<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    OnBeforePopup<span class="token punctuation">.</span>ProcessMulticastDelegate<span class="token operator">&lt;</span>UObject<span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Parms<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">FOnBeforePopup</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">TBaseDynamicMulticastDelegate</span><span class="token operator">&lt;</span><span class="token class-name">FWeakObjectPtr</span><span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token punctuation">,</span> <span class="token class-name">FString</span><span class="token punctuation">,</span> <span class="token class-name">FString</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">FOnBeforePopup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">explicit</span> <span class="token function">FOnBeforePopup</span><span class="token punctuation">(</span><span class="token keyword">const</span> TMulticastScriptDelegate<span class="token operator">&lt;</span><span class="token operator">></span> <span class="token operator">&amp;</span>InMulticastScriptDelegate<span class="token punctuation">)</span> <span class="token operator">:</span> TBaseDynamicMulticastDelegate<span class="token operator">&lt;</span>FWeakObjectPtr<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token punctuation">,</span> FString<span class="token punctuation">,</span> FString<span class="token operator">></span><span class="token punctuation">(</span>InMulticastScriptDelegate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">Broadcast</span><span class="token punctuation">(</span>FString InParam1<span class="token punctuation">,</span> FString InParam2<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token function">FOnBeforePopup_DelegateWrapper</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> InParam1<span class="token punctuation">,</span> InParam2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="tmulticastscriptdelegate"><a class="anchor" href="#tmulticastscriptdelegate">#</a> TMulticastScriptDelegate</h3><p>TMulticastScriptDelegate 是所有 DynamicMulticaseDelegate 的基类，负责管理和维护 <strong>TScriptDelegate</strong> 的数组</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/image-20221027104606040.png" alt="image-20221027104606040"></p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TMulticastScriptDelegate</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>     <span class="token comment">/**</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	 * Executes a multi-cast delegate by calling all functions on objects bound to the delegate.  Always</pre></td></tr><tr><td data-num="5"></td><td><pre>	 * safe to call, even if when no objects are bound, or if objects have expired.  In general, you should</pre></td></tr><tr><td data-num="6"></td><td><pre>	 * never call this function directly.  Instead, call Broadcast() on a derived class.</pre></td></tr><tr><td data-num="7"></td><td><pre>	 *</pre></td></tr><tr><td data-num="8"></td><td><pre>	 * @param	Params				Parameter structure</pre></td></tr><tr><td data-num="9"></td><td><pre>	 */</pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">UObjectTemplate</span><span class="token operator">></span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">void</span> <span class="token function">ProcessMulticastDelegate</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> Parameters<span class="token punctuation">)</span> <span class="token keyword">const</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span> InvocationList<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>			<span class="token comment">// Create a copy of the invocation list, just in case the list is modified by one of the callbacks during the broadcast</span></pre></td></tr><tr><td data-num="16"></td><td><pre>			<span class="token keyword">typedef</span> TArray<span class="token operator">&lt;</span> TScriptDelegate<span class="token operator">&lt;</span>TWeakPtr<span class="token operator">></span><span class="token punctuation">,</span> TInlineAllocator<span class="token operator">&lt;</span> <span class="token number">4</span> <span class="token operator">></span> <span class="token operator">></span> FInlineInvocationList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>			FInlineInvocationList InvocationListCopy <span class="token operator">=</span> <span class="token function">FInlineInvocationList</span><span class="token punctuation">(</span>InvocationList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	</pre></td></tr><tr><td data-num="19"></td><td><pre>			<span class="token comment">// Invoke each bound function</span></pre></td></tr><tr><td data-num="20"></td><td><pre>			<span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">typename</span> <span class="token class-name">FInlineInvocationList</span><span class="token operator">::</span>TConstIterator <span class="token function">FunctionIt</span><span class="token punctuation">(</span> InvocationListCopy <span class="token punctuation">)</span><span class="token punctuation">;</span> FunctionIt<span class="token punctuation">;</span> <span class="token operator">++</span>FunctionIt <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>				<span class="token keyword">if</span><span class="token punctuation">(</span> FunctionIt<span class="token operator">-></span><span class="token function">IsBound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>				<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>					<span class="token comment">// Invoke this delegate!</span></pre></td></tr><tr><td data-num="25"></td><td><pre>					FunctionIt<span class="token operator">-></span><span class="token keyword">template</span> ProcessDelegate<span class="token operator">&lt;</span>UObjectTemplate<span class="token operator">></span><span class="token punctuation">(</span>Parameters<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> FunctionIt<span class="token operator">-></span><span class="token function">IsCompactable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>				<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>					<span class="token comment">// Function couldn't be executed, so remove it.  Note that because the original list could have been modified by one of the callbacks, we have to search for the function to remove here.</span></pre></td></tr><tr><td data-num="30"></td><td><pre>					<span class="token function">RemoveInternal</span><span class="token punctuation">(</span> <span class="token operator">*</span>FunctionIt <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    </pre></td></tr><tr><td data-num="36"></td><td><pre>	<span class="token keyword">typedef</span> TArray<span class="token operator">&lt;</span> TScriptDelegate<span class="token operator">&lt;</span>TWeakPtr<span class="token operator">></span> <span class="token operator">></span> FInvocationList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	<span class="token comment">/** Ordered list functions to invoke when the Broadcast function is called */</span></pre></td></tr><tr><td data-num="38"></td><td><pre>	<span class="token keyword">mutable</span> FInvocationList InvocationList<span class="token punctuation">;</span>		<span class="token comment">// Mutable so that we can housekeep list even with 'const' broadcasts</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="sparsedynamicdelegate-稀疏动态委托"><a class="anchor" href="#sparsedynamicdelegate-稀疏动态委托">#</a> SparseDynamicDelegate 稀疏动态委托</h2><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// example:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">DECLARE_DYNAMIC_MULTICAST_SPARSE_DELEGATE_TwoParams</span><span class="token punctuation">(</span>FActorOnClickedSignature<span class="token punctuation">,</span> AActor<span class="token punctuation">,</span> OnClicked<span class="token punctuation">,</span> AActor<span class="token operator">*</span><span class="token punctuation">,</span> TouchedActor<span class="token punctuation">,</span> FKey<span class="token punctuation">,</span> ButtonPressed<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 展开结果:</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">_Script_Engine_eventActorOnClickedSignature_Parms</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    AActor <span class="token operator">*</span>TouchedActor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    FKey ButtonPressed<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">FActorOnClickedSignature_DelegateWrapper</span><span class="token punctuation">(</span><span class="token keyword">const</span> FMulticastScriptDelegate <span class="token operator">&amp;</span>ActorOnClickedSignature<span class="token punctuation">,</span> AActor <span class="token operator">*</span>TouchedActor<span class="token punctuation">,</span> FKey ButtonPressed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    _Script_Engine_eventActorOnClickedSignature_Parms Parms<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    Parms<span class="token punctuation">.</span>TouchedActor <span class="token operator">=</span> TouchedActor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    Parms<span class="token punctuation">.</span>ButtonPressed <span class="token operator">=</span> ButtonPressed<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    ActorOnClickedSignature<span class="token punctuation">.</span>ProcessMulticastDelegate<span class="token operator">&lt;</span>UObject<span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Parms<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">FActorOnClickedSignature_MCSignature</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">TBaseDynamicMulticastDelegate</span><span class="token operator">&lt;</span><span class="token class-name">FWeakObjectPtr</span><span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token punctuation">,</span> <span class="token class-name">AActor</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">FKey</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">FActorOnClickedSignature_MCSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">explicit</span> <span class="token function">FActorOnClickedSignature_MCSignature</span><span class="token punctuation">(</span><span class="token keyword">const</span> TMulticastScriptDelegate<span class="token operator">&lt;</span><span class="token operator">></span> <span class="token operator">&amp;</span>InMulticastScriptDelegate<span class="token punctuation">)</span> <span class="token operator">:</span> TBaseDynamicMulticastDelegate<span class="token operator">&lt;</span>FWeakObjectPtr<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token punctuation">,</span> AActor <span class="token operator">*</span><span class="token punctuation">,</span> FKey<span class="token operator">></span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            InMulticastScriptDelegate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">Broadcast</span><span class="token punctuation">(</span>AActor <span class="token operator">*</span>InParam1<span class="token punctuation">,</span> FKey InParam2<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token function">FActorOnClickedSignature_DelegateWrapper</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> InParam1<span class="token punctuation">,</span> InParam2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">FActorOnClickedSignatureInfoGetter</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">GetDelegateName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token string">"OnClicked"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">static</span> size_t <span class="token function">GetDelegateOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">offsetof</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> OnClicked<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">FActorOnClickedSignature</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">TSparseDynamicDelegate</span><span class="token operator">&lt;</span><span class="token class-name">FActorOnClickedSignature_MCSignature</span><span class="token punctuation">,</span> <span class="token class-name">AActor</span><span class="token punctuation">,</span> <span class="token class-name">FActorOnClickedSignatureInfoGetter</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>SparseDynamicDelegate</strong> 宏展开相对复杂一些，主要内容可以分为两部分：</p><ul><li>继承自 <strong>TBaseDynamicMulticastDelegate</strong> 的 <strong>FActorOnClickedSignature_MCSignature</strong> 类，实现了基本的动态多播委托逻辑，但命名上做了改动，没有正常暴露给外部使用。</li><li>继承自 <strong>TSparseDynamicDelegate&lt;FActorOnClickedSignature_MCSignature...&gt;</strong> 的 <strong>FActorOnClickedSignature</strong> 类，重新实现了 TBaseDynamicMulticastDelegate 中操作委托数组的各项接口，重定向修改到了 <strong>FSparseDelegateStorage</strong>。开发者实际上是通过 FActorOnClickedSignature 间接操作 FActorOnClickedSignature_MCSignature。</li></ul><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/image-20221027113233720.png" alt="image-20221027113233720"></p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">FSparseDelegate</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token comment">/**</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	* Adds a function delegate to this multi-cast delegate's invocation list if a delegate with the same signature</pre></td></tr><tr><td data-num="5"></td><td><pre>	* doesn't already exist in the invocation list</pre></td></tr><tr><td data-num="6"></td><td><pre>	*</pre></td></tr><tr><td data-num="7"></td><td><pre>	* @param	DelegateOwner	UObject that owns the resolved sparse delegate</pre></td></tr><tr><td data-num="8"></td><td><pre>	* @param	DelegateName	Name of the resolved sparse delegate</pre></td></tr><tr><td data-num="9"></td><td><pre>	* @param	InDelegate		Delegate to bind to the sparse delegate</pre></td></tr><tr><td data-num="10"></td><td><pre>	* </pre></td></tr><tr><td data-num="11"></td><td><pre>	* NOTE:  Only call this function from blueprint sparse delegate infrastructure on a resolved generic FScriptDelegate pointer.</pre></td></tr><tr><td data-num="12"></td><td><pre>	*        Generally from C++ you should call AddUnique() directly.</pre></td></tr><tr><td data-num="13"></td><td><pre>	*/</pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token keyword">void</span> <span class="token function">__Internal_AddUnique</span><span class="token punctuation">(</span><span class="token keyword">const</span> UObject<span class="token operator">*</span> DelegateOwner<span class="token punctuation">,</span> FName DelegateName<span class="token punctuation">,</span> FScriptDelegate InDelegate<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		bIsBound <span class="token operator">|=</span> <span class="token class-name">FSparseDelegateStorage</span><span class="token operator">::</span><span class="token function">AddUnique</span><span class="token punctuation">(</span>DelegateOwner<span class="token punctuation">,</span> DelegateName<span class="token punctuation">,</span> <span class="token function">MoveTemp</span><span class="token punctuation">(</span>InDelegate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    </pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="fsparsedelegatestorage"><a class="anchor" href="#fsparsedelegatestorage">#</a> FSparseDelegateStorage</h3><p><strong>FSparseDelegateStorage</strong> 可以理解成一个维护全局动态多播委托的单例，它的所有成员变量 / 函数都是 Static。通过一个全局 map 来记录 UObject 中所有 <strong>FMulticastScriptDelegate</strong> 的弱引用，而 <strong>FMulticastScriptDelegate</strong> 中又存储了多个 <strong>FScriptDelegate</strong>。</p><p>顺带一提 <strong>FScriptDelegate</strong> 和 <strong>FMulticastScriptDelegate</strong> 分别是 <strong>TScriptDelegate</strong> 和 <strong>TMulticastScriptDelegate</strong> 的特化版本... 这里经常容易搞混。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Typedef script delegates for convenience.</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">typedef</span> TScriptDelegate<span class="token operator">&lt;</span><span class="token operator">></span> FScriptDelegate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">typedef</span> TMulticastScriptDelegate<span class="token operator">&lt;</span><span class="token operator">></span> FMulticastScriptDelegate<span class="token punctuation">;</span></pre></td></tr></table></figure><p>通过 <strong>TSparseDynamicDelegate</strong> 向 <strong>FMulticastScriptDelegate</strong> 添加 <strong>FScriptDelegate</strong> 时，会先把 <strong>FMulticastScriptDelegate</strong> 注册到 <strong>FSparseDelegateStorage</strong> 全局 map 中，再把 <strong>FScriptDelegate</strong> 添加到 <strong>FMulticastScriptDelegate</strong> 容器内。</p><blockquote><p>注意：<strong>DelegateOwner</strong> 只是持有<strong>操作</strong> FMulticastScriptDelegate 的 <strong>TSparseDynamicDelegate</strong> 对象，<strong>FSparseDelegateStorage</strong> 才负责存储 FMulticastScriptDelegate 和所有注册的 FScriptDelegate；<strong>DelegateOwner</strong> 通过 <strong>TSparseDynamicDelegate</strong> 对 <strong>FSparseDelegateStorage</strong> 中的数据进行修改。</p></blockquote><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 添加</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">FSparseDelegateStorage</span><span class="token operator">::</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">const</span> UObject<span class="token operator">*</span> DelegateOwner<span class="token punctuation">,</span> <span class="token keyword">const</span> FName DelegateName<span class="token punctuation">,</span> FScriptDelegate Delegate<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">bool</span> bDelegateWasBound <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>Delegate<span class="token punctuation">.</span><span class="token function">IsBound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		FScopeLock <span class="token function">SparseDelegateMapLock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>SparseDelegateMapCritical<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>SparseDelegates<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>			SparseDelegateObjectListener<span class="token punctuation">.</span><span class="token function">EnableListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>		FSparseDelegateMap<span class="token operator">&amp;</span> DelegateMap <span class="token operator">=</span> SparseDelegates<span class="token punctuation">.</span><span class="token function">FindOrAdd</span><span class="token punctuation">(</span>DelegateOwner<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		TSharedPtr<span class="token operator">&lt;</span>FMulticastScriptDelegate<span class="token operator">></span><span class="token operator">&amp;</span> MulticastDelegate <span class="token operator">=</span> DelegateMap<span class="token punctuation">.</span><span class="token function">FindOrAdd</span><span class="token punctuation">(</span>DelegateName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>MulticastDelegate<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>			MulticastDelegate <span class="token operator">=</span> MakeShared<span class="token operator">&lt;</span>FMulticastScriptDelegate<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		<span class="token comment">// 实际操作的是 FSparseDelegateStorage 中创建 or 已存在的 FMulticastScriptDelegate</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		MulticastDelegate<span class="token operator">-></span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token function">MoveTemp</span><span class="token punctuation">(</span>Delegate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		bDelegateWasBound <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token keyword">return</span> bDelegateWasBound<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">// 查询</span></pre></td></tr><tr><td data-num="28"></td><td><pre>TSharedPtr<span class="token operator">&lt;</span>FMulticastScriptDelegate<span class="token operator">></span> <span class="token class-name">FSparseDelegateStorage</span><span class="token operator">::</span><span class="token function">GetSharedMulticastDelegate</span><span class="token punctuation">(</span><span class="token keyword">const</span> UObject<span class="token operator">*</span> DelegateOwner<span class="token punctuation">,</span> <span class="token keyword">const</span> FName DelegateName<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	FScopeLock <span class="token function">SparseDelegateMapLock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>SparseDelegateMapCritical<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>	TSharedPtr<span class="token operator">&lt;</span>FMulticastScriptDelegate<span class="token operator">></span> Result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>FSparseDelegateMap<span class="token operator">*</span> DelegateMap <span class="token operator">=</span> SparseDelegates<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>DelegateOwner<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>TSharedPtr<span class="token operator">&lt;</span>FMulticastScriptDelegate<span class="token operator">></span><span class="token operator">*</span> MulticastDelegatePtr <span class="token operator">=</span> DelegateMap<span class="token operator">-></span><span class="token function">Find</span><span class="token punctuation">(</span>DelegateName<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>			Result <span class="token operator">=</span> <span class="token operator">*</span>MulticastDelegatePtr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>	<span class="token keyword">return</span> Result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="总结"><a class="anchor" href="#总结">#</a> 总结</h2><p>Unreal 提供了多种委托，其中「Delegate 」用法灵活，支持各种类型的函数绑定，执行效率也较<strong>高</strong>，对于有返回值的函数调用时<strong>不太安全</strong>；「MulticaseDelegate 」在原有基础上扩充了一对多的绑定关系；「Event 」又在 MulticaseDelegate 的基础上通过 <code>friend class</code> 约束了调用者；「DynamicDelegate 」相比于 Delegate，舍弃了更多函数类型的支持，降低了执行效率，但能够动态绑定且调用更加的<strong>安全</strong>；「DynamicMulticaseDelegate 」同样在原有基础上扩充了一对多的绑定关系；「SparseDynamicDelegate」又在 DynamicMulticaseDelegate 基础上重定向了委托的存储位置，通过 FSparseDelegateStorage 全局 map 集中管理。</p><div class="tags"><a href="/tags/UE/" rel="tag"><i class="ic i-tag"></i> UE</a> <a href="/tags/Delegate/" rel="tag"><i class="ic i-tag"></i> Delegate</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-12-29 09:36:04" itemprop="dateModified" datetime="2022-12-29T09:36:04+08:00">2022-12-29</time> </span><span id="learning/unreal/UE Delegate/" class="item leancloud_visitors" data-flag-title="UE Delegate" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 充电</button><p>请我[恰饭]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="鑫酱(●'◡'●) 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="鑫酱(●'◡'●) 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>鑫酱(●'◡'●) <i class="ic i-at"><em>@</em></i>鑫酱</li><li class="link"><strong>本文链接：</strong> <a href="https://hakuya.me/learning/unreal/UE%20Delegate/" title="UE Delegate">https://hakuya.me/learning/unreal/UE Delegate/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/learning/unreal/UE%20VirtualMachine/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;wallpaper-1255596461.cos.ap-nanjing.myqcloud.com&#x2F;wallpaper (22).jpg" title="UE VirtualMachine"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> UE</span><h3>UE VirtualMachine</h3></a></div><div class="item right"><a href="/learning/unreal/UE%20%E8%B5%84%E4%BA%A7%E5%AF%BC%E5%87%BA%E5%92%8C%E5%8A%A0%E8%BD%BD/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;wallpaper-1255596461.cos.ap-nanjing.myqcloud.com&#x2F;wallpaper_4.jpg" title="UE 资产导出和加载"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> UE</span><h3>UE 资产导出和加载</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#delegate-%E5%A7%94%E6%89%98"><span class="toc-number">1.</span> <span class="toc-text">Delegate 委托</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#delegate-%E7%AE%80%E5%8D%95%E5%A7%94%E6%89%98"><span class="toc-number">1.1.</span> <span class="toc-text">Delegate 简单委托</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tdelegate"><span class="toc-number">1.1.1.</span> <span class="toc-text">TDelegate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delegate-instance"><span class="toc-number">1.1.2.</span> <span class="toc-text">Delegate Instance</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#delegate-instance-%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">Delegate Instance 实例化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#multicasedelegate-%E5%A4%9A%E6%92%AD%E5%A7%94%E6%89%98"><span class="toc-number">1.2.</span> <span class="toc-text">MulticaseDelegate 多播委托</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tmulticastdelegate"><span class="toc-number">1.2.1.</span> <span class="toc-text">TMulticastDelegate</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#event-%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.3.</span> <span class="toc-text">Event 事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dynamicdelegate-%E5%8A%A8%E6%80%81%E5%A7%94%E6%89%98"><span class="toc-number">1.4.</span> <span class="toc-text">DynamicDelegate 动态委托</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tscriptdelegate"><span class="toc-number">1.4.1.</span> <span class="toc-text">TScriptDelegate</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dynamicmulticasedelegate-%E5%8A%A8%E6%80%81%E5%A4%9A%E6%92%AD%E5%A7%94%E6%89%98"><span class="toc-number">1.5.</span> <span class="toc-text">DynamicMulticaseDelegate 动态多播委托</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tmulticastscriptdelegate"><span class="toc-number">1.5.1.</span> <span class="toc-text">TMulticastScriptDelegate</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sparsedynamicdelegate-%E7%A8%80%E7%96%8F%E5%8A%A8%E6%80%81%E5%A7%94%E6%89%98"><span class="toc-number">1.6.</span> <span class="toc-text">SparseDynamicDelegate 稀疏动态委托</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fsparsedelegatestorage"><span class="toc-number">1.6.1.</span> <span class="toc-text">FSparseDelegateStorage</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.7.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/learning/unreal/UE%20%E5%9F%BA%E7%A1%80%E7%AF%87/" rel="bookmark" title="UE 基础篇">UE 基础篇</a></li><li><a href="/learning/unreal/UE%20%E8%93%9D%E5%9B%BE%E7%AF%87/" rel="bookmark" title="UE 蓝图篇">UE 蓝图篇</a></li><li class="active"><a href="/learning/unreal/UE%20Delegate/" rel="bookmark" title="UE Delegate">UE Delegate</a></li><li><a href="/learning/unreal/UE%20VirtualMachine/" rel="bookmark" title="UE VirtualMachine">UE VirtualMachine</a></li><li><a href="/learning/unreal/UE%20%E8%B5%84%E4%BA%A7%E5%AF%BC%E5%87%BA%E5%92%8C%E5%8A%A0%E8%BD%BD/" rel="bookmark" title="UE 资产导出和加载">UE 资产导出和加载</a></li><li><a href="/learning/unreal/Unreal%20%E6%8F%A1%E6%89%8B%E6%B5%81%E7%A8%8B/" rel="bookmark" title="Unreal 握手流程">Unreal 握手流程</a></li><li><a href="/learning/unreal/Unreal%20RPC/" rel="bookmark" title="Unreal RPC">Unreal RPC</a></li><li><a href="/learning/unreal/Unreal%20Replication%20%E7%AF%87/" rel="bookmark" title="Unreal ReplicationGraph 篇">Unreal ReplicationGraph 篇</a></li><li><a href="/learning/unreal/Unreal%20Chaos%20%E5%AF%BC%E5%87%BA%E4%B8%BA%20PhysX%20%E7%89%A9%E7%90%86%E6%96%87%E4%BB%B6/" rel="bookmark" title="Unreal Chaos 导出为 PhysX 物理文件">Unreal Chaos 导出为 PhysX 物理文件</a></li><li><a href="/learning/unreal/Unreal%20Iris%EF%BC%88%E4%B8%80%EF%BC%89%E6%A6%82%E8%BF%B0/" rel="bookmark" title="Unreal Iris（一）概述">Unreal Iris（一）概述</a></li><li><a href="/learning/unreal/Unreal%20Iris%EF%BC%88%E4%BA%8C%EF%BC%89ReplicationState/" rel="bookmark" title="Unreal Iris（二）ReplicationState">Unreal Iris（二）ReplicationState</a></li><li><a href="/learning/unreal/Unreal%20Iris%EF%BC%88%E4%B8%89%EF%BC%89Filtering%20&&%20Prioritization/" rel="bookmark" title="Unreal Iris（三）Filtering && Prioritization">Unreal Iris（三）Filtering && Prioritization</a></li><li><a href="/learning/unreal/Unreal%20Iris%EF%BC%88%E5%9B%9B%EF%BC%89DataStream/" rel="bookmark" title="Unreal Iris（四）DataStream">Unreal Iris（四）DataStream</a></li><li><a href="/learning/unreal/Unreal%20Iris%EF%BC%88%E4%BA%94%EF%BC%89BaseLine%20&&%20DeltaCompression/" rel="bookmark" title="Unreal Iris（五）BaseLine && DeltaCompression">Unreal Iris（五）BaseLine && DeltaCompression</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="鑫酱(●'◡'●)" data-src="/images/avatar.jpg"><p class="name" itemprop="name">鑫酱(●'◡'●)</p><div class="description" itemprop="description">整天摸鱼，却妄想拯救世界的技术宅</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">110</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">25</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">67</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FsbGVuR1g=" title="https:&#x2F;&#x2F;github.com&#x2F;AllenGX"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTgwNTM4MjQy" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;80538242"><i class="ic i-cloud-music"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjE0MTM5MDcxNTNAcXEuY29t" title="mailto:1413907153@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>好友</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>网址</a></li><li class="item"><a href="/travellings/" rel="section"><i class="ic i-paper-plane"></i>传送门</a></li><li class="item"><a href="/mikutap/" rel="section"><i class="ic i-star"></i>Mikutap</a></li><li class="item"><a href="/restart/" rel="section"><i class="ic i-sun"></i>RestartLife</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/learning/unreal/UE%20VirtualMachine/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/learning/unreal/UE%20%E8%B5%84%E4%BA%A7%E5%AF%BC%E5%87%BA%E5%92%8C%E5%8A%A0%E8%BD%BD/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B9%B4%E6%8A%A5/" title="分类于 年报">年报</a></div><span><a href="/annals/2023%E5%B9%B4%E6%8A%A5/" title="2023年报">2023年报</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game101/" title="分类于 Games101图形渲染">Games101图形渲染</a></div><span><a href="/learning/games/Game101/%E5%8D%81%E4%B9%9D%E3%80%81Advanced%20Topics%20in%20Rendering%E2%80%94%E2%80%94Light%20Transport/" title="十九、Advanced Topics in Rendering——Light Transport">十九、Advanced Topics in Rendering——Light Transport</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/unreal/" title="分类于 UE">UE</a></div><span><a href="/learning/unreal/UE%20%E5%9F%BA%E7%A1%80%E7%AF%87/" title="UE 基础篇">UE 基础篇</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/physx/" title="分类于 物理引擎">物理引擎</a></div><span><a href="/learning/physx/PhysX%E5%86%85%E7%BD%AE%E5%AE%B9%E5%99%A8%E4%BB%8B%E7%BB%8D/" title="PhysX内置容器介绍">PhysX内置容器介绍</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/recastnavigation/" title="分类于 导航网格">导航网格</a></div><span><a href="/learning/recastnavigation/Recast%20Navigation/" title="Recast Navigation">Recast Navigation</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/cpp/" title="分类于 cpp">cpp</a></div><span><a href="/learning/programlanguage/cpp/%E5%8D%81%E3%80%81%E5%AF%B9%E8%B1%A1%E5%92%8C%E7%B1%BB/" title="十、对象和类">十、对象和类</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/unreal/" title="分类于 UE">UE</a></div><span><a href="/learning/unreal/Unreal%20Chaos%20%E5%AF%BC%E5%87%BA%E4%B8%BA%20PhysX%20%E7%89%A9%E7%90%86%E6%96%87%E4%BB%B6/" title="Unreal Chaos 导出为 PhysX 物理文件">Unreal Chaos 导出为 PhysX 物理文件</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/physx/" title="分类于 物理引擎">物理引擎</a></div><span><a href="/learning/physx/%E3%80%8CScene%20Queries%E3%80%8DAABBTree%E2%80%94%E2%80%94%E4%B8%8B/" title="「Scene Queries」AABBTree——下">「Scene Queries」AABBTree——下</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game101/" title="分类于 Games101图形渲染">Games101图形渲染</a></div><span><a href="/learning/games/Game101/%E5%85%AD%E3%80%81Rasterization%EF%BC%88%E4%B8%8B%EF%BC%89%E2%80%94%E2%80%94Depth%20buffer/" title="六、Rasterization（下）——Z-Buffering">六、Rasterization（下）——Z-Buffering</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/cpp/" title="分类于 cpp">cpp</a></div><span><a href="/learning/programlanguage/cpp/%E6%9D%82%E9%A1%B9/" title="杂项">杂项</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">鑫酱(●'◡'●) @ 个人博客</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">639k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">9:41</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"learning/unreal/UE Delegate/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/animejs@3.2.0/lib/anime.min.js,npm/katex@0.12.0/dist/contrib/copy-tex.min.js,npm/frappe-charts@1.5.0/dist/frappe-charts.min.iife.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/quicklink@2/dist/quicklink.umd.js,gh/amehime/MiniValine@4.2.2-beta10/dist/MiniValine.min.js"></script><script src="/js/app.js?v=0.2.5"></script><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b6d809b500bd6f0040117088899bc7bf";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>