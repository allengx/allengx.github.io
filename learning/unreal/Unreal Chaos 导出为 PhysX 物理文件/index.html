<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="XqWEZ-KjvQT4IfXzxYvH-PEc--_zN6GqthY2jBsqOs4"><meta name="msvalidate.01" content="4E28E3FDD5912EBBB84869B17359650D"><meta name="baidu-site-verification" content="code-dwpSTDBLS2"><link rel="alternate" type="application/rss+xml" title="鑫酱" href="https://hakuya.me/rss.xml"><link rel="alternate" type="application/atom+xml" title="鑫酱" href="https://hakuya.me/atom.xml"><link rel="alternate" type="application/json" title="鑫酱" href="https://hakuya.me/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="UE5,Chaos"><link rel="canonical" href="https://hakuya.me/learning/unreal/Unreal%20Chaos%20%E5%AF%BC%E5%87%BA%E4%B8%BA%20PhysX%20%E7%89%A9%E7%90%86%E6%96%87%E4%BB%B6/"><title>Unreal Chaos 导出为 PhysX 物理文件 - UE - 学习 | 个人博客 = 鑫酱 = 笔记本</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Unreal Chaos 导出为 PhysX 物理文件</h1><div class="meta"><span class="item" title="创建时间：2024-01-02 17:28:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-01-02T17:28:00+08:00">2024-01-02</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>19k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>17 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">个人博客</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (9).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (19).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (4).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper_6.jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (6).jpg"></li><li class="item" data-background-image="https://wallpaper-1255596461.cos.ap-nanjing.myqcloud.com/wallpaper (17).jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learning/" itemprop="item" rel="index" title="分类于 学习"><span itemprop="name">学习</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learning/unreal/" itemprop="item" rel="index" title="分类于 UE"><span itemprop="name">UE</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://hakuya.me/learning/unreal/Unreal%20Chaos%20%E5%AF%BC%E5%87%BA%E4%B8%BA%20PhysX%20%E7%89%A9%E7%90%86%E6%96%87%E4%BB%B6/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="鑫酱(●'◡'●)"><meta itemprop="description" content="笔记本, 整天摸鱼，却妄想拯救世界的技术宅"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="鑫酱"></span><div class="body md" itemprop="articleBody"><div class="note info"></div><h1 id="unreal-chaos-导出为-physx-物理文件"><a class="anchor" href="#unreal-chaos-导出为-physx-物理文件">#</a> Unreal Chaos 导出为 PhysX 物理文件</h1><h1 id="概述"><a class="anchor" href="#概述">#</a> 概述</h1><p>随着 Unreal 5.0 的发布，PhysX 库也从 Unreal 的源代码中被移除。Unreal 自此不再支持 PhysX 库，转而使用自研的 Chaos。随之而来的问题是：项目如果升级到 Unreal 5.0+ 版本，就必须放弃 PhysX 库，对于客户端来说影响比较有限，毕竟 Unreal 官方提供了全套的解决方案。但对于不使用 DS 的服务器来说，如果需要用到物理场景的数据，就变得棘手了起来。</p><p>常规管线中，客户端一般会通过 PhysX 库自带的序列化接口，把场景中 AActor 绑定的物理对象加入到导出容器内，经由 PhysX 库完成导出相关的复杂工序。好在 PhysX 库的集成非常方便，很多服务器也会采用相同版本的 PhysX 作为物理库来使用，通过 PhysX 库的反序列化接口，即可轻松实现物理资源的<strong>互通</strong>。</p><p>回到正题，当客户端不再使用 PhysX 的情况下，服务器如何获取物理资源成了问题。目前 Unreal 官方没有提供教程来对二者进行转换，同时也没提供集成 Chaos 库的解决方案。因此，才有了本文中提到的工具 ——Chaos 物理导出工具。</p><blockquote><p>本文所讨论的转换版本：Unreal5.2、PhysX 3.4</p></blockquote><h2 id="physx-序列化结构梳理"><a class="anchor" href="#physx-序列化结构梳理">#</a> PhysX 序列化结构梳理</h2><p>要实现从 Chaos 到 PhysX 的转换，就得了解 PhysX 序列化的结构。下面会对 PhysX 序列化操作做详细的介绍：</p><h3 id="physx-序列化流程"><a class="anchor" href="#physx-序列化流程">#</a> PhysX 序列化流程</h3><p>PhysX 基本导出逻辑如下：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>PxFoundation<span class="token operator">*</span> gFoundation <span class="token operator">=</span> <span class="token function">PxCreateFoundation</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>PxPhysics<span class="token operator">*</span> gPhysics <span class="token operator">=</span> <span class="token function">PxCreatePhysics</span><span class="token punctuation">(</span>PX_PHYSICS_VERSION<span class="token punctuation">,</span> <span class="token operator">*</span>gFoundation<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>PxSerializationRegistry<span class="token operator">*</span> sr <span class="token operator">=</span> <span class="token class-name">PxSerialization</span><span class="token operator">::</span><span class="token function">createSerializationRegistry</span><span class="token punctuation">(</span><span class="token operator">*</span>gPhysics<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>PxCollection oCollection <span class="token operator">=</span> <span class="token function">PxCreateCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 【step.1】添加各种要导出的对象</span></pre></td></tr><tr><td data-num="7"></td><td><pre>oCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>PxBase<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 【step.2】补全依赖</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token class-name">PxSerialization</span><span class="token operator">::</span><span class="token function">complete</span><span class="token punctuation">(</span>oCollection<span class="token punctuation">,</span> sr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// 【step.3】导出</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token class-name">PxSerialization</span><span class="token operator">::</span><span class="token function">serializeCollectionToBinary</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> oCollection<span class="token punctuation">,</span> <span class="token operator">*</span>sr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>业务层面需要收集应该导出的对象。通过 complete 函数完成对象依赖关系的补全。补全操作交由 PhysX 自动完成，下图是 PhysX 中常见的依赖链路，当导出 Actor 的时候，会连带导出 Shape 和 Material 来确保 Actor 数据的完整性。</p><p><img data-src="https://docs.nvidia.com/gameworks/content/gameworkslibrary/physx/guide/_images/Serialization_Complete.png" alt=""></p><blockquote><p>Figure 1: Left: Complete Collection, Right: Incomplete Collection</p></blockquote><p>正常情况下，导出的 Collection 必须是 Complete 的，但是也可以显示声明为 InComplete，此时就必须给出一个 ExternalCollection，来保证依赖对象可以在外部查找到，类似于 .so 形式的链接库。当一个对象被多个容器共用时，可以通过该方式减少导出次数。</p><h3 id="二进制文件结构"><a class="anchor" href="#二进制文件结构">#</a> 二进制文件结构</h3><p>Collection 在导出时，会按照固定的结构排列组织：</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/image-20231227143846566.png" alt="image-20231227143846566"></p><ul><li><strong>Header</strong>：头信息，包含 PhysX 版本平台信息等内容，用于反序列化校验。</li><li><strong>nbObjectsInCollection</strong>：Collection 内的对象数量。</li><li><strong>manifest nb</strong>：实际导出对象的数量。</li><li><strong>manifest data</strong>：导出对象的大小（偏移）+ 类型</li><li><strong>actor total offset</strong>：对象导出后占用的总空间大小，用于反序列化对象后，通过偏移查询 extra data，对应于 export data size。</li><li><strong>importReferences</strong> <strong>nb &amp;&amp; data</strong>：外部引用，表示该 Collection 引用了外部对象（ExternalCollection），记录引用关系，用于恢复对象的时候通过外部引用进行关系补全。</li><li><strong>exportReferences nb &amp;&amp; data</strong>：内部引用，导出内部对象的 ID 和对应的下标。提高内部引用恢复过程的寻址效率。</li><li><strong>internalPtr nb &amp;&amp; data</strong>：内部地址引用关系，把对象序列化前的地址数值作为唯一 ID 建立的引用映射。</li><li><strong>internalIdx nb &amp;&amp; data</strong>：内部编号引用关系，把对象序列化前持有的唯一编号作为 ID 建立的引用映射。</li><li><strong>export data &amp;&amp; export extra data</strong>：对象的实际数据，包含两个部分。<ul><li>export data 表示对象的基本信息，这部分数据大小是固定的。</li><li>extra data 追加信息。包含复杂几何的数据，这部分数据大小通常是可变的。</li></ul></li></ul><h2 id="chaos-对象到-physx"><a class="anchor" href="#chaos-对象到-physx">#</a> Chaos 对象到 PhysX</h2><p>接下来看看 Chaos 里面物理对象之间的关系图：</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/image-20231227153124586.png" alt="image-20231227153124586"></p><p>通过上述内容，简单整理出两者之间的对应关系：</p><table><thead><tr><th>类型</th><th>PhysX</th><th>Chaos</th></tr></thead><tbody><tr><td>Static Actor</td><td>NpRigidStatic</td><td>FGeometryParticle</td></tr><tr><td>Dynamic Actor</td><td>NpRigidDynamic</td><td>FPBDRigidParticle</td></tr><tr><td>Shape</td><td>NpShape</td><td>FPerShapeData</td></tr><tr><td>TriangleMesh</td><td>PxTriangleMeshGeometryLL</td><td>FTriangleMeshImplicitObject</td></tr><tr><td>HeightField</td><td>PxHeightFieldGeometryLL</td><td>FHeightField</td></tr><tr><td>ConvexMesh</td><td>PxConvexMeshGeometryLL</td><td>FConvex</td></tr><tr><td>Box</td><td>PxBoxGeometry</td><td>TBox</td></tr><tr><td>Capsule</td><td>PxCapsuleGeometry</td><td>FCapsule</td></tr><tr><td>Sphere</td><td>PxSphereGeometry</td><td>TSphere</td></tr><tr><td>Plane</td><td>PxPlaneGeometry</td><td>FImplicitPlane3</td></tr><tr><td>Material</td><td>NpMaterial</td><td>FChaosPhysicsMaterial</td></tr></tbody></table><p>由于 Chaos 的几何相对更加丰富，因此可以很好的兼容导出类型。但是两边的物理体系不同，PhysX 是基于牛二定律的计算，而 Chaos 是基于位置动力学的，因此某些对象上的属性映射依旧存在差异，下面会对这些属性逐个讲解：</p><h3 id="material"><a class="anchor" href="#material">#</a> Material</h3><table><thead><tr><th>属性</th><th>NpMaterial</th><th>FChaosPhysicsMaterial</th><th>默认值</th></tr></thead><tbody><tr><td>内存分配类型</td><td>mBaseFlags</td><td></td><td>PxBaseFlagType::eOWNS_MEMORY</td></tr><tr><td>对象类型</td><td>mConcreteType</td><td></td><td>PxConcreteType::eMATERIAL</td></tr><tr><td>mMaterial 属性</td><td>--------------------------</td><td>--------------------------</td><td>--------------------------</td></tr><tr><td>动摩擦</td><td>dynamicFriction</td><td>FChaosPhysicsMaterial.Friction</td><td></td></tr><tr><td>材质标记</td><td>flags</td><td><mark><strong>无对应（有损）</strong></mark></td><td>0</td></tr><tr><td>摩擦组合模式</td><td>fricRestCombineMode</td><td>FChaosPhysicsMaterial.FrictionCombineMode</td><td></td></tr><tr><td>材质编号</td><td>mMaterialIndex</td><td><mark>动态生成，需要导出逻辑内实现，保证 IDX 唯一且小于 Uint32 即可</mark></td><td></td></tr><tr><td>指向自身的指针，历史遗留无意义</td><td>mNxMaterial</td><td></td><td>nullptr</td></tr><tr><td>填充对齐，无意义</td><td>padding</td><td></td><td>0</td></tr><tr><td>恢复系数</td><td>restitution</td><td>FChaosPhysicsMaterial.Restitution</td><td></td></tr><tr><td>静摩擦</td><td>staticFriction</td><td>FChaosPhysicsMaterial.StaticFriction</td><td></td></tr></tbody></table><ul><li>MaterialIndex，这个编号在 Chaos 中是不存在的概念，因此导出的时候需要自己伪造一个，要求是 UInt32 范围且唯一可以标识某个 Material。</li><li>flags 这个标记位 Chaos 中不存在对应，但是 Chaos 提供了其他方案来替代，因此这里是有损转换的。</li></ul><h3 id="geometry"><a class="anchor" href="#geometry">#</a> Geometry</h3><h4 id="heightfield"><a class="anchor" href="#heightfield">#</a> HeightField</h4><table><thead><tr><th>属性</th><th>PxHeightFieldGeometryLL</th><th>FHeightField</th><th>默认值</th></tr></thead><tbody><tr><td>行缩放</td><td>rowScale</td><td>FHeightField.GetScale().X</td><td></td></tr><tr><td>高度场数据</td><td>heightField</td><td>FHeightField</td><td></td></tr><tr><td>运行时高度场数据</td><td>heightFieldData</td><td><mark>运行中填充，不需要导出</mark></td><td>nullptr</td></tr><tr><td>网格标记</td><td>heightFieldFlags</td><td><mark>Chaos 中默认全是双面检测</mark></td><td>PxMeshGeometryFlag::eDOUBLE_SIDED</td></tr><tr><td>高度缩放</td><td>heightScale</td><td>FHeightField.GetScale().Z</td><td></td></tr><tr><td>引用材质</td><td>materials</td><td>FHeightField.GetMaterials()</td><td></td></tr><tr><td>几何类型</td><td>mType</td><td></td><td>PxGeometryType::eHEIGHTFIELD</td></tr><tr><td>纯填充无意义</td><td>paddingFromFlags</td><td></td><td></td></tr><tr><td>列缩放</td><td>columnScale</td><td>FHeightField.GetScale().Y</td><td></td></tr></tbody></table><h4 id="convexmesh"><a class="anchor" href="#convexmesh">#</a> ConvexMesh</h4><table><thead><tr><th>属性</th><th>PxConvexMeshGeometryLL</th><th>FConvex</th><th>默认值</th></tr></thead><tbody><tr><td>凸包数据</td><td>convexMesh</td><td>FConvex</td><td></td></tr><tr><td>几何类型</td><td>mType</td><td></td><td>PxGeometryType::eCONVEXMESH</td></tr><tr><td>gpu 兼容选项</td><td>gpuCompatible</td><td><mark>运行中填充，不需要导出</mark></td><td>false</td></tr><tr><td>凸包运行时数据</td><td>hullData</td><td><mark>运行中填充，不需要导出</mark></td><td>nullptr</td></tr><tr><td>凸包网格标记</td><td>meshFlags</td><td><mark>Chaos 中默认全是紧凑模式</mark></td><td>PxConvexMeshGeometryFlag::eTIGHT_BOUNDS</td></tr><tr><td>纯填充无意义</td><td>paddingFromFlags</td><td></td><td></td></tr><tr><td>几何缩放</td><td>scale.scale</td><td>FConvex.GetScale()</td><td></td></tr><tr><td>几何旋转</td><td>scale.rotation</td><td><mark>Chaos 中几何不存在单独的旋转</mark></td><td>PxIdentity</td></tr></tbody></table><h4 id="trianglemesh"><a class="anchor" href="#trianglemesh">#</a> TriangleMesh</h4><table><thead><tr><th>属性</th><th>PxTriangleMeshGeometryLL</th><th>FTriangleMeshImplicitObject</th><th>默认值</th></tr></thead><tbody><tr><td>运行时材质编号引用</td><td>materialIndices</td><td><mark>运行中填充，不需要导出</mark></td><td>nullptr</td></tr><tr><td>引用材质</td><td>materials</td><td>FTriangleMeshImplicitObject.GetMaterials()</td><td></td></tr><tr><td>三角网格运行时数据</td><td>meshData</td><td><mark>运行中填充，不需要导出</mark></td><td>nullptr</td></tr><tr><td>网格标记</td><td>meshFlags</td><td><mark>Chaos 中默认全是双面检测</mark></td><td>PxMeshGeometryFlag::eDOUBLE_SIDED</td></tr><tr><td>几何类型</td><td>mType</td><td></td><td>PxGeometryType::eTRIANGLEMESH</td></tr><tr><td>纯填充无意义</td><td>paddingFromFlags</td><td></td><td></td></tr><tr><td>几何缩放</td><td>scale.scale</td><td>FTriangleMeshImplicitObject.GetScale()</td><td></td></tr><tr><td>几何旋转</td><td>scale.rotation</td><td><mark>Chaos 中几何不存在单独的旋转</mark></td><td>PxIdentity</td></tr><tr><td>三角网格数据</td><td>triangleMesh</td><td>FTriangleMeshImplicitObject</td><td></td></tr></tbody></table><p>其他简单几何就不做介绍了。值得一提的是，由于 PhysX 对于复杂几何的反序列化也涉及到运行时数据，实时数据中有很大一部分是临时计算并存储在内存的，因此实现上非常麻烦，导出的结构也很复杂，这里简单贴一个 Convex 运行时数据的序列化内容：</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/image-20231227172739798.png" alt="image-20231227172739798"></p><p>这些内容恢复起来非常麻烦，Chaos 中的 ConvexMesh 很难与之对应，下面是 ConvexMesh 存储的数据：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>TArray<span class="token operator">&lt;</span>FPlaneType<span class="token operator">></span> Planes<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>TArray<span class="token operator">&lt;</span>FVec3Type<span class="token operator">></span> Vertices<span class="token punctuation">;</span> <span class="token comment">//copy of the vertices that are just on the convex hull boundary</span></pre></td></tr><tr><td data-num="3"></td><td><pre>FAABB3Type LocalBoundingBox<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>FConvexStructureData StructureData<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>FRealType Volume<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>FVec3Type CenterOfMass<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>FVec3 UnitMassInertiaTensor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>FRotation3 RotationOfMass<span class="token punctuation">;</span></pre></td></tr></table></figure><p>因此这部分复杂几何的 ExtraData 后面会通过烘培方案进行恢复，这里暂时不做展开，后面再介绍。</p><h3 id="shape"><a class="anchor" href="#shape">#</a> Shape</h3><table><thead><tr><th>属性</th><th>NpShape</th><th>FPerShapeData</th><th>默认值</th></tr></thead><tbody><tr><td>基础属性</td><td>--------------------------</td><td>--------------------------</td><td>--------------------------</td></tr><tr><td>Actor 指针</td><td>mActor</td><td>FGeometryParticle<mark> 地址</mark></td><td></td></tr><tr><td>内存分配类型</td><td>mBaseFlags</td><td></td><td>PxBaseFlagType::eOWNS_MEMORY</td></tr><tr><td>对象类型</td><td>mConcreteType</td><td></td><td>PxConcreteType::eSHAPE</td></tr><tr><td>Shape 被引用数</td><td>mExclusiveAndActorCount</td><td><mark>Chaos 系统默认每个 Shape 都是被 Actor 独占的，引用计数为 EXCLUSIVE_MASK</mark></td><td>oShape.EXCLUSIVE_MASK</td></tr><tr><td>名称</td><td>mName</td><td><mark>默认不导出，因此这里也不赋值</mark></td><td>nullptr</td></tr><tr><td>用户数据</td><td>userData</td><td></td><td>nullptr</td></tr><tr><td>对象类型</td><td>mConcreteType</td><td><mark>Chaos 系统默认每个 Shape 都是被 Actor 独占的</mark></td><td>ScbType::Enum::eSHAPE_EXCLUSIVE</td></tr><tr><td>mShape 属性</td><td>--------------------------</td><td>--------------------------</td><td>--------------------------</td></tr><tr><td>导出 Stream 临时指针</td><td>mStreamPtr</td><td><mark>导出时临时赋值的变量，序列化不处理</mark></td><td>nullptr</td></tr><tr><td>所在场景</td><td>mScene</td><td><mark>反系列化后添加进入场景时赋值，序列化不处理</mark></td><td>nullptr</td></tr><tr><td>mShape.mShape 属性</td><td>--------------------------</td><td>--------------------------</td><td>--------------------------</td></tr><tr><td>场景查询时的过滤规则</td><td>mQueryFilterData</td><td>FPerShapeData.GetQueryData()</td><td></td></tr><tr><td>物理模拟时的过滤规则</td><td>mSimulationFilterData</td><td>FPerShapeData.GetSimData()</td><td></td></tr><tr><td>接触距离</td><td>mRestOffset</td><td><mark><strong>Chaos 中没有平替，暂时不设置初值，PX_MAX_F32 表示未初始化（有损）</strong></mark></td><td>PX_MAX_F32</td></tr><tr><td>oShape.mShape.mShape.mCore 属性</td><td>--------------------------</td><td>--------------------------</td><td>--------------------------</td></tr><tr><td>基于 Actor 的坐标位移</td><td>transform.p</td><td>FPerShapeData.GetLeafRelativeTransform().GetLocation()</td><td></td></tr><tr><td>基于 Actor 的坐标旋转</td><td>transform.q</td><td>FPerShapeData.GetLeafRelativeTransform().GetRotation()</td><td></td></tr><tr><td>接触偏移</td><td>contactOffset</td><td><mark><strong>Chaos 只能通过 Material 设置，Shape 没有（有损）</strong></mark></td><td>-1.0f</td></tr><tr><td>形状标志</td><td>mShapeFlags</td><td><mark><strong>Chaos 没有对应，暂时用默认值（有损）</strong></mark></td><td><code>PxShapeFlag::eSCENE_QUERY_SHAPE</code></td></tr><tr><td>材质编号</td><td>materialIndex</td><td>FPerShapeData.GetLeafGeometry().GetMaterials()</td><td></td></tr><tr><td>是否使用自身内存存储材质编号</td><td>mOwnsMaterialIdxMemory</td><td><mark>超过一个材质就需要 alloc 分配额外内存，否则用自己的内存</mark></td><td></td></tr><tr><td>几何数据</td><td>geometry</td><td>FPerShapeData.GetLeafGeometry()</td><td></td></tr></tbody></table><ul><li>mRestOffset &amp;&amp; contactOffset 在 Chaos 中统一采用 Material 的 SkinWidth 表示，但是也不能完美映射，因为 Shape 可能存在多个 Material，因此这里暂时不做转换。</li><li>mShapeFlags 的标记也没有 Chaos 的对应，虽然可以通过 Shape 本身的类型在做细分，但感觉用 PxShapeFlag::eSCENE_QUERY_SHAPE 已经够用了，服务器一般情况下不需要做 Simulate 模拟。Trigger 的话可以视情况加上。</li><li>FPerShapeData.GetLeafGeometry () 内部涉及到缩放和边距，需要进一步解析处理，并转换为 PhysX 的几何数据。</li></ul><h3 id="static-actor"><a class="anchor" href="#static-actor">#</a> Static Actor</h3><table><thead><tr><th>属性</th><th>NpRigidStatic</th><th>FGeometryParticle</th><th>默认值</th></tr></thead><tbody><tr><td>基础属性</td><td>-----------------------------------</td><td>--------------------------------------</td><td>--------------------------------------</td></tr><tr><td>内存分配类型</td><td>mBaseFlags</td><td></td><td>PxBaseFlagType::eOWNS_MEMORY</td></tr><tr><td>对象类型</td><td>mConcreteType</td><td></td><td>PxConcreteType::eRIGID_STATIC</td></tr><tr><td>连接器数组</td><td>mConnectorArray</td><td><mark>服务器暂时不需要这类约束关系，因此不导出</mark></td><td>nullptr</td></tr><tr><td>场景内的下标</td><td>mIndex</td><td><mark>反序列化加入场景后重新赋值，导出为默认值</mark></td><td>0xFFFFFFFF</td></tr><tr><td>名称</td><td>mName</td><td><mark>默认不导出，因此这里也不赋值</mark></td><td>nullptr</td></tr><tr><td>用户数据</td><td>userData</td><td></td><td>nullptr</td></tr><tr><td>mRigidStatic 属性</td><td>-----------------------------------</td><td>--------------------------------------</td><td>--------------------------------------</td></tr><tr><td>所在场景</td><td>mScene</td><td><mark>反系列化后添加进入场景时赋值，序列化不处理</mark></td><td>nullptr</td></tr><tr><td>物理对象类型</td><td>mControlState</td><td></td><td>ScbType::Enum::eRIGID_STATIC</td></tr><tr><td>导出 Stream 临时指针</td><td>mStreamPtr</td><td><mark>导出时临时赋值的变量，序列化不处理</mark></td><td>nullptr</td></tr><tr><td>mRigidStatic.mStatic 属性</td><td>-----------------------------------</td><td>--------------------------------------</td><td>--------------------------------------</td></tr><tr><td>Actor 标志</td><td>mActorFlags</td><td><mark>反序列化会重置，导出无意义</mark></td><td>0</td></tr><tr><td>Actor 类型</td><td>mActorType</td><td></td><td>PxActorType::eRIGID_STATIC</td></tr><tr><td>聚合 ID</td><td>mAggregateIDOwnerClient</td><td><mark><strong>服务器不处理聚合物导出（有损）</strong></mark></td><td>0</td></tr><tr><td>行为标记</td><td>mClientBehaviorFlags</td><td><mark>PhysX3.4 已弃用，导出无意义</mark></td><td>0</td></tr><tr><td>优势组</td><td>mDominanceGroup</td><td><mark><strong>Chaos 无对应（有损）</strong></mark></td><td>0</td></tr><tr><td>模拟对象指针</td><td>mSim</td><td><mark>运行时计算，不用导出</mark></td><td>nullptr</td></tr><tr><td>mRigidStatic.mStatic.mCore 属性</td><td>-----------------------------------</td><td>--------------------------------------</td><td>--------------------------------------</td></tr><tr><td>世界坐标位置</td><td>body2World.p</td><td>FGeometryParticle.X()</td><td></td></tr><tr><td>世界坐标旋转</td><td>body2World.q</td><td>FGeometryParticle.R()</td><td></td></tr><tr><td>标记</td><td>mFlags</td><td><mark><strong>Chaos 和 PhysX 用的不同系统，这块没法转换，但服务器一般也不怎么跑 Simulate，影响不大（有损）</strong></mark></td><td>0</td></tr><tr><td>Body2Actor 变换矩阵是否为单位矩阵</td><td>mIdtBody2Actor</td><td><mark>Static 这个属性没意义，不会用上</mark></td><td>true</td></tr><tr><td>求解器迭代次数</td><td>solverIterationCounts</td><td><mark><strong>Chaos 中只有全局次数，这里暂时用 PhysX 的默认次数（有损）</strong></mark></td><td>4</td></tr><tr><td>mShapeManager 属性</td><td>-----------------------------------</td><td>--------------------------------------</td><td>--------------------------------------</td></tr><tr><td>修剪结构</td><td>mPruningStructure</td><td><mark>运行时计算修剪结构，不导出</mark></td><td>nullptr</td></tr><tr><td>场景查询数据</td><td>mSceneQueryData</td><td><mark>反序列化会重置，导出无意义</mark></td><td>0xffffffff</td></tr><tr><td>Shape 数据</td><td>mShapes</td><td>FGeometryParticle.ShapesArray()<mark> 地址</mark></td><td></td></tr></tbody></table><ul><li>mAggregateIDOwnerClient：一般是类似布娃娃之类的骨骼内才有，服务器导出的话基本不用。</li><li>mDominanceGroup：PhysX 内的独有概念，Chaos 中没有对应。</li><li>mFlags：PhysX 和 Chaos 用的不同物理体系，这些标记基本上对不上。</li><li>solverIterationCounts：PhysX 可以单独控制 Actor 而 Chaos 只有全局的，这里暂时用了 PhysX 的默认迭代次数。</li></ul><h3 id="dynamic-actor"><a class="anchor" href="#dynamic-actor">#</a> Dynamic Actor</h3><table><thead><tr><th>属性</th><th>NpRigidDynamic</th><th>FPBDRigidParticle</th><th>默认值</th></tr></thead><tbody><tr><td>基础属性</td><td>-----------------------------------</td><td>--------------------------------------</td><td>--------------------------------------</td></tr><tr><td>内存分配类型</td><td>mBaseFlags</td><td></td><td>PxBaseFlagType::eOWNS_MEMORY</td></tr><tr><td>对象类型</td><td>mConcreteType</td><td></td><td>PxConcreteType::eRIGID_DYNAMIC</td></tr><tr><td>连接器数组</td><td>mConnectorArray</td><td><mark>服务器暂时不需要这类约束关系，因此不导出</mark></td><td>nullptr</td></tr><tr><td>场景内的下标</td><td>mIndex</td><td><mark>反序列化加入场景后重新赋值，导出为默认值</mark></td><td>0xFFFFFFFF</td></tr><tr><td>名称</td><td>mName</td><td><mark>默认不导出，因此这里也不赋值</mark></td><td>nullptr</td></tr><tr><td>用户数据</td><td>userData</td><td></td><td>nullptr</td></tr><tr><td>mBody 属性</td><td>-----------------------------------</td><td>--------------------------------------</td><td>--------------------------------------</td></tr><tr><td>运行时标记</td><td>mBodyBufferFlags</td><td><mark>反序列化会重置，导出无意义</mark></td><td>0</td></tr><tr><td>运行时角速度</td><td>mBufferedAngVelocity</td><td>FPBDRigidParticle.W()</td><td></td></tr><tr><td>运行时世界坐标位置</td><td>mBufferedBody2World.p</td><td>FPBDRigidParticle.X()</td><td></td></tr><tr><td>运行时世界坐标旋转</td><td>mBufferedBody2World.q</td><td>FPBDRigidParticle.R()</td><td></td></tr><tr><td>运行时睡眠状态</td><td>mBufferedIsSleeping</td><td><mark>反序列化会重置，导出无意义</mark></td><td>1</td></tr><tr><td>运行时线性速度</td><td>mBufferedLinVelocity</td><td>FPBDRigidParticle.V()</td><td></td></tr><tr><td>运行时唤醒计数</td><td>mBufferedWakeCounter</td><td><mark>运行时数据，导出无意义</mark></td><td>0.0f</td></tr><tr><td>所在场景</td><td>mScene</td><td><mark>反系列化后添加进入场景时赋值，序列化不处理</mark></td><td>nullptr</td></tr><tr><td>物理对象类型</td><td>mControlState</td><td></td><td>ScbType::Enum::eBODY</td></tr><tr><td>导出 Stream 临时指针</td><td>mStreamPtr</td><td><mark>导出时临时赋值的变量，序列化不处理</mark></td><td>nullptr</td></tr><tr><td>mBody.mBodyCore 属性</td><td>-----------------------------------</td><td>--------------------------------------</td><td>--------------------------------------</td></tr><tr><td>Actor 标志</td><td>mActorFlags</td><td><mark>根据 Chaos 的标记做转换（有损）</mark></td><td>PxActorFlag::eVISUALIZATION</td></tr><tr><td>Actor 类型</td><td>mActorType</td><td></td><td>PxActorType::eRIGID_DYNAMIC</td></tr><tr><td>聚合 ID</td><td>mAggregateIDOwnerClient</td><td><mark><strong>服务器不处理聚合物导出（有损）</strong></mark></td><td>0</td></tr><tr><td>行为标记</td><td>mClientBehaviorFlags</td><td><mark>PhysX3.4 已弃用，导出无意义</mark></td><td>0</td></tr><tr><td>优势组</td><td>mDominanceGroup</td><td><mark><strong>Chaos 无对应（有损）</strong></mark></td><td>0</td></tr><tr><td>模拟对象指针</td><td>mSim</td><td><mark>运行时计算，不用导出</mark></td><td>nullptr</td></tr><tr><td>模拟对象数据</td><td>mSimStateData</td><td><mark>运行时计算，不用导出</mark></td><td>nullptr</td></tr><tr><td>oDynamic.mBody.mBodyCore.mCore 属性</td><td>-----------------------------------</td><td>--------------------------------------</td><td>--------------------------------------</td></tr><tr><td>角阻尼</td><td>angularDamping</td><td>UPrimitiveComponent.GetAngularDamping()</td><td></td></tr><tr><td>角速度</td><td>angularVelocity</td><td>FPBDRigidParticle.W()</td><td></td></tr><tr><td>body2Actor 位置</td><td>body2Actor.p</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>PxVec3::ZeroVector</td></tr><tr><td>body2Actor 旋转</td><td>body2Actor.q</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>PxIdentity</td></tr><tr><td>世界坐标位置</td><td>body2World.p</td><td>FPBDRigidParticle.X()</td><td></td></tr><tr><td>世界坐标旋转</td><td>body2World.q</td><td>FPBDRigidParticle.R()</td><td></td></tr><tr><td>CCD 推进系数</td><td>ccdAdvanceCoefficient</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>0.15f</td></tr><tr><td>接触报告阈值</td><td>contactReportThreshold</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>PX_MAX_F32</td></tr><tr><td>冻结阈值</td><td>freezeThreshold</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>0</td></tr><tr><td>惯性张量的逆</td><td>inverseInertia</td><td>FPBDRigidParticle.InvI()</td><td></td></tr><tr><td>质量的逆</td><td>inverseMass</td><td>FPBDRigidParticle.InvM()</td><td></td></tr><tr><td>快速移动</td><td>isFastMoving</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>false</td></tr><tr><td>线性阻尼</td><td>linearDamping</td><td>UPrimitiveComponent.GetLinearDamping()</td><td></td></tr><tr><td>线性速度</td><td>linearVelocity</td><td>FPBDRigidParticle.V()</td><td></td></tr><tr><td>锁定标记</td><td>lockFlags</td><td>FConstraintInstance</td><td></td></tr><tr><td>最大角速度平方</td><td>maxAngularVelocitySq</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>49.0f</td></tr><tr><td>最大接触冲量</td><td>maxContactImpulse</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>PX_MAX_F32</td></tr><tr><td>最大线速度平方</td><td>maxLinearVelocitySq</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>PX_MAX_F32</td></tr><tr><td>最大穿透偏置</td><td>maxPenBias</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>-PX_MAX_F32</td></tr><tr><td>标记</td><td>mFlags</td><td><mark><strong>Chaos 和 PhysX 用的不同系统，这块没法转换，但服务器一般也不怎么跑 Simulate，影响不大（有损）</strong></mark></td><td><code>PxRigidBodyFlag::Enum::eKINEMATIC | PxRigidBodyFlag::Enum::eUSE_KINEMATIC_TARGET_FOR_SCENE_QUERIES</code></td></tr><tr><td>Body2Actor 变换矩阵是否为单位矩阵</td><td>mIdtBody2Actor</td><td><mark><strong>Chaos 没有这个字段默认为单位矩阵，（有损）</strong></mark></td><td>true</td></tr><tr><td>刚体交互次数</td><td>numBodyInteractions</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>0</td></tr><tr><td>计数交互次数</td><td>numCountedInteractions</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>0</td></tr><tr><td>睡眠阈值</td><td>sleepThreshold</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>0.005f</td></tr><tr><td>求解器迭代次数</td><td>solverIterationCounts</td><td><mark><strong>Chaos 中只有全局次数，这里暂时用 PhysX 的默认次数（有损）</strong></mark></td><td><code>(1 &amp; 0xff) &lt;&lt; 8 | (4 &amp; 0xff)</code></td></tr><tr><td>求解器唤醒计数器</td><td>solverWakeCounter</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>0.4f</td></tr><tr><td>唤醒计数器</td><td>wakeCounter</td><td><mark><strong>Chaos 没有对应（有损）</strong></mark></td><td>0.4f</td></tr><tr><td>mShapeManager 属性</td><td>-----------------------------------</td><td>--------------------------------------</td><td>--------------------------------------</td></tr><tr><td>修剪结构</td><td>mPruningStructure</td><td><mark>运行时计算修剪结构，不导出</mark></td><td>nullptr</td></tr><tr><td>场景查询数据</td><td>mSceneQueryData</td><td><mark>反序列化会重置，导出无意义</mark></td><td>0xffffffff</td></tr><tr><td>Shape 数据</td><td>mShapes</td><td>FGeometryParticle.ShapesArray()<mark> 地址</mark></td><td></td></tr></tbody></table><p>Dynamic Actor 相对来说，缺失的属性就比较多了，出去 Static Actor 的那些，还有很多模拟相关的属性：</p><ul><li>body2Actor：Chaos 中没有从 body 到 actor 的变换。</li><li>ccdAdvanceCoefficient、contactReportThreshold、freezeThreshold、isFastMoving、maxAngularVelocitySq、maxContactImpulse、maxLinearVelocitySq、maxPenBias、numBodyInteractions、numCountedInteractions、sleepThreshold、solverIterationCounts、solverWakeCounter、wakeCounter：都没对应，全部设置为未初始化或者默认值，这些属性大部分应用在 simulate，目前服务器实际运行 simulate 的对象很少，所以影响不大。</li></ul><h2 id="特殊规则处理"><a class="anchor" href="#特殊规则处理">#</a> 特殊规则处理</h2><p>除去上述的导出对应关系以外，还涉及到很多导出时的特殊规则和转换问题，下面一一列举：</p><h3 id="几何数据烘培"><a class="anchor" href="#几何数据烘培">#</a> 几何数据烘培</h3><p>由于复杂几何的数据存储在 ExportExtraData 中，大小和内容都是不固定的，且要在 Chaos 内提取对应的物理结构和数据十分困难。因为有些数据是运行时的，需要通过特定的计算得到，如果要实现 100% 的兼容，就必须参考 PhysX 的计算逻辑对 Chaos 的数据做类似的计算，你可能会问难道两个引擎运行时数据不一样吗。是的，这块数据真的相差甚远，因此采用了一个折中的方案：导出 Chaos 中几何的基础数据，再通过 PhysX 读取并计算出运行时数据。但会引入其他影响：</p><ul><li>计算运行时数据放在了反序列化过程中，会有一定的耗时（这部分耗时原本从<strong>序列化</strong>转移到<strong>加载中</strong>）。</li><li>精度丢失问题，临时计算出的运行时数据会有一定程度上的精度缺失，但目前看影响不是很大。</li></ul><h4 id="heightfield-2"><a class="anchor" href="#heightfield-2">#</a> HeightField</h4><p>根据行列导出每个坐标的高度和材质。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>PxHeightFieldDesc heightFieldDesc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>heightFieldDesc<span class="token punctuation">.</span>nbRows <span class="token operator">=</span> iNumRows<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>heightFieldDesc<span class="token punctuation">.</span>nbColumns <span class="token operator">=</span> iNumCols<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>heightFieldDesc<span class="token punctuation">.</span>format <span class="token operator">=</span> PxHeightFieldFormat<span class="token operator">::</span>Enum<span class="token operator">::</span>eS16_TM<span class="token punctuation">;</span> <span class="token comment">// 假设 Chaos 高度值是 32 位浮点数</span></pre></td></tr><tr><td data-num="5"></td><td><pre>heightFieldDesc<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>data <span class="token operator">=</span> address<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>heightFieldDesc<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>stride <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxHeightFieldSample<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>address <span class="token operator">+=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxHeightFieldSample<span class="token punctuation">)</span> <span class="token operator">*</span> iNumRows <span class="token operator">*</span> iNumCols<span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="convexmesh-2"><a class="anchor" href="#convexmesh-2">#</a> ConvexMesh</h4><p>按照顶点顺序导出所有三角形的顶点坐标即可。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>PxConvexMeshDesc convexDesc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>convexDesc<span class="token punctuation">.</span>points<span class="token punctuation">.</span>count <span class="token operator">=</span> iVerticesNum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>convexDesc<span class="token punctuation">.</span>points<span class="token punctuation">.</span>stride <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxVec3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>convexDesc<span class="token punctuation">.</span>points<span class="token punctuation">.</span>data <span class="token operator">=</span> address<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>convexDesc<span class="token punctuation">.</span>flags <span class="token operator">=</span> PxConvexFlag<span class="token operator">::</span>eCOMPUTE_CONVEX<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>address <span class="token operator">+=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxVec3<span class="token punctuation">)</span> <span class="token operator">*</span> iVerticesNum<span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="trianglemesh-2"><a class="anchor" href="#trianglemesh-2">#</a> TriangleMesh</h4><p>TriangleMesh 根据顶点数量分为两种结构，顶点数量过多的情况下，记录时会用 PxI32 否则用 PxU16，主要数据是顶点数据和顶点顺序，不同于凸包，三角网格的大部分顶点都可以复用，因此需要额外的索引来记录三角形组成。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>PxTriangleMeshDesc triangleDesc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>triangleDesc<span class="token punctuation">.</span>points<span class="token punctuation">.</span>count <span class="token operator">=</span> iVerticesNum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>triangleDesc<span class="token punctuation">.</span>points<span class="token punctuation">.</span>stride <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxVec3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>triangleDesc<span class="token punctuation">.</span>points<span class="token punctuation">.</span>data <span class="token operator">=</span> address<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>address <span class="token operator">+=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxVec3<span class="token punctuation">)</span> <span class="token operator">*</span> iVerticesNum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">bool</span> bLarge <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">reinterpret_cast</span><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>address <span class="token operator">+=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>bLarge<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">const</span> PxU32 iIndexNum <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">reinterpret_cast</span><span class="token operator">&lt;</span>PxU32<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    address <span class="token operator">+=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxU32<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    triangleDesc<span class="token punctuation">.</span>triangles<span class="token punctuation">.</span>count <span class="token operator">=</span> iIndexNum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    triangleDesc<span class="token punctuation">.</span>triangles<span class="token punctuation">.</span>stride <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxI32<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    triangleDesc<span class="token punctuation">.</span>triangles<span class="token punctuation">.</span>data <span class="token operator">=</span> address<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    address <span class="token operator">+=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxI32<span class="token punctuation">)</span> <span class="token operator">*</span> iIndexNum <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">else</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">const</span> PxU32 iIndexNum <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">reinterpret_cast</span><span class="token operator">&lt;</span>PxU32<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    address <span class="token operator">+=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxU32<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    triangleDesc<span class="token punctuation">.</span>triangles<span class="token punctuation">.</span>count <span class="token operator">=</span> iIndexNum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    triangleDesc<span class="token punctuation">.</span>triangles<span class="token punctuation">.</span>stride <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxU16<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    triangleDesc<span class="token punctuation">.</span>triangles<span class="token punctuation">.</span>data <span class="token operator">=</span> address<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    address <span class="token operator">+=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxU16<span class="token punctuation">)</span> <span class="token operator">*</span> iIndexNum <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    triangleDesc<span class="token punctuation">.</span>flags <span class="token operator">|=</span> PxMeshFlag<span class="token operator">::</span>e16_BIT_INDICES<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="heightfield-坐标转换"><a class="anchor" href="#heightfield-坐标转换">#</a> HeightField 坐标转换</h3><p>高度场在 PhysX 和 Chaos 的坐标排列和坐标原点不同，因此需要做额外的转换</p><ul><li>简单来说就是做一次平移，做一次旋转，再做一次反向，实现上参考了 Unreal 里的代码，会考虑 Scale 为负的情况下如何变换：<ul><li>平移：因为两边的 Shape 局部坐标原点不一致。</li><li>旋转：因为两边的坐标轴不一样，Unreal 是在 xy-plane 绘制，PhysX 是在 xz-plane 绘制，这里顺带也需要做 Scale 的旋转。</li><li>反向：因为两边的绘制顺序不一致。</li></ul></li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// =========== shape 层面 变换（平移） ===========</span></pre></td></tr><tr><td data-num="2"></td><td><pre>FTransform LandscapeComponentTransform <span class="token operator">=</span> pLandspaceCmp<span class="token operator">-></span><span class="token function">GetComponentToWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>FMatrix LandscapeComponentMatrix <span class="token operator">=</span> LandscapeComponentTransform<span class="token punctuation">.</span><span class="token function">ToMatrixWithScale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>FVector Scale <span class="token operator">=</span> LandscapeComponentMatrix<span class="token punctuation">.</span><span class="token function">ExtractScaling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>FTransform LandscapeTM <span class="token operator">=</span> FTransform<span class="token operator">::</span>Identity<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// 镜像 —— 平移</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">bool</span> bIsMirrored <span class="token operator">=</span> LandscapeComponentMatrix<span class="token punctuation">.</span><span class="token function">Determinant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.f</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bIsMirrored<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    LandscapeTM<span class="token punctuation">.</span><span class="token function">SetTranslation</span><span class="token punctuation">(</span><span class="token function">FVector</span><span class="token punctuation">(</span><span class="token operator">-</span>pLandspaceCmp<span class="token operator">-></span>CollisionSizeQuads <span class="token operator">*</span> pLandspaceCmp<span class="token operator">-></span>CollisionScale <span class="token operator">*</span> Scale<span class="token punctuation">.</span>X<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>oShape<span class="token punctuation">.</span>mShape<span class="token punctuation">.</span>mShape<span class="token punctuation">.</span>mCore<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>q<span class="token punctuation">.</span>w <span class="token operator">=</span> LandscapeTM<span class="token punctuation">.</span><span class="token function">GetRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>W<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>oShape<span class="token punctuation">.</span>mShape<span class="token punctuation">.</span>mShape<span class="token punctuation">.</span>mCore<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>q<span class="token punctuation">.</span>x <span class="token operator">=</span> LandscapeTM<span class="token punctuation">.</span><span class="token function">GetRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>X<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>oShape<span class="token punctuation">.</span>mShape<span class="token punctuation">.</span>mShape<span class="token punctuation">.</span>mCore<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>q<span class="token punctuation">.</span>y <span class="token operator">=</span> LandscapeTM<span class="token punctuation">.</span><span class="token function">GetRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>oShape<span class="token punctuation">.</span>mShape<span class="token punctuation">.</span>mShape<span class="token punctuation">.</span>mCore<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>q<span class="token punctuation">.</span>z <span class="token operator">=</span> LandscapeTM<span class="token punctuation">.</span><span class="token function">GetRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Z<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>oShape<span class="token punctuation">.</span>mShape<span class="token punctuation">.</span>mShape<span class="token punctuation">.</span>mCore<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>p <span class="token operator">=</span> LandscapeTM<span class="token punctuation">.</span><span class="token function">GetLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">//scale 实际上也做了旋转</span></pre></td></tr><tr><td data-num="20"></td><td><pre>FVector <span class="token function">FinalScale</span><span class="token punctuation">(</span>Scale<span class="token punctuation">.</span>X <span class="token operator">*</span> pLandspaceCmp<span class="token operator">-></span>CollisionScale<span class="token punctuation">,</span> Scale<span class="token punctuation">.</span>Y<span class="token operator">*</span> pLandspaceCmp<span class="token operator">-></span>CollisionScale<span class="token punctuation">,</span> Scale<span class="token punctuation">.</span>Z<span class="token operator">*</span> LANDSCAPE_ZSCALE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>oHeightField<span class="token punctuation">.</span>rowScale <span class="token operator">=</span> FinalScale<span class="token punctuation">.</span>X<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>oHeightField<span class="token punctuation">.</span>columnScale <span class="token operator">=</span> FinalScale<span class="token punctuation">.</span>Y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>oHeightField<span class="token punctuation">.</span>heightScale <span class="token operator">=</span> FinalScale<span class="token punctuation">.</span>Z<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">// =========== actor 层面 变换（旋转） ===========</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">// 坐标轴变换 —— 旋转</span></pre></td></tr><tr><td data-num="27"></td><td><pre>FTransform LandscapeComponentTransform <span class="token operator">=</span> pLandspaceCmp<span class="token operator">-></span><span class="token function">GetComponentToWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>FMatrix LandscapeComponentMatrix <span class="token operator">=</span> LandscapeComponentTransform<span class="token punctuation">.</span><span class="token function">ToMatrixWithScale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment">// Reorder the axes</span></pre></td></tr><tr><td data-num="31"></td><td><pre>FVector TerrainX <span class="token operator">=</span> LandscapeComponentMatrix<span class="token punctuation">.</span><span class="token function">GetScaledAxis</span><span class="token punctuation">(</span>EAxis<span class="token operator">::</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>FVector TerrainY <span class="token operator">=</span> LandscapeComponentMatrix<span class="token punctuation">.</span><span class="token function">GetScaledAxis</span><span class="token punctuation">(</span>EAxis<span class="token operator">::</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>FVector TerrainZ <span class="token operator">=</span> LandscapeComponentMatrix<span class="token punctuation">.</span><span class="token function">GetScaledAxis</span><span class="token punctuation">(</span>EAxis<span class="token operator">::</span>Z<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>LandscapeComponentMatrix<span class="token punctuation">.</span><span class="token function">SetAxis</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> TerrainX<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>LandscapeComponentMatrix<span class="token punctuation">.</span><span class="token function">SetAxis</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> TerrainY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>LandscapeComponentMatrix<span class="token punctuation">.</span><span class="token function">SetAxis</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> TerrainZ<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment">// 计算位移矩阵</span></pre></td></tr><tr><td data-num="39"></td><td><pre>FTransform LandscapeComponentTransformEd <span class="token operator">=</span> <span class="token function">FTransform</span><span class="token punctuation">(</span>LandscapeComponentMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>oStatic<span class="token punctuation">.</span>mRigidStatic<span class="token punctuation">.</span>mStatic<span class="token punctuation">.</span>mCore<span class="token punctuation">.</span>body2World<span class="token punctuation">.</span>q<span class="token punctuation">.</span>w <span class="token operator">=</span> LandscapeComponentTransformEd<span class="token punctuation">.</span><span class="token function">GetRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>W<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>oStatic<span class="token punctuation">.</span>mRigidStatic<span class="token punctuation">.</span>mStatic<span class="token punctuation">.</span>mCore<span class="token punctuation">.</span>body2World<span class="token punctuation">.</span>q<span class="token punctuation">.</span>x <span class="token operator">=</span> LandscapeComponentTransformEd<span class="token punctuation">.</span><span class="token function">GetRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>X<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>oStatic<span class="token punctuation">.</span>mRigidStatic<span class="token punctuation">.</span>mStatic<span class="token punctuation">.</span>mCore<span class="token punctuation">.</span>body2World<span class="token punctuation">.</span>q<span class="token punctuation">.</span>y <span class="token operator">=</span> LandscapeComponentTransformEd<span class="token punctuation">.</span><span class="token function">GetRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>oStatic<span class="token punctuation">.</span>mRigidStatic<span class="token punctuation">.</span>mStatic<span class="token punctuation">.</span>mCore<span class="token punctuation">.</span>body2World<span class="token punctuation">.</span>q<span class="token punctuation">.</span>z <span class="token operator">=</span> LandscapeComponentTransformEd<span class="token punctuation">.</span><span class="token function">GetRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Z<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>oStatic<span class="token punctuation">.</span>mRigidStatic<span class="token punctuation">.</span>mStatic<span class="token punctuation">.</span>mCore<span class="token punctuation">.</span>body2World<span class="token punctuation">.</span>p <span class="token operator">=</span> LandscapeComponentTransformEd<span class="token punctuation">.</span><span class="token function">GetLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token comment">// =========== 绘制 HeightField（反向） ===========</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">FHeightFieldAccessor</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token function">FHeightFieldAccessor</span><span class="token punctuation">(</span><span class="token keyword">const</span> ULandscapeHeightfieldCollisionComponent<span class="token operator">::</span>FHeightfieldGeometryRef<span class="token operator">&amp;</span> InGeometryRef<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token operator">:</span> <span class="token function">GeometryRef</span><span class="token punctuation">(</span>InGeometryRef<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>            <span class="token punctuation">,</span> <span class="token function">NumX</span><span class="token punctuation">(</span>InGeometryRef<span class="token punctuation">.</span>Heightfield<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> InGeometryRef<span class="token punctuation">.</span>Heightfield<span class="token operator">-></span><span class="token function">GetNumCols</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token punctuation">,</span> <span class="token function">NumY</span><span class="token punctuation">(</span>InGeometryRef<span class="token punctuation">.</span>Heightfield<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> InGeometryRef<span class="token punctuation">.</span>Heightfield<span class="token operator">-></span><span class="token function">GetNumRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token keyword">float</span> <span class="token function">GetUnscaledHeight</span><span class="token punctuation">(</span>int32 X<span class="token punctuation">,</span> int32 Y<span class="token punctuation">)</span> <span class="token keyword">const</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>        <span class="token keyword">return</span> GeometryRef<span class="token punctuation">.</span>Heightfield<span class="token operator">-></span><span class="token function">GetHeight</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>    uint8 <span class="token function">GetMaterialIndex</span><span class="token punctuation">(</span>int32 X<span class="token punctuation">,</span> int32 Y<span class="token punctuation">)</span> <span class="token keyword">const</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token keyword">return</span> GeometryRef<span class="token punctuation">.</span>Heightfield<span class="token operator">-></span><span class="token function">GetMaterialIndex</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token keyword">const</span> ULandscapeHeightfieldCollisionComponent<span class="token operator">::</span>FHeightfieldGeometryRef<span class="token operator">&amp;</span> GeometryRef<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    int32 NumY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>    int32 NumX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>FHeightFieldAccessor <span class="token function">Accessor</span><span class="token punctuation">(</span><span class="token operator">*</span>pLandspaceCmp<span class="token operator">-></span>HeightfieldRef<span class="token punctuation">.</span><span class="token function">GetReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token keyword">int</span> RowMax <span class="token operator">=</span> Accessor<span class="token punctuation">.</span>NumX<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token keyword">int</span> ColMax <span class="token operator">=</span> Accessor<span class="token punctuation">.</span>NumY<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">bool</span> bIsMirrored <span class="token operator">=</span> pLandspaceCmp<span class="token operator">-></span><span class="token function">GetComponentToWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetDeterminant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.f</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>bIsMirrored<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>    ColMax <span class="token operator">=</span> Accessor<span class="token punctuation">.</span>NumX<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    RowMax <span class="token operator">=</span> Accessor<span class="token punctuation">.</span>NumY<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>oOutArc<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>RowMax<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxU32<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// x</span></pre></td></tr><tr><td data-num="81"></td><td><pre>oOutArc<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ColMax<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxU32<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// z</span></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span>int32 x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> ColMax<span class="token punctuation">;</span> <span class="token operator">++</span>x<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span>int32 y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> ColMax<span class="token punctuation">;</span> <span class="token operator">++</span>y<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="85"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>        PxHeightFieldSample oSimple<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>bIsMirrored<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="88"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>            <span class="token keyword">const</span> <span class="token keyword">float</span> CurrHeight <span class="token operator">=</span> Accessor<span class="token punctuation">.</span><span class="token function">GetUnscaledHeight</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>            <span class="token keyword">const</span> uint8 MaterialIdx <span class="token operator">=</span> Accessor<span class="token punctuation">.</span><span class="token function">GetMaterialIndex</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>            oSimple<span class="token punctuation">.</span>height <span class="token operator">=</span> CurrHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>            oSimple<span class="token punctuation">.</span>materialIndex0<span class="token punctuation">.</span>mData <span class="token operator">=</span> MaterialIdx<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>            oSimple<span class="token punctuation">.</span>materialIndex1<span class="token punctuation">.</span>mData <span class="token operator">=</span> MaterialIdx<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>        <span class="token keyword">else</span></pre></td></tr><tr><td data-num="96"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>            <span class="token keyword">const</span> <span class="token keyword">float</span> CurrHeight <span class="token operator">=</span> Accessor<span class="token punctuation">.</span><span class="token function">GetUnscaledHeight</span><span class="token punctuation">(</span>ColMax <span class="token operator">-</span> x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>            <span class="token keyword">const</span> uint8 MaterialIdx <span class="token operator">=</span> Accessor<span class="token punctuation">.</span><span class="token function">GetMaterialIndex</span><span class="token punctuation">(</span>ColMax <span class="token operator">-</span> x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>            oSimple<span class="token punctuation">.</span>height <span class="token operator">=</span> CurrHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="100"></td><td><pre>            oSimple<span class="token punctuation">.</span>materialIndex0<span class="token punctuation">.</span>mData <span class="token operator">=</span> MaterialIdx<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>            oSimple<span class="token punctuation">.</span>materialIndex1<span class="token punctuation">.</span>mData <span class="token operator">=</span> MaterialIdx<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>        oOutArc<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>oSimple<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PxHeightFieldSample<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="105"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="地址对齐和虚函数表问题"><a class="anchor" href="#地址对齐和虚函数表问题">#</a> 地址对齐和虚函数表问题</h3><p>PhysX 的导出比较粗暴，通过对对象整个序列化的方式直接导出。因此需要严格遵守对象声明中的地址排布，不然恢复过程中就很容易出现差错：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 序列化</span></pre></td></tr><tr><td data-num="2"></td><td><pre>s<span class="token punctuation">.</span><span class="token function">writeData</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>obj<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 反序列化</span></pre></td></tr><tr><td data-num="5"></td><td><pre>T<span class="token operator">*</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>address<span class="token punctuation">)</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>因此，如果需要伪造正确的导出结果，类型大小和数据排列就很重要，会影响最终的反序列化：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">sizeof</span><span class="token punctuation">(</span>NpShape<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">272</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">sizeof</span><span class="token punctuation">(</span>NpRigidStatic<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">176</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">sizeof</span><span class="token punctuation">(</span>NpRigidDynamic<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">384</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">sizeof</span><span class="token punctuation">(</span>NpMaterial<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">80</span></pre></td></tr></table></figure><p>可以参考 PhysX 简单移植一下各个类的属性定义，函数的话只需要移植一个虚函数保证结构匹配即可。</p><h4 id="地址对齐"><a class="anchor" href="#地址对齐">#</a> 地址对齐</h4><p>这里的对齐分为两种：</p><ul><li>第一种是每类数据之间的 16 字节对齐</li><li>第二种是 header 的起始地址必须是 128 字节对齐。</li></ul><h3 id="烘培数据导出"><a class="anchor" href="#烘培数据导出">#</a> 烘培数据导出</h3><p>由于烘培数据不属于 PhysX 序列化的一部分，但又不希望把反序列化流程复杂化，因此这部分内容暂时插入在序列化文件的头部。由于 geometry 的数据并不依赖任何内容，因此可以单独在业务层解析。</p><p><img data-src="https://blog-1255596461.cos.ap-guangzhou.myqcloud.com/blog_pic/image-20240102171933718.png" alt="image-20240102171933718"></p><div class="tags"><a href="/tags/UE5/" rel="tag"><i class="ic i-tag"></i> UE5</a> <a href="/tags/Chaos/" rel="tag"><i class="ic i-tag"></i> Chaos</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-01-09 17:21:22" itemprop="dateModified" datetime="2024-01-09T17:21:22+08:00">2024-01-09</time> </span><span id="learning/unreal/Unreal Chaos 导出为 PhysX 物理文件/" class="item leancloud_visitors" data-flag-title="Unreal Chaos 导出为 PhysX 物理文件" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 充电</button><p>请我[恰饭]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="鑫酱(●'◡'●) 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="鑫酱(●'◡'●) 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>鑫酱(●'◡'●) <i class="ic i-at"><em>@</em></i>鑫酱</li><li class="link"><strong>本文链接：</strong> <a href="https://hakuya.me/learning/unreal/Unreal%20Chaos%20%E5%AF%BC%E5%87%BA%E4%B8%BA%20PhysX%20%E7%89%A9%E7%90%86%E6%96%87%E4%BB%B6/" title="Unreal Chaos 导出为 PhysX 物理文件">https://hakuya.me/learning/unreal/Unreal Chaos 导出为 PhysX 物理文件/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/learning/physx/PhysX%E2%80%94%E2%80%94Serialization%E7%AF%87/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;wallpaper-1255596461.cos.ap-nanjing.myqcloud.com&#x2F;wallpaper (22).jpg" title="PhysX——Serialization篇"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 物理引擎</span><h3>PhysX——Serialization篇</h3></a></div><div class="item right"><a href="/annals/2023%E5%B9%B4%E6%8A%A5/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;wallpaper-1255596461.cos.ap-nanjing.myqcloud.com&#x2F;wallpaper (18).jpg" title="2023年报"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 年报</span><h3>2023年报</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#unreal-chaos-%E5%AF%BC%E5%87%BA%E4%B8%BA-physx-%E7%89%A9%E7%90%86%E6%96%87%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">Unreal Chaos 导出为 PhysX 物理文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#physx-%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%93%E6%9E%84%E6%A2%B3%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">PhysX 序列化结构梳理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#physx-%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%81%E7%A8%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">PhysX 序列化流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.2.</span> <span class="toc-text">二进制文件结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#chaos-%E5%AF%B9%E8%B1%A1%E5%88%B0-physx"><span class="toc-number">2.2.</span> <span class="toc-text">Chaos 对象到 PhysX</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#material"><span class="toc-number">2.2.1.</span> <span class="toc-text">Material</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#geometry"><span class="toc-number">2.2.2.</span> <span class="toc-text">Geometry</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#heightfield"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">HeightField</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#convexmesh"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">ConvexMesh</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#trianglemesh"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">TriangleMesh</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shape"><span class="toc-number">2.2.3.</span> <span class="toc-text">Shape</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#static-actor"><span class="toc-number">2.2.4.</span> <span class="toc-text">Static Actor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dynamic-actor"><span class="toc-number">2.2.5.</span> <span class="toc-text">Dynamic Actor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E8%A7%84%E5%88%99%E5%A4%84%E7%90%86"><span class="toc-number">2.3.</span> <span class="toc-text">特殊规则处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%A0%E4%BD%95%E6%95%B0%E6%8D%AE%E7%83%98%E5%9F%B9"><span class="toc-number">2.3.1.</span> <span class="toc-text">几何数据烘培</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#heightfield-2"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">HeightField</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#convexmesh-2"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">ConvexMesh</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#trianglemesh-2"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">TriangleMesh</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#heightfield-%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.3.2.</span> <span class="toc-text">HeightField 坐标转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E5%AF%B9%E9%BD%90%E5%92%8C%E8%99%9A%E5%87%BD%E6%95%B0%E8%A1%A8%E9%97%AE%E9%A2%98"><span class="toc-number">2.3.3.</span> <span class="toc-text">地址对齐和虚函数表问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E5%AF%B9%E9%BD%90"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">地址对齐</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%83%98%E5%9F%B9%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA"><span class="toc-number">2.3.4.</span> <span class="toc-text">烘培数据导出</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/learning/unreal/UE%20%E5%9F%BA%E7%A1%80%E7%AF%87/" rel="bookmark" title="UE 基础篇">UE 基础篇</a></li><li><a href="/learning/unreal/UE%20%E8%93%9D%E5%9B%BE%E7%AF%87/" rel="bookmark" title="UE 蓝图篇">UE 蓝图篇</a></li><li><a href="/learning/unreal/UE%20Delegate/" rel="bookmark" title="UE Delegate">UE Delegate</a></li><li><a href="/learning/unreal/UE%20VirtualMachine/" rel="bookmark" title="UE VirtualMachine">UE VirtualMachine</a></li><li><a href="/learning/unreal/UE%20%E8%B5%84%E4%BA%A7%E5%AF%BC%E5%87%BA%E5%92%8C%E5%8A%A0%E8%BD%BD/" rel="bookmark" title="UE 资产导出和加载">UE 资产导出和加载</a></li><li><a href="/learning/unreal/Unreal%20%E6%8F%A1%E6%89%8B%E6%B5%81%E7%A8%8B/" rel="bookmark" title="Unreal 握手流程">Unreal 握手流程</a></li><li><a href="/learning/unreal/Unreal%20RPC/" rel="bookmark" title="Unreal RPC">Unreal RPC</a></li><li><a href="/learning/unreal/Unreal%20Replication%20%E7%AF%87/" rel="bookmark" title="Unreal ReplicationGraph 篇">Unreal ReplicationGraph 篇</a></li><li class="active"><a href="/learning/unreal/Unreal%20Chaos%20%E5%AF%BC%E5%87%BA%E4%B8%BA%20PhysX%20%E7%89%A9%E7%90%86%E6%96%87%E4%BB%B6/" rel="bookmark" title="Unreal Chaos 导出为 PhysX 物理文件">Unreal Chaos 导出为 PhysX 物理文件</a></li><li><a href="/learning/unreal/Unreal%20Iris%EF%BC%88%E4%B8%80%EF%BC%89%E6%A6%82%E8%BF%B0/" rel="bookmark" title="Unreal Iris（一）概述">Unreal Iris（一）概述</a></li><li><a href="/learning/unreal/Unreal%20Iris%EF%BC%88%E4%BA%8C%EF%BC%89ReplicationState/" rel="bookmark" title="Unreal Iris（二）ReplicationState">Unreal Iris（二）ReplicationState</a></li><li><a href="/learning/unreal/Unreal%20Iris%EF%BC%88%E4%B8%89%EF%BC%89Filtering%20&&%20Prioritization/" rel="bookmark" title="Unreal Iris（三）Filtering && Prioritization">Unreal Iris（三）Filtering && Prioritization</a></li><li><a href="/learning/unreal/Unreal%20Iris%EF%BC%88%E5%9B%9B%EF%BC%89DataStream/" rel="bookmark" title="Unreal Iris（四）DataStream">Unreal Iris（四）DataStream</a></li><li><a href="/learning/unreal/Unreal%20Iris%EF%BC%88%E4%BA%94%EF%BC%89BaseLine%20&&%20DeltaCompression/" rel="bookmark" title="Unreal Iris（五）BaseLine && DeltaCompression">Unreal Iris（五）BaseLine && DeltaCompression</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="鑫酱(●'◡'●)" data-src="/images/avatar.jpg"><p class="name" itemprop="name">鑫酱(●'◡'●)</p><div class="description" itemprop="description">整天摸鱼，却妄想拯救世界的技术宅</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">110</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">25</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">67</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FsbGVuR1g=" title="https:&#x2F;&#x2F;github.com&#x2F;AllenGX"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTgwNTM4MjQy" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;80538242"><i class="ic i-cloud-music"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjE0MTM5MDcxNTNAcXEuY29t" title="mailto:1413907153@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>好友</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>网址</a></li><li class="item"><a href="/travellings/" rel="section"><i class="ic i-paper-plane"></i>传送门</a></li><li class="item"><a href="/mikutap/" rel="section"><i class="ic i-star"></i>Mikutap</a></li><li class="item"><a href="/restart/" rel="section"><i class="ic i-sun"></i>RestartLife</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/learning/physx/PhysX%E2%80%94%E2%80%94Serialization%E7%AF%87/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/annals/2023%E5%B9%B4%E6%8A%A5/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/python/" title="分类于 python">python</a></div><span><a href="/learning/programlanguage/python/Python2-Source-Code/" title="python2源码剖析">python2源码剖析</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/physx/" title="分类于 物理引擎">物理引擎</a></div><span><a href="/learning/physx/%E3%80%8CScene%20Queries%E3%80%8DAABBTree%E2%80%94%E2%80%94%E4%B8%8A/" title="「Scene Queries」AABBTree——上">「Scene Queries」AABBTree——上</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/unreal/" title="分类于 UE">UE</a></div><span><a href="/learning/unreal/UE%20%E8%B5%84%E4%BA%A7%E5%AF%BC%E5%87%BA%E5%92%8C%E5%8A%A0%E8%BD%BD/" title="UE 资产导出和加载">UE 资产导出和加载</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game202/" title="分类于 GAME202高质量实时渲染">GAME202高质量实时渲染</a></div><span><a href="/learning/games/Game202/%E4%B8%83%E3%80%81Practical%20Industrial%20Solutions/" title="七、Practical Industrial Solutions">七、Practical Industrial Solutions</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game101/" title="分类于 Games101图形渲染">Games101图形渲染</a></div><span><a href="/learning/games/Game101/%E4%BA%8C%E5%8D%81%E4%B8%89%E3%80%81Animation%EF%BC%88%E4%B8%8A%EF%BC%89/" title="二十三、Animation（上）">二十三、Animation（上）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game101/" title="分类于 Games101图形渲染">Games101图形渲染</a></div><span><a href="/learning/games/Game101/%E4%BA%8C%E5%8D%81%E3%80%81Advanced%20Topics%20in%20Rendering%E2%80%94%E2%80%94Appearance%20Modeling/" title="二十、Advanced Topics in Rendering——Appearance Modeling">二十、Advanced Topics in Rendering——Appearance Modeling</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game101/" title="分类于 Games101图形渲染">Games101图形渲染</a></div><span><a href="/learning/games/Game101/%E5%8D%81%E3%80%81Geometry%EF%BC%88%E4%B8%8A%EF%BC%89/" title="十、Geometry（上）">十、Geometry（上）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/programlanguage/cpp/" title="分类于 cpp">cpp</a></div><span><a href="/learning/programlanguage/cpp/%E5%85%AB%E3%80%81%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/" title="八、函数介绍">八、函数介绍</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game101/" title="分类于 Games101图形渲染">Games101图形渲染</a></div><span><a href="/learning/games/Game101/%E4%BA%8C%E5%8D%81%E5%9B%9B%E3%80%81Animation%EF%BC%88%E4%B8%8B%EF%BC%89/" title="二十四、Animation（下）">二十四、Animation（下）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learning/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/" title="分类于 Games系列">Games系列</a> <i class="ic i-angle-right"></i> <a href="/categories/learning/games/Game101/" title="分类于 Games101图形渲染">Games101图形渲染</a></div><span><a href="/learning/games/Game101/%E5%8D%81%E4%B8%89%E3%80%81Shadow%20Mapping/" title="十三、Shadow Mapping">十三、Shadow Mapping</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">鑫酱(●'◡'●) @ 个人博客</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">639k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">9:41</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"learning/unreal/Unreal Chaos 导出为 PhysX 物理文件/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/animejs@3.2.0/lib/anime.min.js,npm/katex@0.12.0/dist/contrib/copy-tex.min.js,npm/frappe-charts@1.5.0/dist/frappe-charts.min.iife.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/quicklink@2/dist/quicklink.umd.js,gh/amehime/MiniValine@4.2.2-beta10/dist/MiniValine.min.js"></script><script src="/js/app.js?v=0.2.5"></script><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b6d809b500bd6f0040117088899bc7bf";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>